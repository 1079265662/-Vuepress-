(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{642:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("介绍")]),t._v(" "),a("p",[t._v("three.js 三维模型交互相关的内容"),a("br")])]),t._v(" "),a("h2",{attrs:{id:"什么是三维模型的节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是三维模型的节点"}},[t._v("#")]),t._v(" 什么是三维模型的节点")]),t._v(" "),a("p",[t._v("开发一些web3d项目，比如一个小区、学校的可视化，场景中会有多个楼房模型对象，这时候程序员通过什么方式区分每一栋楼是一个问题。")]),t._v(" "),a("p",[t._v("通过获取指定模型的节点 我们可以和其建立交互效果 就跟前端的获取Dom 绑定事件是一样的")]),t._v(" "),a("h3",{attrs:{id:"三维建模软件和three-js模型名称对应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三维建模软件和three-js模型名称对应"}},[t._v("#")]),t._v(" "),a("strong",[t._v("三维建模软件和three.js模型名称对应")])]),t._v(" "),a("ul",[a("li",[t._v("一般三维建模软件的"),a("strong",[t._v("目录树")]),t._v("都有模型的名称，three.js加载外部模型，外部模型的名称会解析为three.js对象的 "),a("code",[t._v(".name")]),t._v("属性。")]),t._v(" "),a("li",[t._v("类似以前端的Dom节点一样 我们通过"),a("code",[t._v("class")]),t._v("或者"),a("code",[t._v("id")]),t._v("给其绑定一个类名 然后通过一些选择Dom的方法 绑定其Dom节点 就可以实现一些交互效果")])]),t._v(" "),a("h3",{attrs:{id:"获取三维模型的节点-getobjectbyname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取三维模型的节点-getobjectbyname"}},[t._v("#")]),t._v(" "),a("strong",[t._v("获取三维模型的节点 "),a("code",[t._v(".getObjectByName()")])])]),t._v(" "),a("ul",[a("li",[t._v("three.js通过基类"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Object3D#api/zh/core/Object3D",target:"_blank",rel:"noopener noreferrer"}},[t._v("Object3D"),a("OutboundLink")],1),t._v("的 "),a("code",[t._v(".getObjectByName('模型节点名称name')")]),t._v("方法快速查找某个模型对象，就像普通前端绑定DOM的方法 "),a("code",[t._v("getElementById()")]),t._v("一样。\n"),a("ul",[a("li",[a("code",[t._v(".getObjectByName()")]),t._v(" 不光具备绑定模型节点操作节点 也可以进行模型节点进行筛选(类似于"),a("code",[t._v("filter")]),t._v(") 筛选符合条件的模型节点内容 找不到会返回"),a("code",[t._v("undefined")])])])]),t._v(" "),a("li",[t._v("我们可以通过给"),a("strong",[t._v("模型对象")]),t._v("添加"),a("strong",[t._v("父类")]),t._v(" 通过获取父类的三维模型的节点 实现批量修改模型对象的方式")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" model "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//声明一个组对象，用来添加加载成功的三维场景")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GLTFLoader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建一个GLTF加载器")]),t._v("\nloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./scene/scene.gltf"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("gltf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我有两个模型 名称为: 立方体 和 Cylinder 我们通过getObjectByName()获取其三维模型的节点 ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mesh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObjectByName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'立方体'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'立方体'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//控制台查看返回结果")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Cylinder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObjectByName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cylinder'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//圆柱体")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'圆柱体'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Cylinder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//控制台查看返回结果")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找符合条件的name名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ret "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObjectByName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'粮仓'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找符合条件的name")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们还可以批量修改某个模型的内容 比如以上两模型都在 Group这个父类 通过获取父类批量修改里面的子类")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" group "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObjectByName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Group'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获得立方体和Cylinder的父对象Group")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 批量更改group所有后代的颜色")]),t._v("\n    group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("mesh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        mesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("material"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x00ffff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"模型命名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模型命名"}},[t._v("#")]),t._v(" "),a("strong",[t._v("模型命名")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("命名：中文名、英文名、汉语拼音都可以，可以根据公司规定或开发习惯命名。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("规范")]),t._v("：模型命名也可以参考编程命名规范，目前大多数公司提倡英文命名，中文命名很少见。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("相关")]),t._v("：模型名称可以尝试参考前后端API接口名称，比如前后端接口定义，"),a("strong",[t._v("P_01")]),t._v("对应"),a("strong",[t._v("1号")]),t._v("平房粮仓，"),a("strong",[t._v("P_02")]),t._v("对应"),a("strong",[t._v("2号")]),t._v("平房粮仓，那么美术和前端之间模型的名称也可以使用P_01、P_02分别表示1号平房粮仓、2号平房粮仓。毕竟前端WebGL工程师要同时和后端、美术协作，名称都一致更方便。")])])]),t._v(" "),a("h3",{attrs:{id:"命名其他问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命名其他问题"}},[t._v("#")]),t._v(" "),a("strong",[t._v("命名其他问题")])]),t._v(" "),a("ul",[a("li",[t._v("通过三维软件建模的时候，每个模型软件都会默认生成一个名字( 唯一名字 )，如果前端代码不需要查询某个模型进行特定操作，那么该模型名称随意是什么都无所谓 并不会重名 除非自己修改。")]),t._v(" "),a("li",[t._v("如果需要选中进行特定操作的模型，一般需要处于独立状态，不能和其它Mesh合在一起，比如需要获取模型世界坐标、射线拾取模型对象等。")])]),t._v(" "),a("blockquote",[a("p",[t._v("命名建议")])]),t._v(" "),a("ol",[a("li",[t._v("需要进行交互的模型 一定要独立绘制 并且名称需要唯一")]),t._v(" "),a("li",[t._v("需要交互的不同模型 建议创建父级名称进行归类")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220609175247508.png",alt:"image-20220609175247508"}})]),t._v(" "),a("h2",{attrs:{id:"鼠标交互-射线拾取操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#鼠标交互-射线拾取操作"}},[t._v("#")]),t._v(" 鼠标交互 射线拾取操作")]),t._v(" "),a("p",[t._v("通过"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Object3D#api/zh/core/Object3D.getObjectByName",target:"_blank",rel:"noopener noreferrer"}},[t._v(".getObjectByName"),a("OutboundLink")],1),t._v("筛选出需要交互的模型 然后通过Object3D"),a("a",{attrs:{href:"https://threejs.org/docs/index.html#api/zh/core/Object3D.traverse",target:"_blank",rel:"noopener noreferrer"}},[t._v(".traverse"),a("OutboundLink")],1),t._v("方法遍历递归出他们的网格模型"),a("code",[t._v("Mesh")]),t._v(" 最后通过 "),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Raycaster#api/zh/core/Raycaster",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raycaster光摄投线"),a("OutboundLink")],1),t._v("的方法进行鼠标拾取（在三维空间中计算出鼠标移过了什么物体）判断是否点击的是需要交互的网格模型节点 如果是 那么就给选中的网格模型节点进行一些交互效果")]),t._v(" "),a("blockquote",[a("p",[t._v("射线拾取网格模型——四步走")])]),t._v(" "),a("ol",[a("li",[t._v("获取需要鼠标交互的网格模型集合(父对象) "),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Object3D#api/zh/core/Object3D.getObjectByName",target:"_blank",rel:"noopener noreferrer"}},[t._v(".getObjectByName"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("坐标转化(鼠标单击的屏幕坐标转WebGL标准设备坐标)")]),t._v(" "),a("li",[t._v("射线生成计算 (通过鼠标单击位置+相机参数计算射线值)")]),t._v(" "),a("li",[t._v("射线拾取计算"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Raycaster#api/zh/core/Raycaster.intersectObjects",target:"_blank",rel:"noopener noreferrer"}},[t._v(".intersectObjects"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"获取需要鼠标交互的网格模型集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取需要鼠标交互的网格模型集合"}},[t._v("#")]),t._v(" "),a("strong",[t._v("获取需要鼠标交互的网格模型集合")])]),t._v(" "),a("ul",[a("li",[t._v("通常需要交互的网格模型会放入"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Group#api/zh/objects/Group",target:"_blank",rel:"noopener noreferrer"}},[t._v("Group"),a("OutboundLink")],1),t._v("集合中( 建模自带 或者 手动创建"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Group#api/zh/objects/Group",target:"_blank",rel:"noopener noreferrer"}},[t._v("Group"),a("OutboundLink")],1),t._v(" )")]),t._v(" "),a("li",[t._v("通过"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Object3D#api/zh/core/Object3D.getObjectByName",target:"_blank",rel:"noopener noreferrer"}},[t._v(".getObjectByName"),a("OutboundLink")],1),t._v("筛选出需要交互的模型 然后通过Object3D的"),a("a",{attrs:{href:"https://threejs.org/docs/index.html#api/zh/core/Object3D.traverse",target:"_blank",rel:"noopener noreferrer"}},[t._v(".traverse"),a("OutboundLink")],1),t._v("方法遍历递归出他们的网格模型"),a("code",[t._v("Mesh")])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明一个储存需要交互的网格模型的数组")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" granaryArr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nloader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"建模文件.glb"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("gltf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//gltf加载成功后返回一个对象")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// // 所有需要交互的网格模型父对象名称：'粮仓'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" group "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getObjectByName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'粮仓'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//console.log('粮仓', group);")]),t._v("\n    group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("traverse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("obj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Mesh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            granaryArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    model"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gltf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scene"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"坐标转化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#坐标转化"}},[t._v("#")]),t._v(" "),a("strong",[t._v("坐标转化")])]),t._v(" "),a("ul",[a("li",[t._v("鼠标单击canvas画布，通过返回事件对象属性 "),a("code",[t._v("window.event.clientX")]),t._v("和 "),a("code",[t._v("window.event.clientY")]),t._v("鼠标单机位置的屏幕坐标,然后把屏幕坐标转化为WebGL标准设备坐标，WebGL标准设备坐标坐标范围[-1,1]。\n"),a("ul",[a("li",[t._v("WebGL标准设备坐标公式:\n"),a("ul",[a("li",[t._v("宽: ( 当前鼠标宽 / 当前设备的宽 )  * 2 - 1")]),t._v(" "),a("li",[t._v("高: -( 当前鼠标高 / 当前设备的高 )  * 2 + 1")])])])])])]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Sx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientX "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 鼠标单击位置横坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Sy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientY "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 鼠标单击位置纵坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//屏幕坐标转WebGL标准设备坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerWidth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WebGL标准设备横坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//WebGL标准设备纵坐标")]),t._v("\n")])])]),a("h3",{attrs:{id:"射线生成计算-setfromcamera"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#射线生成计算-setfromcamera"}},[t._v("#")]),t._v(" "),a("strong",[t._v("射线生成计算 "),a("code",[t._v(".setFromCamera()")])])]),t._v(" "),a("p",[t._v("把鼠标单击位置坐标和相机参数作为 "),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Raycaster#api/zh/core/Raycaster.setFromCamera",target:"_blank",rel:"noopener noreferrer"}},[t._v(".setFromCamera(Vector2, Camera)"),a("OutboundLink")],1),t._v("方法的参数，计算射线投射器 "),a("code",[t._v("Raycaster")]),t._v("的射线属性 "),a("code",[t._v(".ray")]),t._v("值。")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建一个射线投射器`Raycaster`")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" raycaster "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Raycaster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过鼠标单击位置标准设备坐标和相机参数计算射线投射器Raycaster的射线属性 .ray")]),t._v("\nraycaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFromCamera")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Vector2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" camera"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"射线拾取计算-intersectobjects"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#射线拾取计算-intersectobjects"}},[t._v("#")]),t._v(" "),a("strong",[t._v("射线拾取计算 "),a("code",[t._v(".intersectObjects()")])])]),t._v(" "),a("p",[t._v("通过 "),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Raycaster#api/zh/core/Raycaster.intersectObjects",target:"_blank",rel:"noopener noreferrer"}},[t._v(".intersectObjects(交互模组集合array)"),a("OutboundLink")],1),t._v("方法可以计算出来射线相交的网格模型。")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//返回.intersectObjects()参数中射线选中的网格模型对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未选中对象返回空数组[],选中一个数组1个元素，选中两个数组两个元素")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" intersects "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" raycaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("intersectObjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("boxMesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sphereMesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cylinderMesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"射线拾取获取场景点击坐标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#射线拾取获取场景点击坐标"}},[t._v("#")]),t._v(" "),a("strong",[t._v("射线拾取获取场景点击坐标")])]),t._v(" "),a("ul",[a("li",[t._v("通过射线拾取计算 "),a("code",[t._v(".intersectObjects()")]),t._v(" 可以获得当前拾取(场景点击)的 x y z坐标 他是一个"),a("code",[t._v("Vector3")]),t._v("三维向量 "),a("code",[t._v("Object3D")]),t._v("对象可以直接通过"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=Vector3#api/zh/math/Vector3.copy",target:"_blank",rel:"noopener noreferrer"}},[t._v(".copy(Vector3)"),a("OutboundLink")],1),t._v(" 进行 x y z赋值")]),t._v(" "),a("li",[t._v("有时候会有多个射线拾取 其实是模型重叠 把后面的模型也选中了 **"),a("a",{attrs:{href:"https://threejs.org/docs/#api/zh/core/Object3D.renderOrder",target:"_blank",rel:"noopener noreferrer"}},[t._v(".renderOrder"),a("OutboundLink")],1),t._v("**设置渲染顺序即可(不确定) 或者选中第一个对象")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Object3D"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intersects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("point"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 选择第一个对象 有时候模型重叠会存在多个对象 但是点击对象通常是第一个")]),t._v("\n")])])]),a("h3",{attrs:{id:"整体写法vue3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体写法vue3"}},[t._v("#")]),t._v(" "),a("strong",[t._v("整体写法")]),t._v("Vue3")]),t._v(" "),a("ul",[a("li",[t._v("我们需要记录 上一次所选中的网格模型对象 当选择下一个的时候 让原来那个恢复未选中的样式效果")]),t._v(" "),a("li",[t._v("修改材质颜色的时候 需要用 颜色(Color)的"),a("a",{attrs:{href:"https://threejs.org/docs/index.html?q=color#api/zh/math/Color.set",target:"_blank",rel:"noopener noreferrer"}},[t._v("color.set"),a("OutboundLink")],1),t._v(" 方法进行材质颜色修改")]),t._v(" "),a("li",[a("font",{attrs:{color:"#ff3040"}},[t._v(" 注意: 如果材质是一张贴图 将无法修改")])],1)]),t._v(" "),a("div",{staticClass:"language-vue extra-class"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 渲染模板 --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stateDom"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("@click")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("checked"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入Three.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("THREE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'three'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 导入Vue组合API")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" reactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" camera "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./settings/RendererCamera.js'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取需要交互的模型对象集合")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" contentModel "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./settings/model.js'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 储存选中的网格模型对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" context "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reactive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  chooseMesh"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定渲染模板的点击事件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("checked")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断上次是否有选过网格模型对象")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chooseMesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chooseMesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("material"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#ffffff'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 把上次选中的mesh设置为原来的颜色")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Sx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientX "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 鼠标单击位置横坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Sy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientY "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 鼠标单击位置纵坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 屏幕坐标转WebGL标准设备坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerWidth"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WebGL标准设备横坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" y "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Sy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WebGL标准设备纵坐标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个射线投射器Raycaster")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" raycaster "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Raycaster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过鼠标单击位置标准设备坐标和相机参数计算射线投射器Raycaster的射线属性.ray")]),t._v("\n  raycaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setFromCamera")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("THREE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Vector2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" camera"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回.intersectObjects()参数中射线选中的网格模型对象")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未选中对象返回空数组[],选中一个数组1个元素，选中两个数组两个元素")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" intersects "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" raycaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("intersectObjects")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contentModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("granaryArr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intersects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// console.log("射线器返回的对象", intersects);')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// console.log("射线投射器返回的对象 点point", intersects[0].point);')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// console.log("射线投射器的对象 几何体",intersects[0].object.geometry.vertices)')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// intersects.length大于0说明，说明选中了模型")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intersects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 赋值被点中的交互模型")]),t._v("\n    context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chooseMesh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" intersects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("object\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打印当前鼠标点击在场景的坐标 x y z")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("intersects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("point"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("chooseMesh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("material"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#00ffff'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 选中改变颜色，这样材质颜色贴图.map和color颜色会相乘")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h2",{attrs:{id:"参考文献"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[t._v("#")]),t._v(" 参考文献")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://www.yanhuangxueyuan.com/Three.js/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Three.js零基础入门教程(郭隆邦)"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);