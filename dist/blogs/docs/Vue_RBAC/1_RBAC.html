<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RABCæƒé™å­¦ä¹ è®°å½•æ–‡æ¡£ | LKaiLi</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="https://pan.zealsay.com/blog/favicon.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/mouseClick.js"></script>
    <script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?61498f37b83812e7b85952d5feaaab47";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script>
    <meta name="description" content="è‰ èµ° ğŸ¤¸ å¿½ç•¥">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.e95cc97b.css" as="style"><link rel="preload" href="/assets/js/app.0080b5db.js" as="script"><link rel="preload" href="/assets/js/5.e6fb2106.js" as="script"><link rel="preload" href="/assets/js/1.9ae38156.js" as="script"><link rel="preload" href="/assets/js/50.302a422c.js" as="script"><link rel="prefetch" href="/assets/js/10.988ddcf1.js"><link rel="prefetch" href="/assets/js/11.ceb7dad1.js"><link rel="prefetch" href="/assets/js/12.ba0b832e.js"><link rel="prefetch" href="/assets/js/13.68f66a28.js"><link rel="prefetch" href="/assets/js/14.812668b7.js"><link rel="prefetch" href="/assets/js/15.a39e12f0.js"><link rel="prefetch" href="/assets/js/16.949c9eb9.js"><link rel="prefetch" href="/assets/js/17.8c1afffa.js"><link rel="prefetch" href="/assets/js/18.1c92af2c.js"><link rel="prefetch" href="/assets/js/19.b3487f5f.js"><link rel="prefetch" href="/assets/js/20.71e8ffd1.js"><link rel="prefetch" href="/assets/js/21.060e21fd.js"><link rel="prefetch" href="/assets/js/22.ba9e7fd0.js"><link rel="prefetch" href="/assets/js/23.c4681347.js"><link rel="prefetch" href="/assets/js/24.dc65eefe.js"><link rel="prefetch" href="/assets/js/25.a87bab83.js"><link rel="prefetch" href="/assets/js/26.32afa6c9.js"><link rel="prefetch" href="/assets/js/27.ddd3a1d0.js"><link rel="prefetch" href="/assets/js/28.7b41e498.js"><link rel="prefetch" href="/assets/js/29.4e1d83a6.js"><link rel="prefetch" href="/assets/js/3.4e5d0e6c.js"><link rel="prefetch" href="/assets/js/30.fd71be4f.js"><link rel="prefetch" href="/assets/js/31.a915d2fe.js"><link rel="prefetch" href="/assets/js/32.e03742ee.js"><link rel="prefetch" href="/assets/js/33.dc9cb1a5.js"><link rel="prefetch" href="/assets/js/34.d3f64b2b.js"><link rel="prefetch" href="/assets/js/35.512c33f0.js"><link rel="prefetch" href="/assets/js/36.822a0b6d.js"><link rel="prefetch" href="/assets/js/37.aeafad3d.js"><link rel="prefetch" href="/assets/js/38.f72714e6.js"><link rel="prefetch" href="/assets/js/39.771eb2a3.js"><link rel="prefetch" href="/assets/js/4.0067ce26.js"><link rel="prefetch" href="/assets/js/40.ec9bb689.js"><link rel="prefetch" href="/assets/js/41.40858107.js"><link rel="prefetch" href="/assets/js/42.0e598432.js"><link rel="prefetch" href="/assets/js/43.037f91cf.js"><link rel="prefetch" href="/assets/js/44.2a4150a3.js"><link rel="prefetch" href="/assets/js/45.524a1d1a.js"><link rel="prefetch" href="/assets/js/46.b9d37e76.js"><link rel="prefetch" href="/assets/js/47.493990ff.js"><link rel="prefetch" href="/assets/js/48.40148c70.js"><link rel="prefetch" href="/assets/js/49.858ae711.js"><link rel="prefetch" href="/assets/js/51.5f217faf.js"><link rel="prefetch" href="/assets/js/52.a98f98e5.js"><link rel="prefetch" href="/assets/js/53.11099602.js"><link rel="prefetch" href="/assets/js/54.8ed4b31a.js"><link rel="prefetch" href="/assets/js/55.15790820.js"><link rel="prefetch" href="/assets/js/56.f8f947ed.js"><link rel="prefetch" href="/assets/js/57.dba86ee1.js"><link rel="prefetch" href="/assets/js/58.d0f05e7e.js"><link rel="prefetch" href="/assets/js/59.b0768b2a.js"><link rel="prefetch" href="/assets/js/6.b813653c.js"><link rel="prefetch" href="/assets/js/60.2993ec00.js"><link rel="prefetch" href="/assets/js/61.70c982a0.js"><link rel="prefetch" href="/assets/js/62.c52f6280.js"><link rel="prefetch" href="/assets/js/63.c8c92802.js"><link rel="prefetch" href="/assets/js/64.5578df12.js"><link rel="prefetch" href="/assets/js/65.186d72e8.js"><link rel="prefetch" href="/assets/js/66.e774f297.js"><link rel="prefetch" href="/assets/js/67.5023b411.js"><link rel="prefetch" href="/assets/js/68.4e4bef1a.js"><link rel="prefetch" href="/assets/js/69.f3cd345b.js"><link rel="prefetch" href="/assets/js/7.d057457a.js"><link rel="prefetch" href="/assets/js/70.c96b7523.js"><link rel="prefetch" href="/assets/js/71.635f07de.js"><link rel="prefetch" href="/assets/js/72.2b58e52b.js"><link rel="prefetch" href="/assets/js/73.647369a4.js"><link rel="prefetch" href="/assets/js/74.ace7619f.js"><link rel="prefetch" href="/assets/js/75.1a147cf9.js"><link rel="prefetch" href="/assets/js/76.b127b41f.js"><link rel="prefetch" href="/assets/js/77.b4dd8d84.js"><link rel="prefetch" href="/assets/js/78.1697c041.js"><link rel="prefetch" href="/assets/js/79.ca2c3034.js"><link rel="prefetch" href="/assets/js/8.b1f53c13.js"><link rel="prefetch" href="/assets/js/80.253ac042.js"><link rel="prefetch" href="/assets/js/81.eef8c57a.js"><link rel="prefetch" href="/assets/js/82.a7445874.js"><link rel="prefetch" href="/assets/js/83.f342cd11.js"><link rel="prefetch" href="/assets/js/84.b7c8643e.js"><link rel="prefetch" href="/assets/js/85.0181db14.js"><link rel="prefetch" href="/assets/js/86.ea34a808.js"><link rel="prefetch" href="/assets/js/87.3e06f948.js"><link rel="prefetch" href="/assets/js/88.b0b4b249.js"><link rel="prefetch" href="/assets/js/89.c9feebc0.js"><link rel="prefetch" href="/assets/js/9.4652c675.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e95cc97b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-ec75d12e><div data-v-ec75d12e><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-ec75d12e data-v-ec75d12e><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-89477f7e data-v-ec75d12e data-v-ec75d12e><h3 class="title" style="display:none;" data-v-89477f7e data-v-89477f7e>LKaiLi</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-89477f7e data-v-89477f7e><input type="password" value="" data-v-89477f7e> <span data-v-89477f7e>Konck! Knock!</span> <button data-v-89477f7e>OK</button></label> <div class="footer" style="display:none;" data-v-89477f7e data-v-89477f7e><span data-v-89477f7e><i class="iconfont reco-theme" data-v-89477f7e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-89477f7e>vuePress-theme-reco</a></span> <span data-v-89477f7e><i class="iconfont reco-copyright" data-v-89477f7e></i> <a data-v-89477f7e><span data-v-89477f7e>LKaiLi</span>
          Â Â 
          <span data-v-89477f7e>2021  - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-ec75d12e><div data-v-ec75d12e><div id="smart" class="wrapper-page" style="background-image:url(https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/vue.jpg);background-position-x:center;background-position-y:center;background-size:cover;background-repeat-x:no-repeat;background-repeat-y:no-repeat;" data-v-ec75d12e><header class="navbar" data-v-ec75d12e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="LKaiLi" class="logo"> <span class="site-name">LKaiLi</span></a> <div class="links"><div id="dayNightSwitch" class="generalWrapper" data-v-32f44868><a class="click" data-v-32f44868><div class="onOff daySwitch" data-v-32f44868><div class="star star1" data-v-32f44868></div> <div class="star star2" data-v-32f44868></div> <div class="star star3" data-v-32f44868></div> <div class="star star4" data-v-32f44868></div> <div class="star star5" data-v-32f44868></div> <div class="star sky" data-v-32f44868></div> <div class="sunMoon" data-v-32f44868><div class="crater crater1" data-v-32f44868></div> <div class="crater crater2" data-v-32f44868></div> <div class="crater crater3" data-v-32f44868></div> <div class="cloud part1" data-v-32f44868></div> <div class="cloud part2" data-v-32f44868></div></div></div></a></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/vue-element-admin/" class="nav-link"><i class="iconfont undefined"></i>
  vue-element-admin
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vscode/" class="nav-link"><i class="iconfont undefined"></i>
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue3/" class="nav-link"><i class="iconfont undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vueç§»åŠ¨å¤´æ¡é¡¹ç›®/" class="nav-link"><i class="iconfont undefined"></i>
  Vueç§»åŠ¨å¤´æ¡é¡¹ç›®
</a></li><li class="dropdown-item"><!----> <a href="/categories/RABC/" class="nav-link"><i class="iconfont undefined"></i>
  RABC
</a></li><li class="dropdown-item"><!----> <a href="/categories/animation/" class="nav-link"><i class="iconfont undefined"></i>
  animation
</a></li><li class="dropdown-item"><!----> <a href="/categories/å°ç¨‹åº/" class="nav-link"><i class="iconfont undefined"></i>
  å°ç¨‹åº
</a></li><li class="dropdown-item"><!----> <a href="/categories/axios/" class="nav-link"><i class="iconfont undefined"></i>
  axios
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniapp/" class="nav-link"><i class="iconfont undefined"></i>
  uniapp
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´è½´
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      å…³äºæ’­å®¢
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link"><i class="iconfont reco-mail"></i>
  å…³äºæˆ‘
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link"><i class="iconfont reco-account"></i>
  è”ç³»æˆ‘
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-ec75d12e></div> <aside class="sidebar" data-v-ec75d12e><div class="personal-info-wrapper" data-v-03833281 data-v-ec75d12e><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/my_cat.png" alt="author-avatar" class="personal-img" data-v-03833281> <h3 class="name" data-v-03833281>
    LKaiLi
  </h3> <div class="num" data-v-03833281><div data-v-03833281><h3 data-v-03833281>74</h3> <h6 data-v-03833281>æ–‡ç« </h6></div> <div data-v-03833281><h3 data-v-03833281>29</h3> <h6 data-v-03833281>æ ‡ç­¾</h6></div></div> <hr data-v-03833281></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/vue-element-admin/" class="nav-link"><i class="iconfont undefined"></i>
  vue-element-admin
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vscode/" class="nav-link"><i class="iconfont undefined"></i>
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue3/" class="nav-link"><i class="iconfont undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vueç§»åŠ¨å¤´æ¡é¡¹ç›®/" class="nav-link"><i class="iconfont undefined"></i>
  Vueç§»åŠ¨å¤´æ¡é¡¹ç›®
</a></li><li class="dropdown-item"><!----> <a href="/categories/RABC/" class="nav-link"><i class="iconfont undefined"></i>
  RABC
</a></li><li class="dropdown-item"><!----> <a href="/categories/animation/" class="nav-link"><i class="iconfont undefined"></i>
  animation
</a></li><li class="dropdown-item"><!----> <a href="/categories/å°ç¨‹åº/" class="nav-link"><i class="iconfont undefined"></i>
  å°ç¨‹åº
</a></li><li class="dropdown-item"><!----> <a href="/categories/axios/" class="nav-link"><i class="iconfont undefined"></i>
  axios
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniapp/" class="nav-link"><i class="iconfont undefined"></i>
  uniapp
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´è½´
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      å…³äºæ’­å®¢
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link"><i class="iconfont reco-mail"></i>
  å…³äºæˆ‘
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link"><i class="iconfont reco-account"></i>
  è”ç³»æˆ‘
</a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue RBAC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/docs/Vue_RBAC/1_RBAC.html" aria-current="page" class="active sidebar-link">RABCæƒé™å­¦ä¹ è®°å½•æ–‡æ¡£</a></li><li><a href="/blogs/docs/Vue_RBAC/2_login_token.html" class="sidebar-link">ç»­ç­¾tokençš„æµç¨‹</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-89477f7e data-v-ec75d12e><h3 class="title" style="display:none;" data-v-89477f7e data-v-89477f7e>RABCæƒé™å­¦ä¹ è®°å½•æ–‡æ¡£</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-89477f7e data-v-89477f7e><input type="password" value="" data-v-89477f7e> <span data-v-89477f7e>Konck! Knock!</span> <button data-v-89477f7e>OK</button></label> <div class="footer" style="display:none;" data-v-89477f7e data-v-89477f7e><span data-v-89477f7e><i class="iconfont reco-theme" data-v-89477f7e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-89477f7e>vuePress-theme-reco</a></span> <span data-v-89477f7e><i class="iconfont reco-copyright" data-v-89477f7e></i> <a data-v-89477f7e><span data-v-89477f7e>LKaiLi</span>
          Â Â 
          <span data-v-89477f7e>2021  - </span>
          2022
        </a></span></div></div></div> <div data-v-ec75d12e><main class="page"><div class="page-title" style="display:none;"><h1 class="title">RABCæƒé™å­¦ä¹ è®°å½•æ–‡æ¡£</h1> <div class="page-info" data-v-0efa1f05><i class="iconfont reco-account" data-v-0efa1f05><span data-v-0efa1f05>LKaiLi</span></i> <i class="iconfont reco-date" data-v-0efa1f05><span data-v-0efa1f05>2022-01-11</span></i> <i class="iconfont reco-eye" data-v-0efa1f05><span id="/blogs/docs/Vue_RBAC/1_RBAC.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-0efa1f05><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-0efa1f05><span class="tag-item" data-v-0efa1f05>axios</span><span class="tag-item" data-v-0efa1f05>RABC</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block tip"><p class="custom-block-title">ä»‹ç»</p> <p>RABCæƒé™å­¦ä¹ è®°å½•æ–‡æ¡£ ä»å¤´åˆ°å°¾å­¦ä¹ æ–‡æ¡£<br></p></div> <h2 id="æƒé™æµç¨‹å›¾"><a href="#æƒé™æµç¨‹å›¾" class="header-anchor">#</a> æƒé™æµç¨‹å›¾</h2> <ul><li><p><a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E8%AE%BF%E9%97%AE%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.pdf" target="_blank" rel="noopener noreferrer">æ•´ä½“æƒé™çš„æµç¨‹æ€»ç»“å›¾pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://gitee.com/liu_kaili/mine-project-advanced-revision" target="_blank" rel="noopener noreferrer">æœ¬åœ°ä»“åº“åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://element-admin.ynitmk.cn/" target="_blank" rel="noopener noreferrer">é¡¹ç›®ä½“éªŒåœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  è´¦æˆ· admin  å¯†ç  1234</p></li> <li><p>å‰ç«¯ä¸»ä½“æƒé™æµç¨‹å›¾(å‰ç«¯æµç¨‹)</p></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211208172131082.png" alt="image-20211208172131082"></p> <ul><li>åç«¯æƒé™æµç¨‹å›¾(è¡¨ç»“æ„ ä»…ä¾›å‚è€ƒ)</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211213101322386.png" alt="image-20211213101322386"></p> <h2 id="æƒé™å­¦ä¹ åœ°å€"><a href="#æƒé™å­¦ä¹ åœ°å€" class="header-anchor">#</a> æƒé™å­¦ä¹ åœ°å€</h2> <ul><li>æˆ‘æ˜¯é€šè¿‡<a href="https://ke.qq.com/course/3451173" target="_blank" rel="noopener noreferrer">è…¾è®¯è¯¾å ‚<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ¥å­¦ä¹ çš„æƒé™ç®¡ç†å†…å®¹ æ‰€æœ‰çš„ç¬”è®°éƒ½æŒ‰ç…§å…¶æˆè¯¾å†…å®¹è®°å½•çš„ è¯·å…ˆæµè§ˆè¯¥é¡¹ç›®å ç¬¦åˆé¡¹ç›®è®¾è®¡éœ€æ±‚å å†ç»§ç»­æµè§ˆæœ¬è®°å½•</li></ul> <h2 id="æƒé™å‡†å¤‡å·¥ä½œ"><a href="#æƒé™å‡†å¤‡å·¥ä½œ" class="header-anchor">#</a> æƒé™å‡†å¤‡å·¥ä½œ</h2> <blockquote><p>åç«¯å…„å¼Ÿéœ€è¦æ€ä¹ˆé…åˆä½ å‘¢</p></blockquote> <ul><li><p>é¦–å…ˆ éœ€è¦åç«¯æŠŠæƒé™æŒ‰ç…§ä½ éœ€è¦çš„æ ¼å¼è¿”å›ç»™ä½ </p> <ul><li><code>roles</code> æ˜¯ç”¨æˆ·æ‹¥æœ‰æƒé™çš„åˆé›† å‰ç«¯æ˜¯é€šè¿‡<code>roles</code>æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·å¤‡è·¯ç”±æƒé™å’Œè·¯ç”±æŒ‰é’®æƒé™(å…ƒç´ ) <font color="#ff3040">æ³¨æ„: å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„æ ¼å¼ </font></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211212191435998.png" alt="image-20211212191435998"></p> <ul><li>ç„¶å ä½ éœ€è¦è®©åç«¯ç”Ÿæˆå…¨éƒ¨åŠ¨æ€è·¯ç”±èœå•  <font color="#ff3040">æ³¨æ„: å¿…é¡»è®©åç«¯è¿™æ ·åš</font> <ul><li>è¿™é‡Œçš„åŠ¨æ€è·¯ç”±èœå•å°±æ˜¯è·¯ç”±æƒé™ å‰ç«¯ä¼šé€šè¿‡vue element admin ä¸­æä¾›çš„è·¯ç”±æƒé™æ¶æ„å®ç°è·¯ç”±çš„æ•´ä½“æƒé™æ§åˆ¶
<ul><li>vue element admin æä¾›äº†metaå¯¹è±¡ é‡Œé¢åŒ…å«<code>roles</code> å°±æ˜¯æ§åˆ¶è·¯ç”±æƒé™çš„å‡­è¯</li></ul></li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111094334915.png" alt="image-20211212191525037"></p> <ul><li>å…¶æ¬¡ æ˜¯è·¯ç”±æŒ‰é’®(å…ƒç´ )çš„æƒé™ åœ¨ç¬¬äºŒé˜¶æ®µä¸­</li></ul></li></ul> <blockquote><p>å‰ç«¯å‡†å¤‡å·¥ä½œ</p></blockquote> <ul><li>å¦‚æœæˆ‘ä»¬ç”¨çš„æ˜¯<a href="https://panjiachen.github.io/vue-element-admin-site/zh/" target="_blank" rel="noopener noreferrer">vue-element-admin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æ¡†æ¶ å°±å¿…é¡»è¦è¦çŸ¥é“ç™»å½•å’Œæƒé™æµç¨‹</li></ul> <ol start="0"><li><p>äºŒæ¬¡å°è£…ä¸€ä¸ª axiosè¯·æ±‚åº“ <code>request.js</code> (æŒ‰éœ€)</p> <ul><li>éœ€è¦qsåŒ… qsæ˜¯ä¸€ä¸ªurlå‚æ•°è½¬åŒ–ï¼ˆparseå’Œstringifyï¼‰çš„jsåº“</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i qs
</code></pre></div><ul><li>è¿™é‡Œæ˜¯æŒ‰éœ€å°è£… å¦‚æœä½ æœ‰éœ€è¦çš„è¯</li> <li>è¯·æ±‚æ‹¦æˆªå™¨å¾€é‡Œé¢å¡äº†è¯·æ±‚å¤´token</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MessageBox<span class="token punctuation">,</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">'qs'</span>
<span class="token comment">// create an axios instance</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// é»˜è®¤urlåŸºæœ¬è·¯å¾„</span>
  baseURL<span class="token operator">:</span> <span class="token string">'http://42.193.158.170:8089'</span><span class="token punctuation">,</span>
  <span class="token comment">// withCredentials: true, // send cookies when cross-domain requests</span>
  timeout<span class="token operator">:</span> <span class="token number">5000</span> <span class="token comment">// request timeout</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// request interceptor</span>
<span class="token comment">// å‘é€è¯·æ±‚ä¹‹å‰çš„æ‹¦æˆªå™¨</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something before request is sent</span>
    <span class="token comment">// ä»storeé‡Œé¢è·å–tokenï¼Œå¦‚æœtokenå­˜åœ¨ï¼Œ</span>
    <span class="token comment">// æŠŠtokenæ·»åŠ åˆ°è¯·æ±‚çš„å¤´éƒ¨Headersé‡Œé¢</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// let each request carry token</span>
      <span class="token comment">// ['X-Token'] is a custom headers key</span>
      <span class="token comment">// please modify it according to the actual situation</span>
      <span class="token comment">// æŠŠtokenæ·»åŠ åˆ°è¯·æ±‚çš„å¤´éƒ¨</span>
      <span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with request error</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// response interceptor</span>
<span class="token comment">// è¯·æ±‚è¿”å›ä¹‹åçš„æ‹¦æˆªå™¨</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token comment">/**
   * If you want to get http information such as headers or status
   * Please return  response =&gt; response
  */</span>

  <span class="token comment">/**
   * Determine the request status by custom code
   * Here is just an example
   * You can also judge the status by HTTP Status Code
   */</span>
  <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> response<span class="token punctuation">.</span>data
    <span class="token comment">// console.log(response)</span>
    <span class="token comment">// console.log(res)</span>
    <span class="token comment">// if the custom code is not 20000, it is judged as an error.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// éªŒè¯ç å¤„ç†ï¼šè¿”å›çš„æ˜¯arraybuffer,éœ€è¦è½¬è½¦base64</span>
      <span class="token comment">// 1.æŠŠarraybufferè½¬æ¢æˆäºŒè¿›åˆ¶å­—ç¬¦</span>
      <span class="token comment">// 2.æŠŠäºŒè¿›åˆ¶å­—ç¬¦è½¬æ¢ä¸ºbase64 (btoaæ–¹æ³•)å­—ç¬¦ç»™imgä½¿ç”¨</span>
      <span class="token keyword">const</span> indexs <span class="token operator">=</span> response<span class="token punctuation">.</span>config<span class="token punctuation">.</span>responseType
      <span class="token keyword">if</span> <span class="token punctuation">(</span>indexs <span class="token operator">===</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
          <span class="token string">'data:image/png;base64,'</span> <span class="token operator">+</span>
          <span class="token function">btoa</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
              <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> byte</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data <span class="token operator">+</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'æœåŠ¡å™¨å‡ºé”™'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">600</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">50012</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">50014</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// to re-login</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·ç™»å½•ä¿¡æ¯è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•ï¼'</span><span class="token punctuation">,</span> <span class="token string">'ç³»ç»Ÿæç¤º'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          confirmButtonText<span class="token operator">:</span> <span class="token string">'ç™»å½•'</span><span class="token punctuation">,</span>
          cancelButtonText<span class="token operator">:</span> <span class="token string">'å–æ¶ˆ'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'warning'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/resetToken'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'æœåŠ¡å™¨å‡ºé”™'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> error<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'æœåŠ¡å™¨å‡ºé”™'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// è¯·æ±‚æ–¹æ³•</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">post</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">put</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// parm =&gt;  {id:10}</span>
  <span class="token comment">// http://localhost:8089/api/user?id=10</span>
  <span class="token function">get</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      params<span class="token operator">:</span> params<span class="token punctuation">,</span>
      <span class="token function-variable function">paramsSerializer</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// parm =&gt;  {id:10}</span>
  <span class="token comment">// http://localhost:8089/api/user/10</span>
  <span class="token function">getRestApi</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _params
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">'/'</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">// eslint-disable-next-line no-prototype-builtins</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _params <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å»æ‰å‚æ•°æœ€åä¸€ä½?</span>
      _params <span class="token operator">=</span> _params<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_params<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// parm =&gt;  {id:10}</span>
  <span class="token comment">// http://localhost:8089/api/user/10</span>
  <span class="token keyword">delete</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _params
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">'/'</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// eslint-disable-next-line no-prototype-builtins</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _params <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å»æ‰å‚æ•°æœ€åä¸€ä½?</span>
      _params <span class="token operator">=</span> _params<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">upload</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">login</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getImage</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      responseType<span class="token operator">:</span> <span class="token string">'arraybuffer'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> http

</code></pre></div><ul><li>å°è£…å apiè¯·æ±‚çš„æ ¼å¼ <code>api.js</code> <ul><li>äºŒæ¬¡å°è£…axioså æˆ‘ä»¬ç›´æ¥async awite</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'@/utils/requestStudent'</span>

<span class="token comment">// ç™»å½•</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">login</span> <span class="token punctuation">(</span><span class="token parameter">parms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'/api/user/login'</span><span class="token punctuation">,</span> parms<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ä¿¡æ¯</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getInfo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/sysUser/getInfo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è·å–å…¨éƒ¨çš„åŠ¨æ€è·¯ç”±</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getMenuList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/sysUser/getMenuList'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è·å–ç”¨æˆ·åˆ—è¡¨</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUserListApi</span> <span class="token punctuation">(</span><span class="token parameter">parm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">getRestApi</span><span class="token punctuation">(</span><span class="token string">'/api/user/list'</span><span class="token punctuation">,</span> parm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>ç™»å½•å®é™…ä¸Šæ˜¯å†vuexä¸­è¿›è¡Œçš„ é€šè¿‡vuexæ¥è·å–çš„ç™»å½•ä¿¡æ¯(ç”¨æˆ·æ‹¥æœ‰çš„æƒé™é›†åˆ) å’Œ åŠ¨æ€è·¯ç”±ä¿¡æ¯</p> <ul><li>ç™»å½•ä¿¡æ¯(ç”¨æˆ·æ‹¥æœ‰çš„æƒé™é›†åˆ) <code>Vuexä¸­ user.js</code> <ul><li>è¿™é‡Œçš„ <code>login, logout, getInfo</code> å¯ä»¥æ›¿æ¢æˆè‡ªå·±çš„æ¥å£æ•°æ®</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getToken<span class="token punctuation">,</span> setToken<span class="token punctuation">,</span> removeToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> router<span class="token punctuation">,</span> <span class="token punctuation">{</span> resetRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> getInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/students/student'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// é€šè¿‡cookieè·å–token</span>
  token<span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ç”¨æˆ·å</span>
  name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// ç”¨æˆ·å¤´åƒ</span>
  avatar<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// ç”¨æˆ·ç®€ä»‹</span>
  introduction<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// ç”¨æˆ·æ‹¥æœ‰çš„æƒé™é›†åˆ</span>
  roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ç”¨æˆ·id</span>
  userId<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">SET_TOKEN</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> token</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>token <span class="token operator">=</span> token
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_INTRODUCTION</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> introduction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>introduction <span class="token operator">=</span> introduction
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_NAME</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_USERUID</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>userId <span class="token operator">=</span> userId
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_AVATAR</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> avatar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>avatar <span class="token operator">=</span> avatar
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_ROLES</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> roles</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>roles <span class="token operator">=</span> roles
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// user login  ç”¨æˆ·ç™»å½• ç”¨ä½œç”¨æˆ·ç™»å½•</span>
  <span class="token function">login</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> userInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è§£æ„å‡ºç”¨æˆ·åå’Œå¯†ç </span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> userInfo
    <span class="token comment">// è°ƒç”¨promiseæ–¹æ³•ç™»å½•</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è°ƒç”¨api/useré‡Œé¢çš„loginæ–¹æ³•</span>
      <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// ç”¨æˆ·ç™»å½•çš„ä¿¡æ¯</span>
        username<span class="token operator">:</span> username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> password<span class="token punctuation">,</span>
        code<span class="token operator">:</span> code
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token comment">// ç»“æ„token</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> response
        <span class="token comment">// æŠŠåç«¯è¿”å›çš„tokenå­˜åˆ°vuexä¸­</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>
        <span class="token comment">// æŠŠåç«¯è¿”å›çš„tokenå­˜åˆ°cookiesé‡Œé¢</span>
        <span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// get user info è¿™é‡Œæ˜¯è·¯ç”±ä¿¡æ¯</span>
  <span class="token function">getInfo</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> state <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// è°ƒç”¨api/useré‡Œé¢çš„getInfoæ–¹æ³•è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ä¿¡æ¯</span>
      <span class="token function">getInfo</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token comment">// ç»“æ„æ•°æ®</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Verification failed, please Login again.'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token punctuation">{</span> roles<span class="token punctuation">,</span> name<span class="token punctuation">,</span> introduction<span class="token punctuation">,</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> data

        <span class="token comment">// roles must be a non-empty array</span>

        <span class="token comment">// roleså¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>roles <span class="token operator">||</span> roles<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'getInfo: roles must be a non-null array!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æŠŠæƒé™å­—æ®µæ”¾åˆ°sessionStorageé‡Œé¢</span>
        sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'codeList'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// æŠŠroleså­˜åˆ°storeé‡Œé¢</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROLES'</span><span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
        <span class="token keyword">const</span> userImg <span class="token operator">=</span> <span class="token string">'https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif'</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_USERUID'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_NAME'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_AVATAR'</span><span class="token punctuation">,</span> userImg<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_INTRODUCTION'</span><span class="token punctuation">,</span> introduction<span class="token punctuation">)</span>
        <span class="token comment">// console.log(state)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// user logout</span>
  <span class="token comment">// logout ({ commit, state, dispatch }) {</span>
  <span class="token comment">//   return new Promise((resolve, reject) =&gt; {</span>
  <span class="token comment">//     logout(state.token).then(() =&gt; {</span>
  <span class="token comment">//       commit('SET_TOKEN', '')</span>
  <span class="token comment">//       commit('SET_ROLES', [])</span>
  <span class="token comment">//       removeToken()</span>
  <span class="token comment">//       resetRouter()</span>

  <span class="token comment">//       // reset visited views and cached views</span>
  <span class="token comment">//       // to fixed https://github.com/PanJiaChen/vue-element-admin/issues/2485</span>
  <span class="token comment">//       dispatch('tagsView/delAllViews', null, { root: true })</span>

  <span class="token comment">//       resolve()</span>
  <span class="token comment">//     }).catch(error =&gt; {</span>
  <span class="token comment">//       reject(error)</span>
  <span class="token comment">//     })</span>
  <span class="token comment">//   })</span>
  <span class="token comment">// },</span>

  <span class="token comment">// remove token</span>
  <span class="token function">resetToken</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROLES'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// dynamically modify permissions</span>
  <span class="token keyword">async</span> <span class="token function">changeRoles</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">,</span> role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> role <span class="token operator">+</span> <span class="token string">'-token'</span>

    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>
    <span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'getInfo'</span><span class="token punctuation">)</span>

    <span class="token function">resetRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// generate accessible routes map based on roles</span>
    <span class="token keyword">const</span> accessRoutes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'permission/generateRoutes'</span><span class="token punctuation">,</span> roles<span class="token punctuation">,</span> <span class="token punctuation">{</span> root<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// dynamically add accessible routes</span>
    router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>

    <span class="token comment">// reset visited views and cached views</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'tagsView/delAllViews'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> root<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span>

</code></pre></div><ul><li>åŠ¨æ€è·¯ç”±ä¿¡æ¯ <code>Vuexä¸­ permission.js</code> <ul><li>è¿™é‡Œæ˜¯ç”ŸæˆåŠ¨æ€è·¯ç”±çš„å†…å®¹</li> <li><code>permission</code>éå¸¸å…³é”® ä»–ä¼šé€šè¿‡å¾ªç¯å»åˆ¤æ–­ ç”¨æˆ·çš„<code>rolse</code>åˆé›†ä¸­çš„è·¯ç”±æƒé™ æ˜¯å¦å’ŒåŠ¨æ€è·¯ç”±èœå•åŒ¹é… ç„¶åç”Ÿæˆæƒé™åŠ¨æ€è·¯ç”±</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> constantRoutes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getMenuList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/students/student'</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/layout'</span>

<span class="token comment">/**
 * Use meta.role to determine if the current user has permission
 * @param roles
 * @param route
 */</span>
<span class="token keyword">function</span> <span class="token function">hasPermission</span> <span class="token punctuation">(</span><span class="token parameter">roles<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> roles<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">role</span> <span class="token operator">=&gt;</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>roles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Filter asynchronous routing tables by recursion
 * @param routes asyncRoutes
 * @param roles
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">filterAsyncRoutes</span> <span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> roles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// å¾ªç¯æ¯ä¸€ä¸ªè·¯ç”±</span>
  routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(route)</span>
    <span class="token keyword">const</span> tmp <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>route <span class="token punctuation">}</span>
    <span class="token comment">// console.log(tmp)</span>
    <span class="token comment">// åˆ¤æ–­æ˜¯å¦æœ‰æƒé™</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>roles<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> component <span class="token operator">=</span> tmp<span class="token punctuation">.</span>component
      <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>component <span class="token operator">===</span> <span class="token string">'Layout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// å¦‚æœæ˜¯ä¸€çº§</span>
          tmp<span class="token punctuation">.</span>component <span class="token operator">=</span> Layout
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// å¦‚æœæ˜¯äºŒä¸‰çº§ å› ä¸ºåç«¯è¿”å›çš„æ•°æ®æ ¼å¼å¾ˆæ ‡å‡† æ‰€ä»¥åªéœ€è¦è¿™æ ·å†™å³å¯</span>
          tmp<span class="token punctuation">.</span><span class="token function-variable function">component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/views</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>component<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹çº§</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmp<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">filterAsyncRoutes</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(res)</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  addRoutes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">SET_ROUTES</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> routes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>addRoutes <span class="token operator">=</span> routes

    <span class="token comment">// æŠŠè¿‡æ»¤å‡ºæ¥æœ‰æƒé™çš„è·¯ç”±æ·»åŠ åˆ°ä¸éœ€è¦æƒé™çš„è·¯ç”±é‡Œé¢å»</span>
    state<span class="token punctuation">.</span>routes <span class="token operator">=</span> constantRoutes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>routes<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">generateRoutes</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> roles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å­˜çš„æ˜¯æœ‰æƒé™çš„è·¯ç”±ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„</span>
      <span class="token function">getMenuList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token keyword">let</span> accessedRoutes
        <span class="token comment">// åˆ¤æ–­ä¹¦å¦è·å–æˆåŠŸ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// ç”ŸæˆåŠ¨æ€è·¯ç”±èœå•</span>
          accessedRoutes <span class="token operator">=</span> <span class="token function">filterAsyncRoutes</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROUTES'</span><span class="token punctuation">,</span> accessedRoutes<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>accessedRoutes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>è·¯ç”±å®ˆå«ä¹Ÿéœ€è¦å•ç‹¬é…ç½® åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½• å’Œ ä»–æ‰€æ‹¥æœ‰çš„è§’è‰²æƒé™ <code>permission.js</code></p> <ul><li>è¿™é‡Œæ˜¯è·¯ç”±å®ˆå«ä¸­çš„ <code>permission.js</code> ä¸æ˜¯Vuexä¸­çš„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// axiosçš„è·¯ç”±å¯¼èˆªå®ˆå« é…åˆVue-router å®ç°ç™»å½•æƒé™åŠŸèƒ½(åœ¨routerä¸Šè®¾ç½®axioså¯¼èˆªå®ˆå«)</span>
<span class="token comment">// å¯¼å…¥Vue-routeræ–¹æ³• (åœ¨Vueç»„ä»¶å†…éœ€è¦ this.$router ç»„ä»¶å¤–ç›´æ¥router ä½¿ç”¨å³å¯)</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router/index'</span>
<span class="token comment">// å¯¼å…¥Vuex(è·å–å…¶å…¨å±€tokenå€¼)</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index'</span>
<span class="token comment">// ä»cookieè·å– getToken (æš‚æ—¶ä¸ç”¨)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> removeToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span> <span class="token comment">// get token from cookie</span>
<span class="token comment">// åˆ›å»ºä¸€ä¸ªè·¯å¾„ç™½åå• é‡Œé¢å¡«å†™çš„æ˜¯è·¯å¾„ (å…è®¸ç”¨æˆ·æ¸¸å®¢æ¨¡å¼è®¿é—®ä¸€äº›å†…å®¹ æ¯”å¦‚ç™»å½•é¡µ 404 æ²¡å¿…è¦éªŒè¯)</span>
<span class="token keyword">const</span> white <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token string">'/404'</span><span class="token punctuation">]</span>
<span class="token comment">// åˆ›å»ºè·¯ç”±å¯¼èˆªå®ˆå«</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//! è¯»å–Vuexå…¨å±€ç»„ä»¶ åˆ¤æ–­æ˜¯å¦å­˜åœ¨token</span>
  <span class="token comment">// ä»Vuexå…¨å±€ç»„ä»¶ä¸­ è¯»å–ä¿å­˜çš„token(å‚¨å­˜åœ¨gettersé‡Œé¢)</span>
  <span class="token comment">// const token = store.getters.token</span>
  <span class="token comment">//! è¯»å–ç”¨æˆ·çš„token</span>
  <span class="token keyword">const</span> hasToken <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token <span class="token operator">||</span> <span class="token keyword">null</span>
  <span class="token comment">// const userInfo = JSON.parse(localStorage.getItem('userInfo'))</span>
  <span class="token comment">// console.log(hasToken)</span>
  <span class="token comment">// è°ƒç”¨å…¨å±€vuexçš„ç™»å½•(è¿™é‡Œæ˜¯é‡æ–°è°ƒç”¨ å®é™…ä¸Šä¸éœ€è¦é‡æ–°è°ƒç”¨ è°ƒç”¨userInfoå³å¯)</span>
  <span class="token comment">// if (!store.state.userInfo) {</span>
  <span class="token comment">//   store.dispatch('login')</span>
  <span class="token comment">// }</span>
  <span class="token comment">// å¦‚æœå­˜åœ¨token</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœå­˜åœ¨token å¹¶ä¸”å½“å‰åœ¨ç™»å½•é¡µ è®©å…¶è·³è½¬åˆ°ä¸»é¡µ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// to è¡¨ç¤ºè¦è·³è½¬åˆ°å“ªé‡Œå»</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//! å¦‚æœå­˜åœ¨è·¯ç”±æ•°æ®</span>
      <span class="token keyword">const</span> hasRoles <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>roles <span class="token operator">&amp;&amp;</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>roles<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token comment">// tokenè¦åˆ é™¤(è¿™é‡Œé˜²æ­¢å¤šæ¬¡è°ƒç”¨)</span>
      <span class="token comment">// å¦‚æœä¸åœ¨ç™»å½•é¡µé¢ä¸Š ç›´æ¥é€šè¿‡ ä¸åšå¤„ç†(å› ä¸ºå·²ç»ç™»å½•è®¿é—® æ— éœ€å†è·³è½¬)</span>
      <span class="token comment">// è·å–ç”¨æˆ·çš„ä¿¡æ¯(è·¯ç”±èœå•ä¿¡æ¯)</span>
      <span class="token comment">// ä¸ºä»€ä¹ˆéœ€è¦åˆ¤æ–­ç”¨æˆ·ä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼Ÿï¼ˆæˆ‘ä»¬è®¤ä¸ºç™»å½•ç³»ç»Ÿåå·²ç»å¾—åˆ°äº†ç”¨æˆ·ä¿¡æ¯ï¼‰</span>
      <span class="token comment">// ä½†æ˜¯ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯çš„æµç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œè·¯ç”±è®¿é—®æ—¶ï¼Œç”¨æˆ·ä¿¡æ¯å°šæœªè¿”å›</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasRoles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœç”¨æˆ·ä¿¡æ¯å­˜åœ¨ ä¸åšå¤„ç†ç›´æ¥é€šè¿‡</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">//! rolseå¿…é¡»æ˜¯æ•°ç»„ ['admin'] or ,['developer','editor']</span>
          <span class="token comment">// è·å–ç”¨æˆ·ä¿¡æ¯å’Œæƒé™ä¿¡æ¯</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getInfo'</span><span class="token punctuation">)</span>
          <span class="token comment">// generate accessible routes map based on roles</span>
          <span class="token comment">// è·å–åŠ¨æ€ç”Ÿæˆçš„è·¯ç”±æ•°æ®</span>
          <span class="token keyword">const</span> accessRoutes <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'permission/generateRoutes'</span><span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
          <span class="token comment">// console.log(accessRoutes)</span>
          <span class="token comment">// dynamically add accessible routes</span>
          <span class="token comment">// æ·»åŠ åˆ°æˆ‘ä»¬çš„è·¯ç”±</span>
          router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>to<span class="token punctuation">,</span> replace<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è·å–ä¸åˆ°è¿”å›ç™»å½•é¡µ</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
          <span class="token comment">// æ¸…é™¤æ‰€æœ‰ä¿¡æ¯</span>
          localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// æ¸…é™¤cookie</span>
          <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// // å¦‚æœç”¨æˆ·ä¿¡æ¯ä¸å­˜åœ¨ è·å–ç”¨æˆ·çš„ä¿¡æ¯(è°ƒç”¨Vuexé‡Œé¢è·å–ä¿¡æ¯çš„æ–¹æ³•)</span>
        <span class="token comment">// await store.dispatch('user/getInfo') // é‡æ–°è°ƒç”¨Vuexæ–¹æ³•è·å–æ•°æ®</span>
        <span class="token comment">// // awaitä¹‹åæ˜¯å¯ä»¥è·å–ç”¨æˆ·ä¿¡æ¯çš„(ç”¨æˆ·å¯ä»¥è·å–çš„åŠ¨æ€è·¯ç”±)</span>
        <span class="token comment">// const menus = store.state.user.userInfo.roles.menus</span>
        <span class="token comment">// // ä¸‹ä¸€æ­¥é€šè¿‡menusæ§åˆ¶å½“å‰ç”¨æˆ·çš„è·¯ç”±æƒé™</span>
        <span class="token comment">// // æ ¹æ®menusä¿¡æ¯ä»æ‰€æœ‰çš„åŠ¨æ€è·¯ç”±asyncRoutesä¸­è¿‡æ»¤å‡ºè¯¥ç”¨æˆ·æ‰€æ‹¥æœ‰çš„çš„åŠ¨æ€è·¯ç”±ä¿¡æ¯</span>
        <span class="token comment">// // é€šè¿‡actionè¿‡æ»¤ç”¨æˆ·çš„è·¯ç”±æƒé™,æŠŠè·¯ç”±æ˜ å°„ä¿¡æ¯å­˜å‚¨åœ¨storeä¸­</span>
        <span class="token comment">// // actionçš„è¿”å›å€¼è¡¨ç¤ºå½“å‰ç”¨æˆ·æ‰€æ‹¥æœ‰çš„çš„åŠ¨æ€è·¯ç”±</span>
        <span class="token comment">// const myRoutes = await store.dispatch('permission/filterAuth', menus) // menuså‚æ•°æ˜¯ç”¨æˆ·æ‹¥æœ‰çš„åŠ¨æ€è·¯ç”±æƒé™ ä¼ é€’ç»™Vuexè¿›è¡ŒåŠ¨æ€è·¯ç”±ç­›é€‰</span>
        <span class="token comment">// // åŠ¨æ€é…ç½®è·¯ç”±</span>
        <span class="token comment">// // é…ç½®404 å› ä¸º404æ˜¯*è·¯ç”± æ˜¯å…¨å±€åŒ¹é… è¦æœ€åå¯¼å…¥ å…ˆå¯¼å…¥é™æ€+åŠ¨æ€è·¯ç”±çš„æ•´åˆ å†å¯¼å…¥404</span>
        <span class="token comment">// router.addRoutes([...myRoutes, { path: '*', redirect: '/404', hidden: true }])</span>
        <span class="token comment">// // ç»§ç»­è·³è½¬å½“å‰è·¯ç”±</span>
        <span class="token comment">// next({</span>
        <span class="token comment">//   ...to,</span>
        <span class="token comment">//   // ä»…ä»…ä¿ç•™ä¸€ä¸ªè·³è½¬å†å²ï¼ˆå¦‚æœåŠ¨æ€æ·»åŠ è·¯ç”±äº†ï¼Œé‚£ä¹ˆè·¯ç”±éœ€è¦é‡æ–°è®¿é—®ä¸€æ¬¡ï¼Œè¿™æ ·çš„è¯ï¼Œé€šæ ·çš„è·¯å¾„è®¿é—®çš„ä¸¤æ¬¡ï¼Œè·¯ç”±å†å²é‡å¤äº†ï¼Œä¸å‹å¥½ï¼Œæ‰€ä»¥å¯ä»¥æŠŠè¿™ä¸¤ä¸ªåˆå¹¶ä¸ºä¸€ä¸ªï¼‰</span>
        <span class="token comment">//   replace: true</span>
        <span class="token comment">// })</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœä¸å­˜åœ¨token åˆ¤æ–­æ˜¯å¦åœ¨ç™½åå•ä¸­(æ¸¸å®¢å¯ä»¥è®¿é—®çš„è·¯å¾„)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>white<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// includes()æ˜¯æ•°ç»„æ–¹æ³• æ£€æµ‹æ˜¯å¦åŒ…å«æŒ‡å®šå†…å®¹</span>
      <span class="token comment">// åœ¨ç™½åå•é‡Œé¢ï¼Œæ”¾è¡Œé€šè¿‡å³å¯</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœä¸åœ¨ç™½åå•é‡Œé¢ è·³è½¬åˆ°ç™»å½•é¡µé¢</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
      <span class="token comment">// æ¸…é™¤æ‰€æœ‰ä¿¡æ¯</span>
      localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// æ¸…é™¤cookie</span>
      <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="ç¬¬ä¸€é˜¶æ®µ-è·¯ç”±æƒé™çš„å®ç°"><a href="#ç¬¬ä¸€é˜¶æ®µ-è·¯ç”±æƒé™çš„å®ç°" class="header-anchor">#</a> ç¬¬ä¸€é˜¶æ®µ: è·¯ç”±æƒé™çš„å®ç°</h2> <ul><li>æƒé™åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ</li></ul> <ol><li><font color="#ff3040">è·¯ç”±æƒé™Â </font>ä¹Ÿå°±æ˜¯å·¦ä¾§èœå•æ çš„æƒé™ å±äºä¸»ä½“æƒé™ æ˜¯åˆ¤æ–­ç”¨æˆ·æœ‰æƒè®¿é—®è¯¥é¡µé¢çš„æƒé™</li> <li><font color="#ff3040">æŒ‰é’®æƒé™(å…ƒç´ æƒé™)</font> ä¹Ÿå°±æ˜¯è¿›å…¥é¡µé¢å å†…å®¹æ˜¾ç¤ºä¸å¦çš„æƒé™ æ˜¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒçœ‹åˆ°è¯¥å…ƒç´  æˆ–è€…å…·å¤‡æŒ‰é’®ç­‰å…ƒç´ äº¤äº’çš„æƒé™</li></ol> <blockquote><p>ç™»å½•æ¨¡å—æ•°æ®</p></blockquote> <ul><li><p>ç™»å½•æ‰€è·å–çš„æ•°æ® <font color="#ff3040">1. ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ å…¶ä¸­åŒ…å«æƒé™ä¿¡æ¯åˆé›† 2. è·å–åŠ¨æ€è·¯ç”±ä¿¡æ¯ é…åˆæƒé™ä¿¡æ¯åˆé›†</font> é€šè¿‡è·å–åˆ°ç”¨æˆ·çš„æƒé™åˆé›† é…åˆéœ€è¦æƒé™çš„åŠ¨æ€è·¯ç”±ä¿¡æ¯ æ‰èƒ½å®ç° <font color="#ff3040">æŒ‰é’®å’Œè·¯ç”±çš„æƒé™</font></p> <ul><li>ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ å…¶ä¸­åŒ…å«æƒé™ä¿¡æ¯åˆé›†
<ul><li>ç¬¬ä¸€é˜¶æ®µçš„è·¯ç”±æƒé™ åªéœ€è¦ç”¨åˆ°è·¯ç”±æƒé™ ä¸éœ€è¦æŒ‰é’®(å…ƒç´ )çš„æƒé™</li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211212191435998.png" alt="image-20211212191435998"></p> <ul><li>è·¯ç”±åˆé›†æ•°æ®ç±»å‹ä»‹ç»</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110113745507.png" alt="image-20220110113745507"></p> <ul><li>è·å–åŠ¨æ€è·¯ç”±ä¿¡æ¯ é…åˆæƒé™ä¿¡æ¯åˆé›†
<ul><li>ä½ éœ€è¦è®©åç«¯ç”Ÿæˆå…¨éƒ¨<strong>åŠ¨æ€è·¯ç”±èœå•</strong> <font color="#ff3040">æ³¨æ„: å¿…é¡»è®©åç«¯è¿™æ ·åš</font></li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111094334915.png" alt=""></p></li> <li><p>ç™»å½•ä¸ªäººä¿¡æ¯json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%99%BB%E5%BD%95%E5%90%8E%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF.json" target="_blank" rel="noopener noreferrer">ç™»å½•ä¸ªäººä¿¡æ¯json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><strong>åŠ¨æ€è·¯ç”±èœå•</strong>json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">åŠ¨æ€è·¯ç”±èœå•json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <blockquote><p>ç™»å½•æ¨¡å—æµç¨‹</p></blockquote> <ul><li>ç™»å½•åŠŸèƒ½æ•´ä½“æµç¨‹å›¾</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211213085442657.png" alt="image-20211213085442657"></p> <blockquote><p>å‰ç«¯çš„æƒé™åˆ—è¡¨çš„ç»“æ„ (å‚è€ƒç»“æ„)</p></blockquote> <ul><li>è·¯ç”±æ ¼å¼æ–‡ä»¶</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110135137882.png" alt="image-20220110135137882"></p> <ul><li>è·¯ç”±æƒé™ç»“æ„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/nested'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Layout<span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Nested'</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token string">'noRedirect'</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'æœåŠ¡æ¿å—'</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">'nested'</span><span class="token punctuation">,</span>
      roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:serve'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'menuAll'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'Menu0'</span><span class="token punctuation">,</span>
        meta<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">'è®¾å¤‡ç®¡ç†'</span><span class="token punctuation">,</span>
          icon<span class="token operator">:</span> <span class="token string">'el-icon-s-help'</span><span class="token punctuation">,</span>
          affix<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:equipment'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu1'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu1'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'å®¢æˆ·ç®¡ç†'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'kehu'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:client'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu2'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu2'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'å·¥åŒºç®¡ç†'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'clipboard'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:gong'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu3'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu3'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'è®¾å¤‡ç®¡ç†'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'tab'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:device'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'AssemblyChange'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-3/AssemblyChange'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'AssemblyChange'</span><span class="token punctuation">,</span>
            hidden<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'è®¾å¤‡ç®¡ç†ç¼–è¾‘é¡µ'</span><span class="token punctuation">,</span>
              noCache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:device'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'Assemblymanagement'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-4/Assemblymanagement'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Assemblymanagement'</span><span class="token punctuation">,</span>
            hidden<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'æ€»æˆç®¡ç†ç¼–è¾‘é¡µ'</span><span class="token punctuation">,</span>
              noCache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:assy'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu4'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu4'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'æ€»æˆç®¡ç†'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:assy'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="æœºæ„ç®¡ç†æ¨¡å—-éä»£ç "><a href="#æœºæ„ç®¡ç†æ¨¡å—-éä»£ç " class="header-anchor">#</a> æœºæ„ç®¡ç†æ¨¡å—(éä»£ç )</h2> <blockquote><p>å±•ç¤ºæ•ˆæœ(å‰ç«¯)</p></blockquote> <ul><li>æŸ¥è¯¢å‰ç«¯æ ·å¼</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211219175722785.png" alt="image-20211219175722785"></p> <ul><li>æ·»åŠ éƒ¨é—¨çš„å‰ç«¯æ ·å¼</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211231134953873.png" alt=""></p> <blockquote><p>æ•°æ®ä»‹ç»å’Œå…³è”å…³ç³»</p></blockquote> <ul><li><p>ä¸€ä¸ªå…¬å¸ï¼Œä¸‹é¢æœ‰å¤šä¸ªéƒ¨é—¨ï¼Œæ¯ä¸ªéƒ¨é—¨ä¸‹é¢å¯èƒ½è¿˜æœ‰ä¸‹çº§éƒ¨é—¨ï¼Œè¿™äº›éƒ¨é—¨ç»„åˆèµ·æ¥ï¼Œå°±å½¢æˆä¸€ä¸ªæœºæ„ï¼›</p></li> <li><p>é€šå¸¸ä¸€ä¸ªå…¬å¸ï¼Œæœ‰å¾ˆå¤šéƒ¨é—¨ï¼Œå­˜åœ¨ä¸Šä¸‹çº§çš„å…³ç³»ï¼Œæ‰€ä»¥è®¾è®¡æœºæ„ç®¡ç†è¡¨æ—¶ï¼Œè®¾è®¡ä¸ºä¸Šä¸‹çº§å…³ç³»çš„è¡¨ï¼›</p></li></ul> <table><thead><tr><th>å­—æ®µ</th> <th>ç±»å‹</th> <th>å¤‡æ³¨</th></tr></thead> <tbody><tr><td>id</td> <td>int</td> <td>ä¸»é”®</td></tr> <tr><td>pid</td> <td>int</td> <td>ä¸Šçº§éƒ¨é—¨id</td></tr> <tr><td>parent_name</td> <td>varchar(128)</td> <td>ä¸Šçº§éƒ¨é—¨åç§°</td></tr> <tr><td>name</td> <td>varchar(128)</td> <td>éƒ¨é—¨åç§°</td></tr> <tr><td>dept_code</td> <td>varchar(36)</td> <td>éƒ¨é—¨ç¼–ç </td></tr> <tr><td>dept_phone</td> <td>varchar(20)</td> <td>éƒ¨é—¨ç”µè¯</td></tr> <tr><td>dept_address</td> <td>varchar(255)</td> <td>éƒ¨é—¨åœ°å€</td></tr> <tr><td>like_id</td> <td>varchar(255)</td> <td>æ‰€æœ‰ä¸Šçº§éƒ¨é—¨idå’Œè‡ªå·±idçš„é›†åˆï¼Œé€—å·åˆ†éš”å¦‚   1ï¼Œ3ï¼Œ5</td></tr> <tr><td>order_num</td> <td>int</td> <td>åºå·</td></tr> <tr><td>manager</td> <td>varchar(36)</td> <td>éƒ¨é—¨ç»ç†</td></tr></tbody></table> <ul><li><code>like_id</code> è¿™ä¸ªå¾ˆå…³é”® å¯ä»¥é€šè¿‡ä»–å»æŸ¥ä¸Šæœºéƒ¨é—¨idå’Œè‡ªå·±çš„idé›†åˆ
<ul><li>é€‚åˆæŸ¥å½“å‰éƒ¨é—¨ä¸‹çš„æ‰€æœ‰å­—æ®µ å¦åˆ™ä½ éœ€è¦ç”¨é€’å½’çš„æ–¹å¼å»æŸ¥ <code>like_id</code> å¯ä»¥å¾ˆæ–¹ä¾¿çš„å·®æ‰€æœ‰å†…å®¹</li></ul></li></ul> <blockquote><p>æœºæ„ç®¡ç†æ ‘å½¢è¡¨å•çš„ç»“æ„ <code>el-table</code>æ ‘å½¢æ•°æ® æ¥å£</p></blockquote> <ul><li>ä½ éœ€è¦è®©åç«¯æ¥äº†è§£ä½ éœ€è¦å“ªäº›æ•°æ® è¿™äº›æ•°æ®å’Œé¥¿äº†ä¹ˆuiç›¸å¯¹åº”</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211219181333509.png" alt="image-20211219181333509"></p> <ul><li>æœºæ„ç®¡ç†æ ‘å½¢æŸ¥è¯¢çš„ç»“æ„json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%BB%93%E6%9E%84%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">æœºæ„ç®¡ç†æ ‘å½¢ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>æ·»åŠ éƒ¨é—¨æŸ¥è¯¢çš„æ ‘å½¢ç»“æ„ <code>el-tree</code>æ ‘å½¢æ•°æ® æ¥å£</p></blockquote> <ul><li>æ·»åŠ éƒ¨é—¨çš„æ ‘å½¢ç»“æ„json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%9C%BA%E6%9E%84%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">æ·»åŠ éƒ¨é—¨çš„æ ‘å½¢ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211222203357616.png" alt="image-20211222203357616"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211222203213313.png" alt="image-20211222203213313"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211222203236301.png" alt="image-20211222203236301"></p> <blockquote><p>æ·»åŠ éƒ¨é—¨çš„æ¥å£ æ¥å£</p></blockquote> <ul><li>ä»–æ˜¯é€šè¿‡<code>pid</code>(ä¸Šçº§éƒ¨é—¨id) æ¥æ·»åŠ çš„</li></ul> <blockquote><p>åˆ é™¤éƒ¨é—¨ æ¥å£</p></blockquote> <ul><li>åˆ é™¤éƒ¨é—¨æ˜¯æºå¸¦éœ€è¦åˆ é™¤éƒ¨é—¨çš„<code>id</code>(ä¸»é”®id) æ¥è¿›è¡Œåˆ é™¤çš„</li></ul> <blockquote><p>ç¼–è¾‘éƒ¨é—¨ æ¥å£</p></blockquote> <ul><li>ç¼–è¾‘éƒ¨é—¨æ¥å£æ˜¯é€šè¿‡<code>pid</code>(ä¸Šçº§éƒ¨é—¨id)æ¥æŸ¥è¯¢æ·»åŠ çš„</li></ul> <p><font color="#ff3040">æ³¨æ„äº‹é¡¹</font></p> <ul><li>å‰ç«¯åœ¨ç”¨é¥¿äº†ä¹ˆuiçš„æ—¶å€™ ä½¿ç”¨è¿™ç§childrenæ ¼å¼çš„æ•°æ® ä¸€å®šè¦åœ¨ <code>el-table</code>ä¸Šç»‘å®š <code>:tree-props=&quot;{ children: 'children' }&quot;</code> å¦åˆ™æ— æ³•æ¸²æŸ“ <code>children</code>å¯¹åº”çš„åº”è¯¥æ˜¯åç«¯æ‰€è¿”å›çš„åç§°</li></ul> <h2 id="æƒé™ç®¡ç†-éä»£ç "><a href="#æƒé™ç®¡ç†-éä»£ç " class="header-anchor">#</a> æƒé™ç®¡ç†(éä»£ç )</h2> <blockquote><p>å±•ç¤ºæ•ˆæœ(å‰ç«¯)</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227205708768.png" alt="image-20211227205708768"></p> <blockquote><p>æ•°æ®ä»‹ç»å’Œå…³è”å…³ç³»</p></blockquote> <ul><li>æƒé™ç®¡ç†æ˜¯ç²¾ç¡®åˆ°æŒ‰é’®çš„ç®¡ç†å†…å®¹ è¿™é‡Œæ¶‰åŠåˆ°æ¯ä¸ªæ¨¡å—çš„æŒ‰é’®åˆ†é…</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210234355.png" alt="image-20211227210234355"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210259841.png" alt="image-20211227210259841"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210318965.png" alt="image-20211227210318965"></p> <p><font color="#ff3040">æ³¨æ„:Â </font> ä¸€çº§çš„ç±»å‹æ˜¯ <code>ç›®å½•type ä¸º0</code> äºŒçº§çš„ç±»å‹æ˜¯ <code>èœå•type ä¸º1</code> ä¸‰çº§çš„ç±»å‹æ˜¯ <code>æŒ‰é’®type ä¸º3</code></p> <ul><li>ç›®å½•å¯¹åº”çš„æ˜¯è·¯ç”±</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210734657.png" alt=""></p> <ul><li><strong>èœå•å¯¹åº”æ˜¯è·¯ç”±ä¸­çš„å†…å®¹</strong></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210809213.png" alt="image-20211227210809213"></p> <ul><li>æŒ‰é’®æ˜¯è·¯ç”±å†…å®¹ä¸­çš„æŒ‰é’®</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210841368.png" alt="image-20211227210841368"></p> <blockquote><p>æƒé™ç®¡ç†æ ‘å½¢ç»“æ„æŸ¥è¯¢æ¥å£</p></blockquote> <ul><li>æƒé™ç®¡ç†æ ‘å½¢çš„ç»“æ„json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">æœºæ„ç®¡ç†æ ‘å½¢ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>æ·»åŠ æƒé™çš„æ ‘å½¢ç»“æ„ <code>el-tree</code>æ ‘å½¢æ•°æ® æ¥å£</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211228111107856.png" alt="image-20211228111107856"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211228111130731.png" alt="image-20211228111130731"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211228111153740.png" alt="image-20211228111153740"></p> <ul><li>æ·»åŠ æƒé™çš„æ ‘å½¢ç»“æ„ <code>el-tree</code>æ ‘å½¢æ•°æ® æ¥å£ : <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%B7%BB%E5%8A%A0%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%20.json" target="_blank" rel="noopener noreferrer">æ·»åŠ æƒé™çš„æ ‘å½¢ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>æ–°å¢æƒé™ç®¡ç†æŒ‰é’®æ¥å£</p></blockquote> <ul><li>æ–°å¢æƒé™ç®¡ç†æ¥å£ ä¾æ®çš„æ˜¯<code>pid</code>(ä¸Šçº§éƒ¨é—¨id)</li></ul> <blockquote><p>ç¼–è¾‘æƒé™ç®¡ç†æŒ‰é’®æ¥å£</p></blockquote> <ul><li>ç¼–è¾‘æƒé™ç®¡ç†æŒ‰é’®æ¥å£ ä¾æ®çš„æ˜¯ <code>id</code>(ä¸»é”®id)</li></ul> <blockquote><p>åˆ é™¤æƒé™ç®¡ç†æŒ‰é’®æ¥å£</p></blockquote> <ul><li>ä¾æ®çš„æ˜¯ <code>id</code>(ä¸»é”®id)</li></ul> <h2 id="è§’è‰²ç®¡ç†"><a href="#è§’è‰²ç®¡ç†" class="header-anchor">#</a> è§’è‰²ç®¡ç†</h2> <ul><li>è§’è‰²ç®¡ç†æ˜¯æŸ¥çœ‹æ€»ä½“è§’è‰²æœ‰å“ªäº› å¹¶ä¸”æ§åˆ¶å…¶å¯è§è·¯ç”±(ä¸€äºŒçº§)å’Œé¡µé¢å†…å®¹(ä¸‰çº§)</li></ul> <blockquote><p>å±•ç¤ºæ•ˆæœ</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211229182430280.png" alt=""></p> <blockquote><p>è§’è‰²ç®¡ç†æŸ¥è¯¢æ¥å£</p></blockquote> <ul><li>è§’è‰²ç®¡ç†æŸ¥è¯¢æ¥å£çš„ç»“æ„json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E8%A7%92%E8%89%B2%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3.json" target="_blank" rel="noopener noreferrer">è§’è‰²ç®¡ç†æŸ¥è¯¢æ¥å£json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>ç”¨æˆ·åç§° <code>name</code></li> <li>ç”¨æˆ·id <code>id</code></li> <li>ç”¨æˆ·è§’è‰²åˆ›å»ºäººid <code>createUser</code></li></ul></li></ul> <blockquote><p>è§’è‰²ç®¡ç†æ·»åŠ æ¥å£</p></blockquote> <ul><li>æ·»åŠ æ“ä½œéœ€è¦æºå¸¦åˆ›å»ºäººçš„<code>id</code>(å½“å‰ç”¨æˆ·çš„userid)</li></ul> <blockquote><p>è§’è‰²ç®¡ç†åˆ é™¤æ¥å£</p></blockquote> <ul><li>åˆ é™¤æ“ä½œ éœ€è¦æºå¸¦åˆ é™¤çš„è§’è‰²<code>id</code>(è¦åˆ é™¤è§’è‰²çš„id)</li></ul> <h3 id="åˆ†é…æƒé™æ€è·¯"><a href="#åˆ†é…æƒé™æ€è·¯" class="header-anchor">#</a> åˆ†é…æƒé™æ€è·¯</h3> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211230184150455.png" alt="image-20211230184150455"></p> <ul><li>åˆ†é…æƒé™æ˜¯ä¸€ä¸ªéš¾ç‚¹ åˆ†é…æƒé™çš„æ•°æ®æ˜¯é¥¿äº†ä¹ˆuiæ ‘å½¢å‹¾é€‰ç»“æ„ éœ€è¦æºå¸¦ä»¥ä¸‹æ•°æ®:
<ul><li><code>roleId</code> ä¸ºæŸ¥è¯¢çš„è§’è‰²id</li> <li><code>userId</code> ä¸ºå½“å‰ç”¨æˆ·çš„è§’è‰²id å› ä¸ºè§’è‰²idè¦ä½œä¸ºå¯åˆ†é…çš„ä¸€ä¸ªç­›é€‰æ¡ä»¶
<ul><li>ä¹Ÿå°±æ˜¯è¯´ å½“å‰è§’è‰²æƒé™ä¸èƒ½ä¿®æ”¹æ¯”ä»–è‡ªèº«å¤§çš„æƒé™ æ ‘å½¢ç»“æ„æ•°æ®åªèƒ½è¿”å›å½“å‰è§’è‰²æ‰€æ‹¥æœ‰çš„çš„æƒé™ è‡ªèº«æ²¡æœ‰çš„èƒ½ä¸è¿”å›æ˜¾ç¤º</li></ul></li></ul></li> <li>åˆ†é…æƒé™æŸ¥è¯¢æ¥å£æœ‰ä¸¤ä¸ªå†…å®¹</li></ul> <ol><li><code>checkList</code> å½“å‰ç”¨æˆ·é‚£äº›æƒé™ä¸ºé€‰ä¸­çŠ¶æ€(æ‹¥æœ‰çš„æƒé™) (æƒé™é€‰ä¸­æ•°ç»„)</li> <li><code>listmenu</code>å½“å‰è§’è‰²ç”¨æˆ·é€‰ä¸­æƒé™çš„idåˆé›† (æƒé™é€‰ä¸­æ•°ç»„)</li></ol> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211230191712030.png" alt="image-20211230191712030"></p> <ul><li>é€šè¿‡<code>checkList</code>å‚¨å­˜çš„å€¼ å»åŒ¹é…<code>listmenu</code>é‡Œé¢çš„idå€¼ è¿™æ ·å°±å¯ä»¥çŸ¥é“è¯¥ç”¨æˆ·å‹¾é€‰äº†é‚£äº›æƒé™ (æƒé™é€‰ä¸­æ•°ç»„)
<ul><li><font color="#ff3040">æ³¨æ„: å¿…é¡»è®©åç«¯åœ¨æ‰€æœ‰å±‚çº§ä¸­è¿”å›è¿™ä¸ªç©º open æœ€ä¸ºä¸€æ¬¡éå†æ˜¯å¦ä¸ºæœ«çº§çš„æ ¹æ®</font></li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211231102028411.png" alt="image-20211231102028411"></p> <ul><li>åˆ†é…æƒé™æŸ¥è¯¢æ¥å£ç»“æ„: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">åˆ†é…æƒé™æŸ¥è¯¢æ¥å£ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="åˆ†é…æƒé™é€’å½’ä»£ç "><a href="#åˆ†é…æƒé™é€’å½’ä»£ç " class="header-anchor">#</a> åˆ†é…æƒé™é€’å½’ä»£ç </h3> <ul><li>åˆ†é…æƒé™å¦‚æœå‰ç«¯å¤„ç†çš„è¯ éœ€è¦ä¸¤æ¬¡é€’å½’(è®¾ç½®å›é€‰) è¿™æ ·æ‰èƒ½å®ç°ç¬¦åˆæ¡ä»¶çš„æƒé™å‹¾é€‰çŠ¶æ€</li></ul> <ol><li><p>ç¬¬ä¸€æ¬¡é€’å½’éœ€è¦åˆ¤æ–­æƒé™å¯¹è±¡ä¸­<code>children</code>(å±‚çº§) æ˜¯å¦ä¸ºæœ«çº§</p> <ul><li>åç«¯ä¼šåœ¨æ¯ä¸ªå±‚çº§å†… æ”¾å…¥<code>open</code>ç©ºå­—æ®µ å‰ç«¯é€’å½’å¤„ç† éæœ«çº§ä¸ºfalse æœ«çº§ä¸ºtrue</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åˆ¤æ–­æƒé™æ•°ç»„å¯¹è±¡childrenæ˜¯å¦æ˜¯æœ«çº§</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">leafUtils</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é€’å½’å‡½æ•° ç­›é€‰setLeafæ•°ç»„å¯¹è±¡</span>
    <span class="token keyword">const</span> <span class="token function-variable function">setLeaf</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ•°ç»„å¯¹è±¡ å¹¶ä¸”æ•°ç»„å¯¹è±¡é•¿åº¦ä¸å°äº0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¾ªç¯æ•°ç»„å¯¹è±¡å†…çš„å­—æ®µ è¿›è¡Œæ“ä½œ</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ¤æ–­æ•°ç»„å¯¹è±¡ä¸­ æ˜¯å¦å«æœ‰childrenå­—æ®µ å¹¶ä¸”é•¿åº¦ä¸å°äº0</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å¦‚æœæ»¡è¶³è¯¥æ¡ä»¶ åˆ™æŠŠopenå­—æ®µè®¾ç½®ä¸ºfalse</span>
                    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token comment">// å†æ¬¡è‡ªå·±è°ƒç”¨è‡ªå·± å®ç°é€’å½’å‡½æ•°</span>
                    <span class="token function">setLeaf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// å¦‚æœä¸æ»¡è¶³æ¡ä»¶ åˆ™æŠŠopenå­—æ®µè®¾ç½®ä¸ºtrue</span>
                    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// è¿”å›é€’å½’å¤„ç†åçš„æ•°æ® (éœ€è¦å†æ¬¡returnä¸€æ¬¡ æŠŠå¤„ç†çš„é€’å½’æ•°æ®å¯¼å‡º)</span>
        <span class="token keyword">return</span> arr
    <span class="token punctuation">}</span>
    <span class="token comment">// å†æ¬¡returnä¸€æ¬¡ æŠŠå¤„ç†å¥½çš„é€’å½’æ•°æ®å‚¨å­˜åˆ°å£°æ˜å˜é‡ä¸­ å¹¶ä¸”ä»¥å¯¹è±¡æ–¹å¼å¯¼å‡º</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        setLeaf
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>ç¬¬äºŒæ¬¡é€’å½’æŠŠç¬¬ä¸€æ¬¡é€’å½’å¤„ç†å¥½çš„æ•°æ®(æ·»åŠ äº†æœ«çº§çŠ¶æ€) æ‹¿æ¥åå†æ¬¡é€’å½’</p> <ul><li>é€šè¿‡<code>checkList</code> å½“å‰è§’è‰²ç”¨æˆ·é€‰ä¸­æƒé™çš„<code>id</code>åˆé›† (æƒé™é€‰ä¸­æ•°ç»„) æ¥åŒ¹é…æ ‘å½¢ç»“æ„ä¸­çš„<code>id</code> å¦‚æœç¬¦åˆ å°±è®©å…¶å¤„äºå‹¾é€‰çŠ¶æ€</li> <li>ç¬¬ä¸€æ¬¡é€’å½’ä¼šè®¾ç½®æœ«çº§çŠ¶æ€ä½ åœ¨äºŒæ¬¡é€’å½’çš„æ—¶å€™ è¿›è¡Œåˆ¤æ–­ å¦‚æœä¸ºæœ«çº§ å°±<code>break</code>æ‰“æ–­</li> <li><code>childNodes[å¾ªç¯ç´¢å¼•å€¼].children</code> åªè¦èŠ‚ç‚¹å«æœ‰å±‚çº§ å°±æŠŠæ¯å±‚è¿›è¡Œé€’å½’å¤„ç†</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æœ«çº§çš„jsæ–¹æ³•</span>
<span class="token keyword">import</span> leafUtils <span class="token keyword">from</span> <span class="token string">'@/utils/leafUtils'</span>    
<span class="token comment">// åˆ†é…æƒé™çš„å±æ€§ç»“æ„æŸ¥è¯¢ å¤„ç†æ•°æ® èƒ½å®ç°æƒé™å‹¾é€‰</span>
  <span class="token keyword">async</span> <span class="token function">assignRole</span> <span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// é˜²æ­¢thisæŒ‡å‘çš„ä¸æ˜¯vueå®ä¾‹å¯¹è±¡</span>
      <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>roleId <span class="token operator">=</span> row<span class="token punctuation">.</span>id
      <span class="token keyword">const</span> parm <span class="token operator">=</span> <span class="token punctuation">{</span>
        roleId<span class="token operator">:</span> row<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        userId<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>userId
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAssignTreeApi</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å½“å‰ç™»å½•ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æ‰€æœ‰æƒé™</span>
        <span class="token keyword">const</span> menuList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>listmenu
        <span class="token comment">// å½“å‰è¢«åˆ†é…çš„è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™</span>
        <span class="token keyword">const</span> selectIds <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>checkList
        <span class="token comment">// è¿›è¡Œä¸€æ¬¡é€’å½’ æå–å‡ºæœ«çº§çš„é€’å½’æ–¹æ³•å˜é‡</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> setLeaf <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">leafUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// åˆ¤æ–­æ˜¯å¦æœ«çº§(è®¾ç½®æœ«çº§çŠ¶æ€ä½) setLeafå®é™…ä¸Šæ˜¯é€’å½’çš„æ–¹æ³•</span>
        <span class="token keyword">const</span> newMenuList <span class="token operator">=</span> <span class="token function">setLeaf</span><span class="token punctuation">(</span>menuList<span class="token punctuation">)</span>
        <span class="token comment">// æŠŠå¤„ç†å¥½çš„æœ«çº§æ ‘å½¢ç»“æ„èµ‹å€¼ç»™é¡µé¢ æ¸²æŸ“å‡ºæ¥(éœ€æ›¿æ¢æˆè‡ªå·±çš„)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>assignTreeData <span class="token operator">=</span> newMenuList
        <span class="token comment">// å‡†å¤‡ç¬¬äºŒæ¬¡é€’å½’ å‹¾é€‰æ ‘å½¢ç»“æ„çš„å†…å®¹</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// è¿™é‡Œé€šè¿‡refç»‘å®šå¤„ç†å¥½æœ«çº§çš„æ ‘å½¢ç»“æ„ æ³¨æ„è¦this.$nextTickæ¸²æŸ“åå†è°ƒç”¨ nodesæ˜¯é€šè¿‡vueå®ä¾‹æ‹¿åˆ°çš„æ¸²æŸ“å¥½çš„æ ‘å½¢ç»“æ„</span>
          <span class="token keyword">const</span> nodes <span class="token operator">=</span> that<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span>children
          <span class="token comment">// è¿›è¡Œç¬¬äºŒæ¬¡é€’å½’å¤„ç† nodesæ˜¯é€šè¿‡vueå®ä¾‹æ‹¿åˆ°çš„æ ‘å½¢ç»“æ„ selectIdsæ˜¯å½“å‰è§’è‰²ç”¨æˆ·é€‰ä¸­æƒé™çš„idåˆé›† (æƒé™é€‰ä¸­æ•°ç»„) thatæ˜¯å½“å‰å†…å®¹çš„thisæŒ‡å‘ é˜²æ­¢thisæŒ‡é”™</span>
          that<span class="token punctuation">.</span><span class="token function">setChild</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> selectIds<span class="token punctuation">,</span> that<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// æ‰“å¼€å¼¹å‡ºå±‚(éœ€æ›¿æ¢æˆè‡ªå·±çš„)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>assignDialog<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>assignDialog<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'ä¸ºã€'</span> <span class="token operator">+</span> row<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'ã€‘åˆ†é…æƒé™'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token function">setChild</span> <span class="token punctuation">(</span><span class="token parameter">childNodes<span class="token punctuation">,</span> selectIds<span class="token punctuation">,</span> that</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è¿™é‡Œä¸è¦ä½¿ç”¨this è¦ä½¿ç”¨ä¸Šä¸ªæ–¹æ³•ä¼ æ¥çš„that ä»¥é˜²æ­¢thisæŒ‡å‘é”™è¯¯</span>
      <span class="token comment">// åˆ¤æ–­æ ‘å½¢ç»“æ„æ˜¯å¦å­˜åœ¨ä¸”ä¸å°äº0</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes <span class="token operator">&amp;&amp;</span> childNodes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// eslint-disable-next-line no-lone-blocks</span>
        <span class="token comment">// éå†æ ‘å½¢ç»“æ„ éœ€è¦è°ƒç”¨element getNode()æ–¹æ³• æ‹¿åˆ°æ¯ä¸ªnode (æ¯ä¸ªèŠ‚ç‚¹çš„å†…å®¹ ä¹Ÿå°±æ˜¯åŒ…å«ä¸€çº§äºŒçº§ä¸‰çº§éƒ½æ‹¿å‡ºæ¥)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// æ‹¿åˆ°æ ‘å½¢ç»“æ„ä¸­çš„æ¯ä¸ªnode (æ¯ä¸ªèŠ‚ç‚¹çš„å†…å®¹ ä¹Ÿå°±æ˜¯åŒ…å«ä¸€çº§äºŒçº§ä¸‰çº§éƒ½æ‹¿å‡ºæ¥)</span>
          <span class="token keyword">var</span> node <span class="token operator">=</span> that<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token comment">// åˆ¤æ–­(æƒé™é€‰ä¸­æ•°ç»„)æ˜¯å¦å­˜åœ¨ ä¸”é•¿åº¦ä¸å°äº0</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>selectIds <span class="token operator">&amp;&amp;</span> selectIds<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// éå†(æƒé™é€‰ä¸­æ•°ç»„) é‚£å­˜å‚¨çš„æ‰€æœ‰æƒé™é€‰ä¸­id å»æ ‘å½¢ç»“æ„æ¯ä¸ªèŠ‚ç‚¹ä¸­çš„idå…¶åŒ¹é…</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> selectIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// å¦‚æœåŒ¹é…åˆ°äº†ç›¸åŒçš„id è¯´æ˜å…·å¤‡è¯¥æƒé™ éœ€è¦å¤„äºé€‰ä¸­çŠ¶æ€</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>selectIds<span class="token punctuation">[</span>h<span class="token punctuation">]</span> <span class="token operator">==</span> childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿™é‡Œæ¥åˆ¤æ–­æ˜¯å¦ä¸ºæœ«çº§ (é€šè¿‡ç¬¬ä¸€æ¬¡éå†ä¿®æ”¹opençŠ¶æ€)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// é€šè¿‡è°ƒç”¨element setChecked()æ–¹æ³• æŠŠæœªå‹¾é€‰å˜æˆå·²å‹¾é€‰çŠ¶æ€ nodeæ˜¯ä¸€çº§äºŒçº§ä¸‰çº§éƒ½æ‹¿å‡ºæ¥</span>
                  that<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">setChecked</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                  <span class="token comment">// ä¸ç”¨returnè¿”å› æ‰“æ–­å³å¯</span>
                  <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// è¿™é‡Œè¿›è¡Œåˆ¤æ–­ å¦‚æœèŠ‚ç‚¹å­˜åœ¨children(äºŒçº§ä¸‰çº§) å°±ç»§ç»­é€’å½’</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æºå¸¦æ‰€éœ€è¦çš„å‚æ•°childNodes[j](æ¯å±‚æ•°æ®) selectIds(æƒé™é€‰ä¸­æ•°ç»„) that(å½“å‰æŒ‡å‘)</span>
            that<span class="token punctuation">.</span><span class="token function">setChild</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span> selectIds<span class="token punctuation">,</span> that<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="æƒé™åˆ†é…æäº¤æŒ‰é’®"><a href="#æƒé™åˆ†é…æäº¤æŒ‰é’®" class="header-anchor">#</a> æƒé™åˆ†é…æäº¤æŒ‰é’®</h3> <ul><li>åˆ†é…è§’è‰²çš„æ ‘å½¢ç»“æ„å®é™…ä¸Šæäº¤çš„æ˜¯å‹¾é€‰ä¸Šå†…å®¹(å±‚çº§)çš„id å®ƒåˆ†ä¸ºä¸¤ç§id</li></ul> <ol><li>å…¨å‹¾é€‰ å…¨å‹¾é€‰idä¸ºè·¯ç”±é‡ŒæŒ‰é’®ç­‰å…ƒç´ çš„id ä»–æ²¡æœ‰ä¾èµ–å…³ç³» æ‰€ä»¥ç›´æ¥å‹¾é€‰å³å¯</li> <li>åŠå‹¾é€‰ åŠå‹¾é€‰æ˜¯è·¯ç”± å› ä¸ºè·¯ç”±é‡ŒæŒ‰é’®ç­‰å…ƒç´ è¢«å‹¾é€‰å è·¯ç”±å¤„äºä¸€ä¸ªåŠå‹¾é€‰çŠ¶æ€ é™¤éä»–å­—å†…å®¹å®Œå…¨å‹¾é€‰ æ‰ä¼šæˆä¸ºå…¨å‹¾é€‰
<ul><li>æ‰€ä»¥å…¨å‹¾é€‰ å’Œ åŠå‹¾é€‰ ä»–éƒ½éœ€è¦æäº¤ è¿™å°±éœ€è¦ä½¿ç”¨ é¥¿äº†ä¹ˆuiçš„ä¸¤ä¸ªæ–¹æ³•
<ul><li><code>getCheckedKeys()</code>è·å–å…¨å‹¾é€‰ç»‘å®šçš„ <code>node-key</code></li> <li><code>getHalfCheckedKeys()</code>è·å–åŠå‹¾é€‰ç»‘å®šçš„ <code>node-key</code></li></ul></li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>      <span class="token comment">// è·å–ç»‘å®šnode-keyçš„å€¼(ä¸€èˆ¬ä¸ºæ¡ç›®çš„idå€¼) getCheckedKeysæ˜¯è·å–å‹¾é€‰çš„id getHalfCheckedKeysæ˜¯è·å–åŠå‹¾é€‰çš„å†…å®¹ (åŠå‹¾é€‰æ˜¯è·¯ç”±æƒé™ é‡Œé¢å‹¾é€‰çš„æ˜¯æŒ‰é’®ç­‰å…ƒç´ æƒé™ ä¸¤è€…éƒ½éœ€è¦è·å–åˆ°)</span>
      <span class="token comment">// é€šè¿‡concat()æ–¹æ³•æŠŠä¸¤ä¸ªæ•°ç»„æ‹¼æ¥èµ·æ¥</span>
      <span class="token keyword">const</span> listId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">getCheckedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">getHalfCheckedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// è¿™é‡Œæ˜¯å…¨å‹¾é€‰å’ŒåŠå‹¾é€‰å…¨éƒ¨çš„åˆé›†å†…å®¹</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>listId<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æƒé™åˆ†é…æäº¤æŒ‰é’®æ¥å£</p></blockquote> <ul><li>éœ€è¦ç»™åç«¯ä¼ é€’ åˆ†é…æƒé™çš„æ•°ç»„(å…¨å‹¾é€‰å’ŒåŠå‹¾é€‰)</li> <li>è¿˜éœ€è¦ä¼ é€’ ä¿®æ”¹äººçš„<code>userid</code></li></ul> <h2 id="ç”¨æˆ·ç®¡ç†-éä»£ç "><a href="#ç”¨æˆ·ç®¡ç†-éä»£ç " class="header-anchor">#</a> ç”¨æˆ·ç®¡ç† (éä»£ç )</h2> <ul><li>ç”¨æˆ·ç®¡ç†æ˜¯æŸ¥çœ‹æ‰€å±éƒ¨é—¨ä¸‹çš„æ‰€æœ‰ç”¨æˆ·æƒé™ å±äºä¸€ä¸ªæ€»ä½“æµè§ˆ çœ‹çœ‹åˆ°åº•è¯¥éƒ¨é—¨æœ‰å¤šå°‘æƒé™</li> <li>ç”¨æˆ·ç®¡ç†ä¸ºäºŒåˆä¸€ å·¦ä¾§èœå•æ  æ˜¾ç¤ºæ¯ä¸ªå±‚çº§éƒ¨é—¨</li></ul> <blockquote><p>æ˜¾ç¤ºæ•ˆæœ</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211231174020671.png" alt=""></p> <h3 id="ç”¨æˆ·ç®¡ç†å·¦ä¾§èœå•"><a href="#ç”¨æˆ·ç®¡ç†å·¦ä¾§èœå•" class="header-anchor">#</a> ç”¨æˆ·ç®¡ç†å·¦ä¾§èœå•</h3> <ul><li>ç”¨æˆ·ç®¡ç†ä¸ºäºŒåˆä¸€ å·¦ä¾§èœå•æ æ˜¯æ˜¾ç¤ºæ¯ä¸ªå±‚çº§éƒ¨é—¨å¹¶ä¸”é€‰ä¸­åå³ä¾§æ˜¾ç¤ºå¯¹åº”çš„è§’è‰²æƒé™</li></ul> <blockquote><p>å±•ç¤ºæ•ˆæœ</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111203308636.png" alt="image-20220111203308636"></p> <blockquote><p>ç”¨æˆ·ç®¡ç†å·¦ä¾§èœå•æ•°æ®ç»“æ„</p></blockquote> <ul><li>ç”¨æˆ·ç®¡ç†å·¦ä¾§èœå•æ•°æ®ç»“æ„json:  <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">ç”¨æˆ·ç®¡ç†å·¦ä¾§èœå•æ•°æ®ç»“æ„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>è¿™é‡Œå®é™…ä¸Šå’Œ <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%BB%93%E6%9E%84%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">æœºæ„ç®¡ç†æ ‘å½¢ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç»“æ„æ˜¯ä¸€è‡´çš„ éƒ½æ˜¯æ ‘å½¢ç»“æ„ ä¸€å±‚ä¸€å±‚çš„</li></ul> <h3 id="ç”¨æˆ·ç®¡ç†å³ä¾§èœå•"><a href="#ç”¨æˆ·ç®¡ç†å³ä¾§èœå•" class="header-anchor">#</a> ç”¨æˆ·ç®¡ç†å³ä¾§èœå•</h3> <ul><li>å³ä¾§èœå•å±•ç¤ºçš„æ˜¯è¯¥éƒ¨é—¨ä¸‹çš„æ‰€æœ‰çš„ç”¨æˆ·</li></ul> <blockquote><p>å±•ç¤ºæ•ˆæœ</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111202655929.png" alt="image-20220111202655929"></p> <blockquote><p>ç”¨æˆ·ç®¡ç†å³ä¾§èœå•æ•°æ®ç»“æ„</p></blockquote> <ul><li><p>éœ€è¦ç»™åç«¯ä¼ é€’æ‰€é€‰éƒ¨é—¨çš„ <code>id</code></p></li> <li><p>ç”¨æˆ·ç®¡ç†å³ä¾§èœå•æ•°æ®ç»“æ„json:  <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E5%8F%B3%E4%BE%A7%E8%A7%92%E8%89%B2%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.json" target="_blank" rel="noopener noreferrer">ç”¨æˆ·ç®¡ç†å³ä¾§èœå•æ•°æ®ç»“æ„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <blockquote><p>ç”¨æˆ·ç®¡ç†æ–°å¢å³ä¾§èœå•ç”¨æˆ·æ•°æ®</p></blockquote> <ul><li>è¿™é‡Œæ˜¯ç®¡ç†ç”¨æˆ·çš„æ¨¡å— å¯ä»¥ä¿®æ”¹éƒ¨é—¨ è´¦å·å¯†ç ç­‰ç­‰</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220105210852891.png" alt="image-20220105210852891"></p> <blockquote><p>ç”¨æˆ·ç®¡ç†ç¼–è¾‘å³ä¾§èœå•ç”¨æˆ·æ•°æ®</p></blockquote> <ul><li>è¿™é‡Œéœ€è¦æºå¸¦ç¼–è¾‘æ¡ç›®çš„<code>id</code></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220105211047641.png" alt="image-20220105211047641"></p> <blockquote><p>ç”¨æˆ·ç®¡ç† ç¼–è¾‘å’Œæ·»åŠ æ‰€å±éƒ¨é—¨æ ‘å½¢ç»“æ„æ•°æ®</p></blockquote> <ul><li>å’Œæƒé™ç®¡ç†çš„æ‰€å±éƒ¨é—¨æ•°æ®ä¸€æ · éƒ½æ˜¯æ ‘å½¢ç»“æ„:  <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E7%BC%96%E8%BE%91%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%89%80%E5%B1%9E%E9%83%A8%E9%97%A8%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE.json" target="_blank" rel="noopener noreferrer">éƒ¨é—¨ç®¡ç†ç¼–è¾‘å’Œæ·»åŠ æ‰€å±éƒ¨é—¨æ ‘å½¢ç»“æ„æ•°æ®æ ¼å¼<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>ç¼–è¾‘è¿™é‡Œéœ€è¦æºå¸¦ <code>pid</code>(å½“å‰ç‚¹å‡»çš„éƒ¨é—¨id) ç»™åç«¯ åœ¨ç‚¹å‡»çš„éƒ¨é—¨ä¸‹ åˆ›å»ºç”¨æˆ·</li> <li>ä¿®æ”¹è¿™é‡Œéœ€è¦æºå¸¦ <code>id</code>(è¦ä¿®æ”¹æ¡ç›®çš„id)ç»™åç«¯ ä¿®æ”¹å¯¹åº”çš„æ¡ç›®æ•°æ®</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220106194736422.png" alt="image-20220106194736422"></p> <blockquote><p>ç”¨æˆ·ç®¡ç† åˆ é™¤æ‰€å±éƒ¨é—¨ä¸‹çš„ç”¨æˆ·ä¿¡æ¯</p></blockquote> <ul><li>è¿™é‡Œåˆ†ä¸ºçœŸåˆ å‡åˆ  æ ¹æ®ä¸šåŠ¡ éœ€è¦æºå¸¦ <code>id</code>ç»™åç«¯ åˆ é™¤å¯¹åº”çš„æ¡ç›®æ•°æ®</li></ul> <h3 id="ç”¨æˆ·ç®¡ç†å³ä¾§èœå•åˆ†é…è§’è‰²å±•ç¤ºæ•ˆæœ"><a href="#ç”¨æˆ·ç®¡ç†å³ä¾§èœå•åˆ†é…è§’è‰²å±•ç¤ºæ•ˆæœ" class="header-anchor">#</a> ç”¨æˆ·ç®¡ç†å³ä¾§èœå•åˆ†é…è§’è‰²å±•ç¤ºæ•ˆæœ</h3> <ul><li>é€šè¿‡è·å–åˆ°æ‰€æœ‰ç”¨æˆ·çš„è§’è‰²å†…å®¹å ç›¸å¯¹çš„ä¹Ÿèƒ½è·å–åˆ°ç”¨æˆ·çš„<code>id</code> è¿™æ ·å¯ä»¥é€šè¿‡<code>id</code>æ¥æŸ¥è¯¢ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰² ä¹Ÿå¯ä»¥åˆ†é…å¯¹åº”çš„è§’è‰²</li> <li>è¿™é‡Œæ˜¯è®¾è®¡çš„æ—¶å€™åªèƒ½è·å–å•ä¸ªè§’è‰² å¦‚æœå¤šè§’è‰²ä¹Ÿå¯ä»¥å®ç°</li></ul> <blockquote><p>å±•ç¤ºæ•ˆæœ</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220107194042859.png" alt="image-20220107194042859"></p> <blockquote><p>å®ç°æ€è·¯</p></blockquote> <ul><li><p>éœ€è¦ä¸¤ä¸ªæ¥å£</p> <ol><li><p>å…ˆæŸ¥è¯¢å½“å‰æ‰€åˆ›å»ºçš„æ‰€æœ‰è§’è‰² æ¸²æŸ“åˆ°é¡µé¢ä¸Š</p></li> <li><p>å†æŸ¥è¯¢å½“å‰è§’è‰²æ‰€æ‹¥æœ‰çš„è§’è‰² ç„¶åèµ‹å€¼ åœ¨é¡µé¢ä¸Šè¿›è¡Œå‹¾é€‰å±•ç¤º</p></li></ol></li></ul> <blockquote><p>æŸ¥è¯¢å½“å‰æ‰€åˆ›å»ºçš„æ‰€æœ‰è§’è‰²</p></blockquote> <ul><li>æŸ¥è¯¢å½“å‰æ‰€åˆ›å»ºçš„æ‰€æœ‰è§’è‰²æ•°æ®æ ¼å¼: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E6%89%80%E5%88%9B%E5%BB%BA%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%92%E8%89%B2%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.json" target="_blank" rel="noopener noreferrer">æŸ¥è¯¢å½“å‰æ‰€åˆ›å»ºçš„æ‰€æœ‰è§’è‰²æ•°æ®æ ¼å¼json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220107205325700.png" alt="image-20220107205325700"></p> <blockquote><p>æŸ¥è¯¢å½“å‰è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™è§’è‰² (æœ¬é¡¹ç›®ä¸ºåªèƒ½æ‹¥æœ‰ä¸€ä¸ªæƒé™è§’è‰²)</p></blockquote> <ul><li>æºå¸¦ç”¨æˆ·çš„ <code>userid</code> æ¥æŸ¥è¯¢ç”¨æˆ·å½“å‰æ‹¥æœ‰çš„æƒé™è§’è‰² ç„¶åæ ¹æ®<code>roleId</code>å»tabä¸­åŒ¹é… ç¬¦åˆæ¡ä»¶çš„å‹¾é€‰</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110094250932.png" alt="image-20220110094250932"></p> <blockquote><p>ä¿®æ”¹å½“å‰è§’è‰²çš„æƒé™è§’è‰²</p></blockquote> <ul><li>æºå¸¦ç”¨æˆ·çš„<code>userid</code>å’Œç”¨æˆ·æ‰€é€‰çš„<code>roleId</code> æäº¤è¡¨å• ä¿®æ”¹ç”¨æˆ·çš„æƒé™è§’è‰²</li></ul> <h2 id="ç¬¬äºŒé˜¶æ®µ-æŒ‰é’®æƒé™-å…ƒç´ æƒé™-çš„å®ç°"><a href="#ç¬¬äºŒé˜¶æ®µ-æŒ‰é’®æƒé™-å…ƒç´ æƒé™-çš„å®ç°" class="header-anchor">#</a> ç¬¬äºŒé˜¶æ®µ: æŒ‰é’®æƒé™ (å…ƒç´ æƒé™)çš„å®ç°</h2> <ul><li>æƒé™åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ</li></ul> <ol><li><font color="#ff3040">è·¯ç”±æƒé™Â </font>ä¹Ÿå°±æ˜¯å·¦ä¾§èœå•æ çš„æƒé™ å±äºä¸»ä½“æƒé™ æ˜¯åˆ¤æ–­ç”¨æˆ·æœ‰æƒè®¿é—®è¯¥é¡µé¢çš„æƒé™</li> <li><font color="#ff3040">æŒ‰é’®æƒé™ (å…ƒç´ )</font> ä¹Ÿå°±æ˜¯è¿›å…¥é¡µé¢å å†…å®¹æ˜¾ç¤ºä¸å¦çš„æƒé™ æ˜¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒçœ‹åˆ°è¯¥å…ƒç´  æˆ–è€…å…·å¤‡æŒ‰é’®ç­‰å…ƒç´ äº¤äº’çš„æƒé™</li></ol> <blockquote><p>æŒ‰é’®æƒé™ (å…ƒç´ æƒé™)çš„æ€è·¯</p></blockquote> <ul><li>è·¯ç”±åˆé›†æ•°æ®ç±»å‹ä»‹ç»</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110113745507.png" alt="image-20220110113745507"></p> <ol><li><p>ç¬¬ä¸€æ­¥ é¦–å…ˆæˆ‘ä»¬ç™»å½•åå¯ä»¥æ‹¿åˆ°ç”¨æˆ·çš„æƒé™åˆé›†<code>roles</code> æƒé™åˆé›†ä¸­åŒ…å«ç€ è·¯ç”±å’ŒæŒ‰é’®çš„æƒé™ æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŒ‰é’®çš„æƒé™</p></li> <li><p>ç¬¬äºŒæ­¥ æˆ‘ä»¬æ‹¿åˆ°ç”¨æˆ·çš„æƒé™åˆé›†å æŠŠæƒé™åˆé›†å‚¨å­˜åˆ° <code>sessionstorage</code> è¿™æ ·é¡µé¢åˆ·æ–°çš„æ—¶å€™ ä¼šç«‹åˆ»è¯»å– (vuexä¹Ÿå¯ä»¥é€šè¿‡ç¼“å­˜æ‹¿åˆ° ä½†æ˜¯ä¼šæœ‰å»¶è¿Ÿ ç›´æ¥å‚¨å­˜åˆ°ç¼“å­˜æ›´å¥½)</p> <ul><li>åœ¨vuex è·å–åˆ°ç”¨æˆ·çš„è·¯ç”±åˆé›†å å‚¨å­˜åˆ°ç¼“å­˜ä¸­</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// æŠŠæƒé™å­—æ®µæ”¾åˆ°sessionStorageé‡Œé¢</span>
   sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'codeList'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>ç¬¬ä¸‰æ­¥ å°è£…ä¸€ä¸ªjsæ–¹æ³• ç”¨æ¥é…åˆé¡µé¢<code>v-if</code> å®ç°å…ƒç´ çš„æ˜¾ç¤ºéšè— å¹¶ä¸”åœ¨<code>main.js</code>å…¥å£æ–‡ä»¶ä¸­æ³¨å†ŒåŸå‹é“¾</p> <ul><li>å°è£…æŒ‰é’®æƒé™çš„jsæ–¹æ³•</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åˆ¤æ–­æŒ‰é’®æƒé™</span>
<span class="token comment">// parm æ˜¯é¡µé¢ä¼ æ¥çš„æŒ‰å­—æ®µ ç”¨æ¥å’Œæƒé™åˆé›†çš„åˆ¤æ–­</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">hasPermission</span> <span class="token punctuation">(</span><span class="token parameter">parm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// tagè¿™é‡Œå£°æ˜ä¸€ä¸ªçŠ¶æ€ åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å…·å¤‡æŒ‰é’®å…ƒç´ çš„æƒé™ é»˜è®¤æ˜¯falseæ— æƒé™</span>
    <span class="token keyword">let</span> tag <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// ä»ç¼“å­˜ä¸­è¯»å–ç”¨æˆ·çš„æƒé™åˆé›†</span>
    <span class="token keyword">const</span> codeList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'codeList'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// å¾ªç¯æƒé™åˆé›†å­—æ®µ å»å’Œä¼ æ¥çš„é¡µé¢å­—æ®µåŒ¹é…</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> codeList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¦‚æœåŒ¹é…æˆåŠŸ è¯´æ˜æ‹¥æœ‰æƒé™</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>codeList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> parm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŠŠtagè®¾ç½®ä¸ºtrue</span>
            tag <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token comment">// æ‰“æ–­å¾ªç¯</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æŠŠå¤„ç†å¥½çš„tagçŠ¶æ€è¿”å›å‡ºå»</span>
    <span class="token keyword">return</span> tag
<span class="token punctuation">}</span>

</code></pre></div><ul><li>åœ¨<code>main.js</code>å…¥å£æ–‡ä»¶ä¸­æ³¨å†ŒåŸå‹é“¾</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æŒ‰é’®æƒé™åˆ¤æ–­</span>
<span class="token keyword">import</span> hasPermission <span class="token keyword">from</span> <span class="token string">'@/permission/index'</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasPerm <span class="token operator">=</span> hasPermission
</code></pre></div><ul><li>åœ¨é¡µé¢ä¸Šè¿›è¡ŒæŒ‰é’®æƒé™åˆ¤æ–­</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// é€šè¿‡ v-ifè°ƒç”¨æŒ‰é’®æƒé™jsæ–¹æ³• ä¼ å…¥æŒ‰é’®çš„æƒé™åç§° å³å¯å®ç°æŒ‰é’®æƒé™
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hasPerm(<span class="token punctuation">'</span>sys:menu:edit<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-edit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>editMenu(scope.row)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç¼–è¾‘<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>ç¬¬å››æ­¥ æŒ‰é’®(å…ƒç´ )è®¾ç½®<code>v-if</code> è°ƒç”¨å£°æ˜çš„jsæ–¹æ³• å¹¶ä¸”ä¼ å‚ä¼ å…¥çš„æŒ‰é’®çš„æƒé™åç§° åœ¨è·¯ç”±åˆé›†ä¸­ç­›é€‰ åˆ¤æ–­æ˜¯å¦æœ‰è¯¥æƒé™åç§° å³å¯å®ç°æŒ‰é’®æƒé™</p></li></ol> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110132442514.png" alt="image-20220110132442514"></p> <h2 id="é€€å‡ºåŠŸèƒ½"><a href="#é€€å‡ºåŠŸèƒ½" class="header-anchor">#</a> é€€å‡ºåŠŸèƒ½</h2> <ul><li>é€€å‡ºåŠŸèƒ½ç†è®ºä¸Šå¯ä»¥è®©å‰ç«¯åˆ é™¤æ‰cookieçš„tokençš„æ–¹å¼ å®ç°é€€å‡ºåŠŸèƒ½ ä½†æ˜¯å¦‚æœç”¨æˆ·æå‰æŠŠtokenä¿å­˜åå†ç²˜è´´åˆ°cookieé‡Œ è¿™æ—¶å€™ å°±ä¼šé€ æˆæ— æ³•å‡†ç¡®åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é€€å‡ºç™»å½•
<ul><li>åœ¨åç«¯è®¾è®¡çš„æ—¶å€™ éœ€è¦åšä¸€ä¸ªé€€å‡ºåŠŸèƒ½çš„æ¥å£ å•ç‹¬åšå¤„ç†(å¯ä»¥ç”¨Redis)</li> <li>è¿™å—éœ€è¦åç«¯å»ºä¸€ä¸ªé»‘åå• å‚¨å­˜ç”¨æˆ·é€€å‡ºçš„token éœ€è¦ç”¨åˆ°Redis è‡ªåŠ¨åˆ é™¤è¿‡æœŸçš„token é˜²æ­¢å¤šæ¬¡å‚¨å­˜ä¸€ä¸ªäººé€€å‡ºçš„token</li></ul></li></ul> <blockquote><p>å‰ç«¯é€€å‡ºåŠŸèƒ½æ“ä½œ</p></blockquote> <ul><li>å‰ç«¯éœ€è¦æºå¸¦cookieå‚¨å­˜çš„tokenå³å¯ ä¼ ç»™åç«¯ åç«¯å»åšå¤„ç†å³å¯</li> <li>åŒæ—¶æ¸…é™¤cookie å’Œ sessionStorage å¹¶ä¸”è·³è½¬åˆ°ç™»å½•é¡µ</li> <li><font color="#ff3040">æ³¨æ„: å¦‚æœä½ ä½¿ç”¨äº†tokenç»­ç­¾ åˆ™å¿…é¡»åœ¨æ¸…ç©ºå é‡ç½®tokenè¿‡æœŸæ—¶é—´æˆ³(è®©å…¶å˜ä¸º0) å¦åˆ™å¯èƒ½ä¼šå­˜åœ¨åˆ¤æ–­é—®é¢˜</font></li></ul> <blockquote><p>å®ç°æ“ä½œ</p></blockquote> <ul><li>å¦‚æœä½ ç”¨çš„æ˜¯ vue element adminæ¡†æ¶ ä»–çš„<code>utils</code>æ–‡ä»¶å¤¹ä¸­è‡ªå¸¦äº†cookieæ–¹æ³• å»ºè®®æŠŠæ¸…é™¤sessionçš„ä¹Ÿæ·»åŠ è¿›å»</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111170221100.png" alt="image-20220111170221100"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token comment">// cookieå‘½å</span>
<span class="token keyword">const</span> TokenKey <span class="token operator">=</span> <span class="token string">'Admin-Token'</span>
<span class="token comment">// sessionå‘½å</span>
<span class="token keyword">const</span> timeKey <span class="token operator">=</span> <span class="token string">'expireTime'</span>

<span class="token comment">// è·å–cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä¿å­˜cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setToken</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç§»é™¤cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ¸…ç©ºsessionStorage</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">clearStorage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è®¾ç½®tokenè¿‡æœŸæ—¶é—´ (ä¿å­˜tokenè¿‡æœŸå’Œå½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒ ä½äº10åˆ†é’Ÿ(æˆ–å…¶ä»–æ—¶é—´)è¿›è¡Œç»­ç­¾)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setTokenTime</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> time<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// é‡ç½®tokenè¿‡æœŸæ—¶é—´ (æ¸…ç©ºtokenä¸éœ€è¦è®¾ç½®ä¸º'' æˆ–è€…null é˜²æ­¢æ— æ³•åˆ¤æ–­ éœ€è¦è®¾ç½®ä¸º0æˆ–-1)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è·å–å‚¨å­˜çš„tokençš„æ—¶é—´</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>é¡µé¢é€€å‡ºåŠŸèƒ½
<ul><li><font color="#ff3040">æ³¨æ„: å¦‚æœä½ ä½¿ç”¨äº†tokenç»­ç­¾ åˆ™å¿…é¡»åœ¨æ¸…ç©ºå é‡ç½®tokenè¿‡æœŸæ—¶é—´æˆ³(è®©å…¶å˜ä¸º0) å¦åˆ™å¯èƒ½ä¼šå­˜åœ¨åˆ¤æ–­é—®é¢˜</font></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// æ¸…ç©ºtoken</span>
    <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// æ¸…ç©ºç¼“å­˜</span>
    <span class="token function">clearStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// é‡ç½®tokenæ—¶é—´æˆ³</span>
    <span class="token function">removeTokenTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// åˆ·æ–°è·³è½¬</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/login'</span>
</code></pre></div><h2 id="tokenç»­ç­¾ä¸¤ç§å®ç°æ–¹å¼"><a href="#tokenç»­ç­¾ä¸¤ç§å®ç°æ–¹å¼" class="header-anchor">#</a> tokenç»­ç­¾ä¸¤ç§å®ç°æ–¹å¼</h2> <ul><li>tokenç»­ç­¾æœ‰ä¸¤ç§æ–¹å¼ å…¶å®å…¨éƒ¨çš„tokenç»­ç­¾éƒ½æ¶‰åŠåˆ°äº†axiosçš„è¯·æ±‚æ‹¦æˆªå™¨<code>response.use()</code> é€šè¿‡è¯·æ±‚æ‹¦æˆªå™¨å»å®ç°tokençš„ç»­ç­¾</li> <li>é€šå¸¸éƒ½ä¼šåœ¨<code>utils</code>é‡Œçš„<code>request.js</code>ä¸­è¿›è¡Œç»­ç­¾å¤„ç† (äºŒæ¬¡å°è£…axiosæ–‡ä»¶)</li></ul> <h3 id="åŒtokenç»­ç­¾æœºåˆ¶"><a href="#åŒtokenç»­ç­¾æœºåˆ¶" class="header-anchor">#</a> åŒtokenç»­ç­¾æœºåˆ¶</h3> <ul><li><p>ç¬¬ä¸€ç§æ˜¯åŒtoken <code>ReFresh_token</code> å’Œ <code>ç”¨æˆ·token</code> å½“<code>ç”¨æˆ·token</code>è¿‡æœŸå æ‹¿<code>ReFresh_token</code>å»ç»­ç­¾ <code>ReFresh_token</code>ä¸€èˆ¬æœ‰æ•ˆæœŸæ˜¯åŠå¹´ è¯¥tokenä¸å…·å¤‡ä»»ä½•æ•°æ® åªæ˜¯ä½œä¸ºç»­ç­¾å‡­è¯ å¦‚æœ<code>ReFresh_token</code>è¿‡æœŸäº† å°±éœ€è¦é‡æ–°ç™»å½•äº† è¿™ç§æ–¹å¼æ˜¯ç›¸å¯¹å®‰å…¨çš„ å› ä¸º<code>ç”¨æˆ·token</code>æ—¶é—´åªæœ‰äº”åˆ†é’Ÿ</p></li> <li><p>åŒtokenç»­ç­¾æœºåˆ¶ æ€»æµç¨‹å›¾</p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/VaQ6uA7POdc8qJv.png" alt="image-20210605115451235"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//~ å¯¼å…¥ axiosç»„ä»¶</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token comment">//~ å¯¼å…¥ routerç»„ä»¶ è°ƒç”¨è·³è½¬æ–¹æ³•</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'../router/index'</span>
<span class="token comment">// ~ ç›®æ ‡: (1) ç»­ç­¾token (2) å¦‚æœrefresh_tokenå¤±æ•ˆ å°±è®¤ä¸ºç™»å½•è¿‡æœŸ éœ€è¦é‡æ–°ç™»å½• try{} catch{}</span>
<span class="token comment">// ~ åŒtokenæœºåˆ¶ :</span>
<span class="token comment">// ~ ä¸€ä¸ª tokenä¸ºè·å–æ•°æ®token(ä¿è´¨æœŸçŸ­ éœ€è¦ç»­ç­¾)</span>
<span class="token comment">// ~ ä¸€ä¸ªæ˜¯é…åˆç»­ç­¾çš„token(ä¸æ”¯æŒè·å–æ•°æ® åªèƒ½ç»­ç­¾ ä¿è´¨æœŸé•¿)</span>
<span class="token comment">// ~ 1. ç»­ç­¾token è®¾ç½®axios.create({}) è®¾ç½®axiosåˆ†æ”¯</span>
<span class="token comment">// ~ axios.create({})åˆ†æ”¯å¯ä»¥è®¾ç½®å¤šä¸ªåŸºç¡€urlåœ°å€</span>
<span class="token comment">// ~ 2. å£°æ˜ä¸€ä¸ªé€šç”¨çš„urlåŸºç¡€åœ°å€ ç”¨äºç”³è¯·tokençš„åŸºç¡€è·¯å¾„ ç”¨å¸¸é‡ä¿å­˜</span>
<span class="token keyword">const</span> baseURL <span class="token operator">=</span> <span class="token string">'http://api-toutiao-web.itheima.net/app/'</span>
<span class="token comment">// ~ 3. axiosåˆ†æ”¯çš„æ–¹æ³• åˆ›å»ºaxiosæ¥å£è°ƒç”¨æ–¹æ³• å–ä»£å•ä¸€çš„axiosæ–¹æ³•(æ–¹ä¾¿å•ç‹¬è®¾ç½®)</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ~ baseURLæ˜¯axioså±æ€§ ç”¨æ¥å£°æ˜urlåŸºç¡€è·¯å¾„</span>
  baseURL<span class="token operator">:</span> baseURL
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// å°è£…é€šç”¨çš„æ¥å£è°ƒç”¨æ–¹æ³•</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™é‡Œçš„è¿”å›å€¼æ˜¯Promiseå®ä¾‹å¯¹è±¡</span>
  <span class="token keyword">return</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// è®¾ç½®è¯·æ±‚æ–¹å¼</span>
    method<span class="token operator">:</span> options<span class="token punctuation">.</span>method <span class="token operator">||</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token comment">// è®¾ç½®è¯·æ±‚åœ°å€</span>
    url<span class="token operator">:</span> options<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    <span class="token comment">// POST/PUTè¯·æ±‚å‚æ•°ï¼ˆè¯·æ±‚ä½“ï¼‰</span>
    data<span class="token operator">:</span> options<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
    <span class="token comment">// GETè¯·æ±‚å‚æ•°ï¼ˆè‡ªåŠ¨æ‹¼æ¥åˆ°urlåœ°å€ä¸­ï¼‰</span>
    params<span class="token operator">:</span> options<span class="token punctuation">.</span>params<span class="token punctuation">,</span>
    <span class="token comment">// è®¾ç½®è¯·æ±‚å¤´</span>
    headers<span class="token operator">:</span> options<span class="token punctuation">.</span>headers
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ·»åŠ å“åº”æ‹¦æˆªå™¨ (åŠ å·¥å)</span>
<span class="token comment">// å“åº”æˆªæ‹¦å™¨æ˜¯æ¥æ”¶åˆ°æ•°æ® è¿›è¡Œä¸€äº›æ“ä½œ</span>
<span class="token comment">// è¯·æ±‚ç»“æœè¿”å›åï¼Œå…ˆä¸ç›´æ¥å¯¼å‡ºï¼Œè€Œæ˜¯å…ˆå¯¹å“åº”ç ç­‰ç­‰è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å¥½åå†å¯¼å‡ºç»™é¡µé¢</span>
<span class="token comment">// responseè·å–çš„æ˜¯ axioså¤„ç†åçš„æ•°æ®</span>
<span class="token comment">// ?  1.å¸¸ç”¨äºæ¸…é™¤axiosè‡ªå¸¦data æ–¹ä¾¿æ“ä½œ</span>
instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è·å–æ•°æ®æˆåŠŸæ—¶å€™</span>
  <span class="token comment">// å½“è·å–æ•°æ®æˆåŠŸæ—¶å€™ ç›´æ¥è¿›å…¥axiosé‡Œçš„data</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ~ 4. é€šå¸¸è¦ç”¨asyncå‡½æ•°è¿˜è·å–æ–°tokenå€¼(çœå»thenæ­¥éª¤)</span>
  <span class="token comment">// ~ å¼€å§‹è¿›è¡Œç»­ç­¾token</span>
  <span class="token comment">// ~ 5. åˆ¤æ–­tokenæ˜¯å¦å¤±æ•ˆ é”™è¯¯å‚æ•°æ˜¯error</span>
  <span class="token comment">// ~ erroré‡Œé¢å‚æ•°responseé‡Œé¢statusæ˜¯æœåŠ¡å™¨è¿”å›å€¼401(401æ— æƒé™è®¿é—®)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ~ 6. å¦‚æœrefresh_token æ˜¯æœ‰æ•ˆçš„ ç»­ç­¾token </span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ~ 7. å¦‚æœtokenå¤±æ•ˆäº† ç”³è¯·ä¸€ä¸ªæ–°çš„token(æ ¹æ® refresh_token)</span>
    <span class="token comment">// ~ 8. è°ƒç”¨æµè§ˆå™¨å‚¨å­˜çš„token (ä¸»è¦ç”¨ refresh_token)</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'mytoken'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token comment">// ~ 9. è°ƒç”¨æ¥å£ ç”¨refresh_token è·ŸæœåŠ¡å™¨æ¯”å¯¹ å¦‚æœæˆåŠŸ ç»­ç­¾token</span>
      <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// ~ 10. è®¾ç½®ç»­ç­¾tokençš„è¯·æ±‚æ–¹å¼ (putè¯·æ±‚æ–¹å¼ æ›¿æ¢ä¿®æ”¹çš„æ‰€æœ‰æ•°æ®)</span>
        method<span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>
        <span class="token comment">// ~ 11. è®¾ç½®ç»­ç­¾tokençš„åœ°å€ åŸºç¡€url+tokenåœ°å€</span>
        url<span class="token operator">:</span> baseURL <span class="token operator">+</span> <span class="token string">'v1_0/authorizations'</span><span class="token punctuation">,</span>
        headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ~ 12. è®¾ç½®è¯·æ±‚å¤´ æºå¸¦refresh_token å’ŒæœåŠ¡å™¨è¿›è¡Œæ¯”å¯¹ å¦‚æœæˆåŠŸ ç»­ç­¾æ–°token</span>
          Authorization<span class="token operator">:</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>refresh_token
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// ~ 13. è·å–æœ€æ–°çš„tokenæ•°æ® è¦†ç›–useré‡Œé¢çš„åŸå…ˆçš„å¤±æ•ˆtoken (åœ¨data.dataé‡Œé¢çš„token)</span>
      user<span class="token punctuation">.</span>token <span class="token operator">=</span> info<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token
      <span class="token comment">// ~ 14. åœ¨æµè§ˆå™¨ä¸­ç¼“å­˜ä¸­ä¿å­˜æ–°è·å–çš„tokenå€¼</span>
      sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'mytoken'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// ~ 15. é‡æ–°è°ƒç”¨åˆšæ‰æ¥å£ ç”¨æ–°tokenè®¿é—®æœåŠ¡å™¨ å®ç°ç»­ç­¾æˆåŠŸ</span>
      <span class="token comment">// ~ erroræ˜¯è¿”å›é”™è¯¯å€¼çš„å‚æ•° configæ˜¯é”™è¯¯å‚æ•°ä¸­çš„å±æ€§å é‡Œé¢åŒ…å«urlåœ°å€ è¯·æ±‚æ–¹å¼ç­‰ ç›¸å½“äºé‡æ–°è¯·æ±‚æœåŠ¡å™¨</span>
      <span class="token keyword">return</span> <span class="token function">instance</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span> <span class="token comment">// ~ return å¦‚æœæ•°æ®æ­£ç¡®å°±è¿”å›å» ä¸æ‰“å°ä¸‹é¢æ‰“å°ä¿¡æ¯</span>
      <span class="token comment">// ~ 16. å¦‚æœrefresh_tokenå¤±æ•ˆ è®©å…¶é‡æ–°ç™»å½• è´¦å·è·å–æ–°çš„refresh_token (çŠ¶æ€ç 403)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ~ 17. refresh_tokenå¤±æ•ˆ è®©å…¶è¿”å›ç™»å½•é¡µé¢(éœ€è¦è°ƒç”¨router ç»„ä»¶ åˆ©ç”¨routeræ–¹æ³•è·³è½¬)</span>
      <span class="token keyword">return</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token comment">// ~ è®©å…¶è·³è½¬åˆ°é¦–é¡µ returnè¿”å›æ•°æ® ä¸è®©å…¶æ‰§è¡Œä¸‹é¢é”™è¯¯æç¤º</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></li></ul> <h3 id="å•tokenæ—¶é—´æˆ³ç»­ç­¾æœºåˆ¶"><a href="#å•tokenæ—¶é—´æˆ³ç»­ç­¾æœºåˆ¶" class="header-anchor">#</a> å•tokenæ—¶é—´æˆ³ç»­ç­¾æœºåˆ¶</h3> <ul><li><p>ç¬¬äºŒç§æ˜¯ä¼ä¸šå¸¸ç”¨çš„ å•<code>ç”¨æˆ·token</code> å½“ç”¨æˆ·ç™»å½•çš„æ—¶å€™ æ¥å£ä¼šè¿”å›ä¸€ä¸ª<code>tokenè¿‡æœŸæ—¶é—´æˆ³</code> å‰ç«¯æŠŠæ—¶é—´æˆ³å‚¨å­˜sessionä¸­ æ¯å½“è¯·æ±‚æ¥å£çš„æ—¶å€™ éœ€è¦ç”µè„‘å½“å‰æ—¶é—´å»è®¡ç®—åç«¯è¿”å›<code>tokenè¿‡æœŸæ—¶é—´æˆ³</code> å¦‚æœå°äº10åˆ†é’Ÿ(æˆ–è€…å…¶ä»–) å°±ä¼šè¿›è¡Œç»­ç­¾æ“ä½œ æ›¿æ¢ä¸€ä¸ªæ–°çš„<code>ç”¨æˆ·token</code>å¹¶ä¸”æ›´æ–°<code>tokenè¿‡æœŸæ—¶é—´æˆ³</code> è¿™ç§æ–¹å¼ç›¸å¯¹åç«¯æ¥è¯´ç®€å• å®‰å…¨æ€§ä¸å¦‚ç¬¬ä¸€ç§ å› ä¸º<code>ç”¨æˆ·token</code> æœ‰æ•ˆæœŸé€šå¸¸ä¸º8å°æ—¶ç”šè‡³æ›´é•¿ å› ä¸ºåç«¯æ˜¯ä¸ä¼šæŠŠè¿‡æœŸtokenç»­ç­¾çš„ æ‰€ä»¥æ—¶é—´è®¾ç½®å¤ªçŸ­çš„è¯ ç”¨æˆ·ä¸´æ—¶ä¸æ“ä½œå°±ä¼šè¿‡æœŸé‡æ–°ç™»å½•</p></li> <li><p>å•tokenæ—¶é—´æˆ³ç»­ç­¾ æ€»æµç¨‹å›¾</p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111163947060.png" alt="image-20220111163947060"></p></li></ul> <blockquote><p>åç«¯æ¥å£æ•°æ®éœ€æ±‚</p></blockquote> <ul><li>å‰ç«¯éœ€è¦ç»™åç«¯ä¼ é€’æ—§tokenå³å¯ åç«¯å°±ä¼šè¿”å›ä¸€ä¸ªæ–°çš„token å’Œ æ–°çš„è¿‡æœŸæ—¶é—´æˆ³</li></ul> <ol><li>ç¬¬ä¸€æ­¥åœ¨<code>utils</code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºcookie æˆ–è€… sessionæ–¹æ³•</li></ol> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111170221100.png" alt="image-20220111170221100"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token comment">// cookieå‘½å</span>
<span class="token keyword">const</span> TokenKey <span class="token operator">=</span> <span class="token string">'Admin-Token'</span>
<span class="token comment">// sessionå‘½å</span>
<span class="token keyword">const</span> timeKey <span class="token operator">=</span> <span class="token string">'expireTime'</span>

<span class="token comment">// è·å–cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ä¿å­˜cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setToken</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç§»é™¤cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// æ¸…ç©ºsessionStorage</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">clearStorage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è®¾ç½®tokenè¿‡æœŸæ—¶é—´ (ä¿å­˜tokenè¿‡æœŸå’Œå½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒ ä½äº10åˆ†é’Ÿ(æˆ–å…¶ä»–æ—¶é—´)è¿›è¡Œç»­ç­¾)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setTokenTime</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> time<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// é‡ç½®tokenè¿‡æœŸæ—¶é—´ (æ¸…ç©ºtokenä¸éœ€è¦è®¾ç½®ä¸º'' æˆ–è€…null é˜²æ­¢æ— æ³•åˆ¤æ–­ éœ€è¦è®¾ç½®ä¸º0æˆ–-1)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// è·å–å‚¨å­˜çš„tokençš„æ—¶é—´</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>ç¬¬äºŒæ­¥åˆ›å»ºä¸€ä¸ªç»­ç­¾tokençš„apiæ¥å£ <code>api</code>æ–‡ä»¶å¤¹</li></ol> <blockquote><p>ç»­ç­¾tokençš„æ•°æ®ç»“æ„</p></blockquote> <ul><li>ç»­ç­¾tokençš„æ•°æ®ç»“æ„: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%BB%AD%E7%AD%BEtoken%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">ç»­ç­¾tokençš„æ•°æ®ç»“æ„json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// tokenç»­ç­¾</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">refreshTokenApi</span> <span class="token punctuation">(</span><span class="token parameter">parm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/sysUser/refreshToken'</span><span class="token punctuation">,</span> parm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>ç¬¬ä¸‰æ­¥åœ¨axiosäºŒæ¬¡å°è£…ä¸‹çš„æˆªå™¨å»å®ç°tokençš„ç»­ç­¾
<ul><li><font color="#ff3040">æ³¨æ„: tokenç»­ç­¾çš„å¤„ç†éœ€è¦å†™åœ¨æ·»åŠ è¯·æ±‚å¤´çš„ä¸Šé¢(æŠŠtokenå¡åˆ°è¯·æ±‚å¤´é‡Œ) å› ä¸ºæˆ‘ä»¬åœ¨ç»­ç­¾åå°±å·²ç»å¤„ç†äº†</font></li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token comment">// å¯¼å…¥vuex</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token comment">// å¤„ç†tokenå’Œcookie</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken<span class="token punctuation">,</span> getTokenTime<span class="token punctuation">,</span> setTokenTime<span class="token punctuation">,</span> removeTokenTime<span class="token punctuation">,</span> setToken<span class="token punctuation">,</span> clearStorage<span class="token punctuation">,</span> removeToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> refreshTokenApi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user'</span>
<span class="token comment">// create an axios instance</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span><span class="token punctuation">,</span> <span class="token comment">// url = base url + request url</span>
  <span class="token comment">// withCredentials: true, // send cookies when cross-domain requests</span>
 <span class="token comment">// timeout: 5000 // request timeout</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//! --------------------å¤„ç†tokenç»­ç­¾</span>
<span class="token comment">// tokenç»­ç­¾æ–¹æ³•</span>
<span class="token keyword">function</span> <span class="token function">reFresh</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å£°æ˜ä¸€ä¸ªå˜é‡ å‚¨å­˜å½“å‰token ä½œä¸ºæ›¿æ¢å‡­è¯</span>
  <span class="token keyword">const</span> parm <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'token'</span><span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å‘æ¥å£è¯·æ±‚ä¸€ä¸ªæ–°çš„token</span>
  <span class="token keyword">return</span> <span class="token function">refreshTokenApi</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// è¿™é‡Œå…¶å®å¯ä»¥ç®€å†™</span>
  <span class="token comment">//  return refreshTokenApi(parm).then(res =&gt; res)</span>
<span class="token punctuation">}</span>
<span class="token comment">//! å¤„ç†tokenç»­ç­¾</span>
<span class="token comment">// å®šä¹‰ä¸€ä¸ªçŠ¶æ€ä½ é˜²æ­¢å¤šæ¬¡è·å– æ— éœ€æ¯ä¸ªæ¥å£éƒ½è¯·æ±‚</span>
<span class="token keyword">let</span> isReFresh <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">// request interceptor</span>
<span class="token comment">// å‘é€è¯·æ±‚ä¹‹å‰çš„æ‹¦æˆªå™¨</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//! å¤„ç†tokenç»­ç­¾</span>
    <span class="token comment">// è·å–å½“å‰ç³»ç»Ÿæ—¶é—´æˆ³</span>
    <span class="token keyword">const</span> curent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// è·å–ç¼“å­˜ä¸­çš„æ—¶é—´æˆ³</span>
    <span class="token keyword">const</span> expireTime <span class="token operator">=</span> <span class="token function">getTokenTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// å¦‚æœç¼“å­˜ä¸­çš„æ—¶é—´æˆ³å­˜åœ¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>expireTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> minMx <span class="token operator">=</span> <span class="token punctuation">(</span>expireTime <span class="token operator">-</span> curent<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token comment">// æ¯«ç§’è®¡ç®—</span>
      <span class="token comment">// åˆ¤æ–­tokenæ—¶é—´æ˜¯å¦å°äºååˆ†é’Ÿ å°äºååˆ†é’Ÿè¿›è¡Œtokenç»­ç­¾æ“ä½œ</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>minMx <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ¤æ–­çŠ¶æ€ä½ ä¸ºfalseæ‰§è¡Œ é˜²æ­¢å¤šæ¬¡è¯·æ±‚tokenç»­ç­¾æ¥å£</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isReFresh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isReFresh <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token comment">// è¿”å›æ“ä½œ ä¸å†æ‰§è¡Œä»¥ä¸‹æ‹¦æˆªå™¨æ“ä½œ é˜²æ­¢æŠ¥é”™</span>
          <span class="token keyword">return</span> <span class="token function">reFresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// åˆ¤æ–­æ˜¯å¦è¯·æ±‚æˆåŠŸ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// è®¾ç½®æ–°çš„token</span>
              <span class="token function">setToken</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
              <span class="token comment">// è®¾ç½®æ–°çš„æ—¶é—´æˆ³</span>
              <span class="token function">setTokenTime</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>expireTime<span class="token punctuation">)</span>
              <span class="token comment">// æŠŠæ–°çš„tokenæ·»åŠ åˆ°å¤´éƒ¨ å®ç°æ­£å¸¸è·å–æ•°æ®</span>
              config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// è¿”å›config æ­£å¸¸è·å–æ¥å£æ•°æ®</span>
            <span class="token keyword">return</span> config
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// å¦‚æœç»­ç­¾å¤±è´¥è¿›è¡Œå¤„ç†(æ²¡æœ‰)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ— è®ºæ˜¯å¦è·å–æˆåŠŸæˆ–è€…å¤±è´¥ éƒ½éœ€è¦æŠŠçŠ¶æ€ä½é‡ç½®</span>
            isReFresh <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// do something before request is sent</span>
    <span class="token comment">// ä»storeé‡Œé¢è·å–tokenï¼Œå¦‚æœtokenå­˜åœ¨ï¼Œ</span>
    <span class="token comment">// æŠŠtokenæ·»åŠ åˆ°è¯·æ±‚çš„å¤´éƒ¨Headersé‡Œé¢</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// let each request carry token</span>
      <span class="token comment">// ['X-Token'] is a custom headers key</span>
      <span class="token comment">// please modify it according to the actual situation</span>
      <span class="token comment">// æŠŠtokenæ·»åŠ åˆ°è¯·æ±‚çš„å¤´éƒ¨</span>
      <span class="token comment">//! configæ˜¯å‘é€çš„æ•°æ® headersæ˜¯axiosè¯·æ±‚å¤´ Authorizationæ˜¯åç«¯æ¥å£åˆ¤æ–­tokençš„å±æ€§å</span>
        config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with request error</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>


</code></pre></div><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="header-anchor">#</a> å¤‡æ³¨</h2> <ul><li>è§’è‰²ç®¡ç†ä¸­ç”¨åˆ°çš„ä¸¤ä¸ªé€’å½’ ç¬¬ä¸€ä¸ªé€’å½’æ˜¯åˆ¤æ–­æ˜¯å¦æœ«çº§ ç¬¬äºŒä¸ªé€’å½’æ˜¯åˆ¤æ–­æ˜¯å¦å‹¾é€‰ å…¶å®è¿™é‡Œä¸å¤ªéœ€è¦åˆ¤æ–­æ˜¯å¦æœ«çº§ ä½ å¯ä»¥è¦æ±‚åç«¯è¿”å›æœ«çº§çš„æ—¶å€™ä¸è¦å¸¦<strong>children</strong> ç„¶ååˆ¤æ–­childrenå³å¯çŸ¥é“æ˜¯å¦æœ«çº§ æ‰€ä»¥å°±ä¸éœ€è¦ç¬¬ä¸€æ¬¡æœ«çº§é€’å½’ è¿™æ ·å¯ä»¥å¢å¼ºæ€§èƒ½</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220120164054492.png" alt="image-20220120164054492"></p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/1/14 ä¸Šåˆ11:41:59</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><APlayer audio="" fixed="true" mini="true" theme="#647ea0" loop="loop" order="list" preload="auto" volume="0.3" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div id="goTop" class="hide-cat" data-v-bf92849a></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      æ¬¢è¿æ¥åˆ° LKaiLi
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="120" height="322" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    çœ‹æ¿å¨˜
  </div></div></div></div>
    <script src="/assets/js/app.0080b5db.js" defer></script><script src="/assets/js/5.e6fb2106.js" defer></script><script src="/assets/js/1.9ae38156.js" defer></script><script src="/assets/js/50.302a422c.js" defer></script>
  </body>
</html>
