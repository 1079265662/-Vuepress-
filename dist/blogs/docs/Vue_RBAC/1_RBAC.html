<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RABC权限学习记录文档 | LKaiLi</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="https://pan.zealsay.com/blog/favicon.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/mouseClick.js"></script>
    <script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?61498f37b83812e7b85952d5feaaab47";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script>
    <meta name="description" content="草 走 🤸 忽略">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.e95cc97b.css" as="style"><link rel="preload" href="/assets/js/app.0080b5db.js" as="script"><link rel="preload" href="/assets/js/5.e6fb2106.js" as="script"><link rel="preload" href="/assets/js/1.9ae38156.js" as="script"><link rel="preload" href="/assets/js/50.302a422c.js" as="script"><link rel="prefetch" href="/assets/js/10.988ddcf1.js"><link rel="prefetch" href="/assets/js/11.ceb7dad1.js"><link rel="prefetch" href="/assets/js/12.ba0b832e.js"><link rel="prefetch" href="/assets/js/13.68f66a28.js"><link rel="prefetch" href="/assets/js/14.812668b7.js"><link rel="prefetch" href="/assets/js/15.a39e12f0.js"><link rel="prefetch" href="/assets/js/16.949c9eb9.js"><link rel="prefetch" href="/assets/js/17.8c1afffa.js"><link rel="prefetch" href="/assets/js/18.1c92af2c.js"><link rel="prefetch" href="/assets/js/19.b3487f5f.js"><link rel="prefetch" href="/assets/js/20.71e8ffd1.js"><link rel="prefetch" href="/assets/js/21.060e21fd.js"><link rel="prefetch" href="/assets/js/22.ba9e7fd0.js"><link rel="prefetch" href="/assets/js/23.c4681347.js"><link rel="prefetch" href="/assets/js/24.dc65eefe.js"><link rel="prefetch" href="/assets/js/25.a87bab83.js"><link rel="prefetch" href="/assets/js/26.32afa6c9.js"><link rel="prefetch" href="/assets/js/27.ddd3a1d0.js"><link rel="prefetch" href="/assets/js/28.7b41e498.js"><link rel="prefetch" href="/assets/js/29.4e1d83a6.js"><link rel="prefetch" href="/assets/js/3.4e5d0e6c.js"><link rel="prefetch" href="/assets/js/30.fd71be4f.js"><link rel="prefetch" href="/assets/js/31.a915d2fe.js"><link rel="prefetch" href="/assets/js/32.e03742ee.js"><link rel="prefetch" href="/assets/js/33.dc9cb1a5.js"><link rel="prefetch" href="/assets/js/34.d3f64b2b.js"><link rel="prefetch" href="/assets/js/35.512c33f0.js"><link rel="prefetch" href="/assets/js/36.822a0b6d.js"><link rel="prefetch" href="/assets/js/37.aeafad3d.js"><link rel="prefetch" href="/assets/js/38.f72714e6.js"><link rel="prefetch" href="/assets/js/39.771eb2a3.js"><link rel="prefetch" href="/assets/js/4.0067ce26.js"><link rel="prefetch" href="/assets/js/40.ec9bb689.js"><link rel="prefetch" href="/assets/js/41.40858107.js"><link rel="prefetch" href="/assets/js/42.0e598432.js"><link rel="prefetch" href="/assets/js/43.037f91cf.js"><link rel="prefetch" href="/assets/js/44.2a4150a3.js"><link rel="prefetch" href="/assets/js/45.524a1d1a.js"><link rel="prefetch" href="/assets/js/46.b9d37e76.js"><link rel="prefetch" href="/assets/js/47.493990ff.js"><link rel="prefetch" href="/assets/js/48.40148c70.js"><link rel="prefetch" href="/assets/js/49.858ae711.js"><link rel="prefetch" href="/assets/js/51.5f217faf.js"><link rel="prefetch" href="/assets/js/52.a98f98e5.js"><link rel="prefetch" href="/assets/js/53.11099602.js"><link rel="prefetch" href="/assets/js/54.8ed4b31a.js"><link rel="prefetch" href="/assets/js/55.15790820.js"><link rel="prefetch" href="/assets/js/56.f8f947ed.js"><link rel="prefetch" href="/assets/js/57.dba86ee1.js"><link rel="prefetch" href="/assets/js/58.d0f05e7e.js"><link rel="prefetch" href="/assets/js/59.b0768b2a.js"><link rel="prefetch" href="/assets/js/6.b813653c.js"><link rel="prefetch" href="/assets/js/60.2993ec00.js"><link rel="prefetch" href="/assets/js/61.70c982a0.js"><link rel="prefetch" href="/assets/js/62.c52f6280.js"><link rel="prefetch" href="/assets/js/63.c8c92802.js"><link rel="prefetch" href="/assets/js/64.5578df12.js"><link rel="prefetch" href="/assets/js/65.186d72e8.js"><link rel="prefetch" href="/assets/js/66.e774f297.js"><link rel="prefetch" href="/assets/js/67.5023b411.js"><link rel="prefetch" href="/assets/js/68.4e4bef1a.js"><link rel="prefetch" href="/assets/js/69.f3cd345b.js"><link rel="prefetch" href="/assets/js/7.d057457a.js"><link rel="prefetch" href="/assets/js/70.c96b7523.js"><link rel="prefetch" href="/assets/js/71.635f07de.js"><link rel="prefetch" href="/assets/js/72.2b58e52b.js"><link rel="prefetch" href="/assets/js/73.647369a4.js"><link rel="prefetch" href="/assets/js/74.ace7619f.js"><link rel="prefetch" href="/assets/js/75.1a147cf9.js"><link rel="prefetch" href="/assets/js/76.b127b41f.js"><link rel="prefetch" href="/assets/js/77.b4dd8d84.js"><link rel="prefetch" href="/assets/js/78.1697c041.js"><link rel="prefetch" href="/assets/js/79.ca2c3034.js"><link rel="prefetch" href="/assets/js/8.b1f53c13.js"><link rel="prefetch" href="/assets/js/80.253ac042.js"><link rel="prefetch" href="/assets/js/81.eef8c57a.js"><link rel="prefetch" href="/assets/js/82.a7445874.js"><link rel="prefetch" href="/assets/js/83.f342cd11.js"><link rel="prefetch" href="/assets/js/84.b7c8643e.js"><link rel="prefetch" href="/assets/js/85.0181db14.js"><link rel="prefetch" href="/assets/js/86.ea34a808.js"><link rel="prefetch" href="/assets/js/87.3e06f948.js"><link rel="prefetch" href="/assets/js/88.b0b4b249.js"><link rel="prefetch" href="/assets/js/89.c9feebc0.js"><link rel="prefetch" href="/assets/js/9.4652c675.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e95cc97b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-ec75d12e><div data-v-ec75d12e><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-ec75d12e data-v-ec75d12e><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-89477f7e data-v-ec75d12e data-v-ec75d12e><h3 class="title" style="display:none;" data-v-89477f7e data-v-89477f7e>LKaiLi</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-89477f7e data-v-89477f7e><input type="password" value="" data-v-89477f7e> <span data-v-89477f7e>Konck! Knock!</span> <button data-v-89477f7e>OK</button></label> <div class="footer" style="display:none;" data-v-89477f7e data-v-89477f7e><span data-v-89477f7e><i class="iconfont reco-theme" data-v-89477f7e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-89477f7e>vuePress-theme-reco</a></span> <span data-v-89477f7e><i class="iconfont reco-copyright" data-v-89477f7e></i> <a data-v-89477f7e><span data-v-89477f7e>LKaiLi</span>
            
          <span data-v-89477f7e>2021  - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-ec75d12e><div data-v-ec75d12e><div id="smart" class="wrapper-page" style="background-image:url(https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/vue.jpg);background-position-x:center;background-position-y:center;background-size:cover;background-repeat-x:no-repeat;background-repeat-y:no-repeat;" data-v-ec75d12e><header class="navbar" data-v-ec75d12e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="LKaiLi" class="logo"> <span class="site-name">LKaiLi</span></a> <div class="links"><div id="dayNightSwitch" class="generalWrapper" data-v-32f44868><a class="click" data-v-32f44868><div class="onOff daySwitch" data-v-32f44868><div class="star star1" data-v-32f44868></div> <div class="star star2" data-v-32f44868></div> <div class="star star3" data-v-32f44868></div> <div class="star star4" data-v-32f44868></div> <div class="star star5" data-v-32f44868></div> <div class="star sky" data-v-32f44868></div> <div class="sunMoon" data-v-32f44868><div class="crater crater1" data-v-32f44868></div> <div class="crater crater2" data-v-32f44868></div> <div class="crater crater3" data-v-32f44868></div> <div class="cloud part1" data-v-32f44868></div> <div class="cloud part2" data-v-32f44868></div></div></div></a></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/vue-element-admin/" class="nav-link"><i class="iconfont undefined"></i>
  vue-element-admin
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vscode/" class="nav-link"><i class="iconfont undefined"></i>
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue3/" class="nav-link"><i class="iconfont undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue移动头条项目/" class="nav-link"><i class="iconfont undefined"></i>
  Vue移动头条项目
</a></li><li class="dropdown-item"><!----> <a href="/categories/RABC/" class="nav-link"><i class="iconfont undefined"></i>
  RABC
</a></li><li class="dropdown-item"><!----> <a href="/categories/animation/" class="nav-link"><i class="iconfont undefined"></i>
  animation
</a></li><li class="dropdown-item"><!----> <a href="/categories/小程序/" class="nav-link"><i class="iconfont undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/categories/axios/" class="nav-link"><i class="iconfont undefined"></i>
  axios
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniapp/" class="nav-link"><i class="iconfont undefined"></i>
  uniapp
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      关于播客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link"><i class="iconfont reco-mail"></i>
  关于我
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link"><i class="iconfont reco-account"></i>
  联系我
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-ec75d12e></div> <aside class="sidebar" data-v-ec75d12e><div class="personal-info-wrapper" data-v-03833281 data-v-ec75d12e><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/my_cat.png" alt="author-avatar" class="personal-img" data-v-03833281> <h3 class="name" data-v-03833281>
    LKaiLi
  </h3> <div class="num" data-v-03833281><div data-v-03833281><h3 data-v-03833281>74</h3> <h6 data-v-03833281>文章</h6></div> <div data-v-03833281><h3 data-v-03833281>29</h3> <h6 data-v-03833281>标签</h6></div></div> <hr data-v-03833281></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/vue-element-admin/" class="nav-link"><i class="iconfont undefined"></i>
  vue-element-admin
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue/" class="nav-link"><i class="iconfont undefined"></i>
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/JavaScript/" class="nav-link"><i class="iconfont undefined"></i>
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vscode/" class="nav-link"><i class="iconfont undefined"></i>
  Vscode
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue3/" class="nav-link"><i class="iconfont undefined"></i>
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/categories/Vue移动头条项目/" class="nav-link"><i class="iconfont undefined"></i>
  Vue移动头条项目
</a></li><li class="dropdown-item"><!----> <a href="/categories/RABC/" class="nav-link"><i class="iconfont undefined"></i>
  RABC
</a></li><li class="dropdown-item"><!----> <a href="/categories/animation/" class="nav-link"><i class="iconfont undefined"></i>
  animation
</a></li><li class="dropdown-item"><!----> <a href="/categories/小程序/" class="nav-link"><i class="iconfont undefined"></i>
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/categories/axios/" class="nav-link"><i class="iconfont undefined"></i>
  axios
</a></li><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/uniapp/" class="nav-link"><i class="iconfont undefined"></i>
  uniapp
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      关于播客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/" class="nav-link"><i class="iconfont reco-mail"></i>
  关于我
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link"><i class="iconfont reco-account"></i>
  联系我
</a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue RBAC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/docs/Vue_RBAC/1_RBAC.html" aria-current="page" class="active sidebar-link">RABC权限学习记录文档</a></li><li><a href="/blogs/docs/Vue_RBAC/2_login_token.html" class="sidebar-link">续签token的流程</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-89477f7e data-v-ec75d12e><h3 class="title" style="display:none;" data-v-89477f7e data-v-89477f7e>RABC权限学习记录文档</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-89477f7e data-v-89477f7e><input type="password" value="" data-v-89477f7e> <span data-v-89477f7e>Konck! Knock!</span> <button data-v-89477f7e>OK</button></label> <div class="footer" style="display:none;" data-v-89477f7e data-v-89477f7e><span data-v-89477f7e><i class="iconfont reco-theme" data-v-89477f7e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-89477f7e>vuePress-theme-reco</a></span> <span data-v-89477f7e><i class="iconfont reco-copyright" data-v-89477f7e></i> <a data-v-89477f7e><span data-v-89477f7e>LKaiLi</span>
            
          <span data-v-89477f7e>2021  - </span>
          2022
        </a></span></div></div></div> <div data-v-ec75d12e><main class="page"><div class="page-title" style="display:none;"><h1 class="title">RABC权限学习记录文档</h1> <div class="page-info" data-v-0efa1f05><i class="iconfont reco-account" data-v-0efa1f05><span data-v-0efa1f05>LKaiLi</span></i> <i class="iconfont reco-date" data-v-0efa1f05><span data-v-0efa1f05>2022-01-11</span></i> <i class="iconfont reco-eye" data-v-0efa1f05><span id="/blogs/docs/Vue_RBAC/1_RBAC.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-0efa1f05><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-0efa1f05><span class="tag-item" data-v-0efa1f05>axios</span><span class="tag-item" data-v-0efa1f05>RABC</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block tip"><p class="custom-block-title">介绍</p> <p>RABC权限学习记录文档 从头到尾学习文档<br></p></div> <h2 id="权限流程图"><a href="#权限流程图" class="header-anchor">#</a> 权限流程图</h2> <ul><li><p><a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E8%AE%BF%E9%97%AE%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.pdf" target="_blank" rel="noopener noreferrer">整体权限的流程总结图pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://gitee.com/liu_kaili/mine-project-advanced-revision" target="_blank" rel="noopener noreferrer">本地仓库地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="http://element-admin.ynitmk.cn/" target="_blank" rel="noopener noreferrer">项目体验地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  账户 admin  密码 1234</p></li> <li><p>前端主体权限流程图(前端流程)</p></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211208172131082.png" alt="image-20211208172131082"></p> <ul><li>后端权限流程图(表结构 仅供参考)</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211213101322386.png" alt="image-20211213101322386"></p> <h2 id="权限学习地址"><a href="#权限学习地址" class="header-anchor">#</a> 权限学习地址</h2> <ul><li>我是通过<a href="https://ke.qq.com/course/3451173" target="_blank" rel="noopener noreferrer">腾讯课堂<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来学习的权限管理内容 所有的笔记都按照其授课内容记录的 请先浏览该项目后 符合项目设计需求后 再继续浏览本记录</li></ul> <h2 id="权限准备工作"><a href="#权限准备工作" class="header-anchor">#</a> 权限准备工作</h2> <blockquote><p>后端兄弟需要怎么配合你呢</p></blockquote> <ul><li><p>首先 需要后端把权限按照你需要的格式返回给你</p> <ul><li><code>roles</code> 是用户拥有权限的合集 前端是通过<code>roles</code>来判断用户是否具备路由权限和路由按钮权限(元素) <font color="#ff3040">注意: 必须是一个数组格式 </font></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211212191435998.png" alt="image-20211212191435998"></p> <ul><li>然后 你需要让后端生成全部动态路由菜单  <font color="#ff3040">注意: 必须让后端这样做</font> <ul><li>这里的动态路由菜单就是路由权限 前端会通过vue element admin 中提供的路由权限架构实现路由的整体权限控制
<ul><li>vue element admin 提供了meta对象 里面包含<code>roles</code> 就是控制路由权限的凭证</li></ul></li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111094334915.png" alt="image-20211212191525037"></p> <ul><li>其次 是路由按钮(元素)的权限 在第二阶段中</li></ul></li></ul> <blockquote><p>前端准备工作</p></blockquote> <ul><li>如果我们用的是<a href="https://panjiachen.github.io/vue-element-admin-site/zh/" target="_blank" rel="noopener noreferrer">vue-element-admin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 框架 就必须要要知道登录和权限流程</li></ul> <ol start="0"><li><p>二次封装一个 axios请求库 <code>request.js</code> (按需)</p> <ul><li>需要qs包 qs是一个url参数转化（parse和stringify）的js库</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i qs
</code></pre></div><ul><li>这里是按需封装 如果你有需要的话</li> <li>请求拦截器往里面塞了请求头token</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MessageBox<span class="token punctuation">,</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> qs <span class="token keyword">from</span> <span class="token string">'qs'</span>
<span class="token comment">// create an axios instance</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 默认url基本路径</span>
  baseURL<span class="token operator">:</span> <span class="token string">'http://42.193.158.170:8089'</span><span class="token punctuation">,</span>
  <span class="token comment">// withCredentials: true, // send cookies when cross-domain requests</span>
  timeout<span class="token operator">:</span> <span class="token number">5000</span> <span class="token comment">// request timeout</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// request interceptor</span>
<span class="token comment">// 发送请求之前的拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something before request is sent</span>
    <span class="token comment">// 从store里面获取token，如果token存在，</span>
    <span class="token comment">// 把token添加到请求的头部Headers里面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// let each request carry token</span>
      <span class="token comment">// ['X-Token'] is a custom headers key</span>
      <span class="token comment">// please modify it according to the actual situation</span>
      <span class="token comment">// 把token添加到请求的头部</span>
      <span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with request error</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// response interceptor</span>
<span class="token comment">// 请求返回之后的拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token comment">/**
   * If you want to get http information such as headers or status
   * Please return  response =&gt; response
  */</span>

  <span class="token comment">/**
   * Determine the request status by custom code
   * Here is just an example
   * You can also judge the status by HTTP Status Code
   */</span>
  <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> response<span class="token punctuation">.</span>data
    <span class="token comment">// console.log(response)</span>
    <span class="token comment">// console.log(res)</span>
    <span class="token comment">// if the custom code is not 20000, it is judged as an error.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 验证码处理：返回的是arraybuffer,需要转车base64</span>
      <span class="token comment">// 1.把arraybuffer转换成二进制字符</span>
      <span class="token comment">// 2.把二进制字符转换为base64 (btoa方法)字符给img使用</span>
      <span class="token keyword">const</span> indexs <span class="token operator">=</span> response<span class="token punctuation">.</span>config<span class="token punctuation">.</span>responseType
      <span class="token keyword">if</span> <span class="token punctuation">(</span>indexs <span class="token operator">===</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
          <span class="token string">'data:image/png;base64,'</span> <span class="token operator">+</span>
          <span class="token function">btoa</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
              <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> byte</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> data <span class="token operator">+</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span>
            <span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        message<span class="token operator">:</span> res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'服务器出错'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
        duration<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">600</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">50012</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">50014</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// to re-login</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'用户登录信息过期，请重新登录！'</span><span class="token punctuation">,</span> <span class="token string">'系统提示'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          confirmButtonText<span class="token operator">:</span> <span class="token string">'登录'</span><span class="token punctuation">,</span>
          cancelButtonText<span class="token operator">:</span> <span class="token string">'取消'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'warning'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/resetToken'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'服务器出错'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token operator">:</span> error<span class="token punctuation">.</span>msg <span class="token operator">||</span> <span class="token string">'服务器出错'</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 请求方法</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">post</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">put</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// parm =&gt;  {id:10}</span>
  <span class="token comment">// http://localhost:8089/api/user?id=10</span>
  <span class="token function">get</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      params<span class="token operator">:</span> params<span class="token punctuation">,</span>
      <span class="token function-variable function">paramsSerializer</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// parm =&gt;  {id:10}</span>
  <span class="token comment">// http://localhost:8089/api/user/10</span>
  <span class="token function">getRestApi</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _params
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">'/'</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment">// eslint-disable-next-line no-prototype-builtins</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _params <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 去掉参数最后一位?</span>
      _params <span class="token operator">=</span> _params<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_params<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// parm =&gt;  {id:10}</span>
  <span class="token comment">// http://localhost:8089/api/user/10</span>
  <span class="token keyword">delete</span> <span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _params
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      _params <span class="token operator">=</span> <span class="token string">'/'</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// eslint-disable-next-line no-prototype-builtins</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _params <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 去掉参数最后一位?</span>
      _params <span class="token operator">=</span> _params<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _params<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">upload</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'multipart/form-data'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">login</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getImage</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      responseType<span class="token operator">:</span> <span class="token string">'arraybuffer'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> http

</code></pre></div><ul><li>封装后 api请求的格式 <code>api.js</code> <ul><li>二次封装axios后 我们直接async awite</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'@/utils/requestStudent'</span>

<span class="token comment">// 登录</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">login</span> <span class="token punctuation">(</span><span class="token parameter">parms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'/api/user/login'</span><span class="token punctuation">,</span> parms<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取用户信息和权限信息</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getInfo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/sysUser/getInfo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取全部的动态路由</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getMenuList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/sysUser/getMenuList'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取用户列表</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUserListApi</span> <span class="token punctuation">(</span><span class="token parameter">parm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">getRestApi</span><span class="token punctuation">(</span><span class="token string">'/api/user/list'</span><span class="token punctuation">,</span> parm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>登录实际上是再vuex中进行的 通过vuex来获取的登录信息(用户拥有的权限集合) 和 动态路由信息</p> <ul><li>登录信息(用户拥有的权限集合) <code>Vuex中 user.js</code> <ul><li>这里的 <code>login, logout, getInfo</code> 可以替换成自己的接口数据</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getToken<span class="token punctuation">,</span> setToken<span class="token punctuation">,</span> removeToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> router<span class="token punctuation">,</span> <span class="token punctuation">{</span> resetRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> getInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/students/student'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过cookie获取token</span>
  token<span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 用户名</span>
  name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 用户头像</span>
  avatar<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 用户简介</span>
  introduction<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 用户拥有的权限集合</span>
  roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 用户id</span>
  userId<span class="token operator">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">SET_TOKEN</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> token</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>token <span class="token operator">=</span> token
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_INTRODUCTION</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> introduction</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>introduction <span class="token operator">=</span> introduction
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_NAME</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_USERUID</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> userId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>userId <span class="token operator">=</span> userId
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_AVATAR</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> avatar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>avatar <span class="token operator">=</span> avatar
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">SET_ROLES</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> roles</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>roles <span class="token operator">=</span> roles
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// user login  用户登录 用作用户登录</span>
  <span class="token function">login</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> userInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 解构出用户名和密码</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> code <span class="token punctuation">}</span> <span class="token operator">=</span> userInfo
    <span class="token comment">// 调用promise方法登录</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调用api/user里面的login方法</span>
      <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 用户登录的信息</span>
        username<span class="token operator">:</span> username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> password<span class="token punctuation">,</span>
        code<span class="token operator">:</span> code
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token comment">// 结构token</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> response
        <span class="token comment">// 把后端返回的token存到vuex中</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>
        <span class="token comment">// 把后端返回的token存到cookies里面</span>
        <span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// get user info 这里是路由信息</span>
  <span class="token function">getInfo</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> state <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调用api/user里面的getInfo方法获取用户信息和权限信息</span>
      <span class="token function">getInfo</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
        <span class="token comment">// 结构数据</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Verification failed, please Login again.'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token punctuation">{</span> roles<span class="token punctuation">,</span> name<span class="token punctuation">,</span> introduction<span class="token punctuation">,</span> id <span class="token punctuation">}</span> <span class="token operator">=</span> data

        <span class="token comment">// roles must be a non-empty array</span>

        <span class="token comment">// roles必须是一个数组</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>roles <span class="token operator">||</span> roles<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'getInfo: roles must be a non-null array!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 把权限字段放到sessionStorage里面</span>
        sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'codeList'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 把roles存到store里面</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROLES'</span><span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
        <span class="token keyword">const</span> userImg <span class="token operator">=</span> <span class="token string">'https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif'</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_USERUID'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_NAME'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_AVATAR'</span><span class="token punctuation">,</span> userImg<span class="token punctuation">)</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_INTRODUCTION'</span><span class="token punctuation">,</span> introduction<span class="token punctuation">)</span>
        <span class="token comment">// console.log(state)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// user logout</span>
  <span class="token comment">// logout ({ commit, state, dispatch }) {</span>
  <span class="token comment">//   return new Promise((resolve, reject) =&gt; {</span>
  <span class="token comment">//     logout(state.token).then(() =&gt; {</span>
  <span class="token comment">//       commit('SET_TOKEN', '')</span>
  <span class="token comment">//       commit('SET_ROLES', [])</span>
  <span class="token comment">//       removeToken()</span>
  <span class="token comment">//       resetRouter()</span>

  <span class="token comment">//       // reset visited views and cached views</span>
  <span class="token comment">//       // to fixed https://github.com/PanJiaChen/vue-element-admin/issues/2485</span>
  <span class="token comment">//       dispatch('tagsView/delAllViews', null, { root: true })</span>

  <span class="token comment">//       resolve()</span>
  <span class="token comment">//     }).catch(error =&gt; {</span>
  <span class="token comment">//       reject(error)</span>
  <span class="token comment">//     })</span>
  <span class="token comment">//   })</span>
  <span class="token comment">// },</span>

  <span class="token comment">// remove token</span>
  <span class="token function">resetToken</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
      <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROLES'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// dynamically modify permissions</span>
  <span class="token keyword">async</span> <span class="token function">changeRoles</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span><span class="token punctuation">,</span> role</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> role <span class="token operator">+</span> <span class="token string">'-token'</span>

    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_TOKEN'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>
    <span class="token function">setToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'getInfo'</span><span class="token punctuation">)</span>

    <span class="token function">resetRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// generate accessible routes map based on roles</span>
    <span class="token keyword">const</span> accessRoutes <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'permission/generateRoutes'</span><span class="token punctuation">,</span> roles<span class="token punctuation">,</span> <span class="token punctuation">{</span> root<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// dynamically add accessible routes</span>
    router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>

    <span class="token comment">// reset visited views and cached views</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'tagsView/delAllViews'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> root<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span>

</code></pre></div><ul><li>动态路由信息 <code>Vuex中 permission.js</code> <ul><li>这里是生成动态路由的内容</li> <li><code>permission</code>非常关键 他会通过循环去判断 用户的<code>rolse</code>合集中的路由权限 是否和动态路由菜单匹配 然后生成权限动态路由</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> constantRoutes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getMenuList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/students/student'</span>
<span class="token keyword">import</span> Layout <span class="token keyword">from</span> <span class="token string">'@/layout'</span>

<span class="token comment">/**
 * Use meta.role to determine if the current user has permission
 * @param roles
 * @param route
 */</span>
<span class="token keyword">function</span> <span class="token function">hasPermission</span> <span class="token punctuation">(</span><span class="token parameter">roles<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>meta <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> roles<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">role</span> <span class="token operator">=&gt;</span> route<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>roles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Filter asynchronous routing tables by recursion
 * @param routes asyncRoutes
 * @param roles
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">filterAsyncRoutes</span> <span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> roles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">// 循环每一个路由</span>
  routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(route)</span>
    <span class="token keyword">const</span> tmp <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>route <span class="token punctuation">}</span>
    <span class="token comment">// console.log(tmp)</span>
    <span class="token comment">// 判断是否有权限</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasPermission</span><span class="token punctuation">(</span>roles<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> component <span class="token operator">=</span> tmp<span class="token punctuation">.</span>component
      <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>component <span class="token operator">===</span> <span class="token string">'Layout'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果是一级</span>
          tmp<span class="token punctuation">.</span>component <span class="token operator">=</span> Layout
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 如果是二三级 因为后端返回的数据格式很标准 所以只需要这样写即可</span>
          tmp<span class="token punctuation">.</span><span class="token function-variable function">component</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/views</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>component<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 判断是否有下级</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tmp<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">filterAsyncRoutes</span><span class="token punctuation">(</span>tmp<span class="token punctuation">.</span>children<span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// console.log(res)</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  addRoutes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">SET_ROUTES</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> routes</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>addRoutes <span class="token operator">=</span> routes

    <span class="token comment">// 把过滤出来有权限的路由添加到不需要权限的路由里面去</span>
    state<span class="token punctuation">.</span>routes <span class="token operator">=</span> constantRoutes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>routes<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">generateRoutes</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> roles</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 存的是有权限的路由，是一个数组</span>
      <span class="token function">getMenuList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token keyword">let</span> accessedRoutes
        <span class="token comment">// 判断书否获取成功</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 生成动态路由菜单</span>
          accessedRoutes <span class="token operator">=</span> <span class="token function">filterAsyncRoutes</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_ROUTES'</span><span class="token punctuation">,</span> accessedRoutes<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>accessedRoutes<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  actions
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>路由守卫也需要单独配置 判断用户是否登录 和 他所拥有的角色权限 <code>permission.js</code></p> <ul><li>这里是路由守卫中的 <code>permission.js</code> 不是Vuex中的</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// axios的路由导航守卫 配合Vue-router 实现登录权限功能(在router上设置axios导航守卫)</span>
<span class="token comment">// 导入Vue-router方法 (在Vue组件内需要 this.$router 组件外直接router 使用即可)</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router/index'</span>
<span class="token comment">// 导入Vuex(获取其全局token值)</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/index'</span>
<span class="token comment">// 从cookie获取 getToken (暂时不用)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> removeToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span> <span class="token comment">// get token from cookie</span>
<span class="token comment">// 创建一个路径白名单 里面填写的是路径 (允许用户游客模式访问一些内容 比如登录页 404 没必要验证)</span>
<span class="token keyword">const</span> white <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token string">'/404'</span><span class="token punctuation">]</span>
<span class="token comment">// 创建路由导航守卫</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//! 读取Vuex全局组件 判断是否存在token</span>
  <span class="token comment">// 从Vuex全局组件中 读取保存的token(储存在getters里面)</span>
  <span class="token comment">// const token = store.getters.token</span>
  <span class="token comment">//! 读取用户的token</span>
  <span class="token keyword">const</span> hasToken <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token <span class="token operator">||</span> <span class="token keyword">null</span>
  <span class="token comment">// const userInfo = JSON.parse(localStorage.getItem('userInfo'))</span>
  <span class="token comment">// console.log(hasToken)</span>
  <span class="token comment">// 调用全局vuex的登录(这里是重新调用 实际上不需要重新调用 调用userInfo即可)</span>
  <span class="token comment">// if (!store.state.userInfo) {</span>
  <span class="token comment">//   store.dispatch('login')</span>
  <span class="token comment">// }</span>
  <span class="token comment">// 如果存在token</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果存在token 并且当前在登录页 让其跳转到主页</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// to 表示要跳转到哪里去</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//! 如果存在路由数据</span>
      <span class="token keyword">const</span> hasRoles <span class="token operator">=</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>roles <span class="token operator">&amp;&amp;</span> store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>roles<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token comment">// token要删除(这里防止多次调用)</span>
      <span class="token comment">// 如果不在登录页面上 直接通过 不做处理(因为已经登录访问 无需再跳转)</span>
      <span class="token comment">// 获取用户的信息(路由菜单信息)</span>
      <span class="token comment">// 为什么需要判断用户信息是否存在？（我们认为登录系统后已经得到了用户信息）</span>
      <span class="token comment">// 但是，获取用户信息的流程是异步的，路由访问时，用户信息尚未返回</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>hasRoles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果用户信息存在 不做处理直接通过</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">//! rolse必须是数组 ['admin'] or ,['developer','editor']</span>
          <span class="token comment">// 获取用户信息和权限信息</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> roles <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'user/getInfo'</span><span class="token punctuation">)</span>
          <span class="token comment">// generate accessible routes map based on roles</span>
          <span class="token comment">// 获取动态生成的路由数据</span>
          <span class="token keyword">const</span> accessRoutes <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'permission/generateRoutes'</span><span class="token punctuation">,</span> roles<span class="token punctuation">)</span>
          <span class="token comment">// console.log(accessRoutes)</span>
          <span class="token comment">// dynamically add accessible routes</span>
          <span class="token comment">// 添加到我们的路由</span>
          router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>to<span class="token punctuation">,</span> replace<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 获取不到返回登录页</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
          <span class="token comment">// 清除所有信息</span>
          localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">// 清除cookie</span>
          <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// // 如果用户信息不存在 获取用户的信息(调用Vuex里面获取信息的方法)</span>
        <span class="token comment">// await store.dispatch('user/getInfo') // 重新调用Vuex方法获取数据</span>
        <span class="token comment">// // await之后是可以获取用户信息的(用户可以获取的动态路由)</span>
        <span class="token comment">// const menus = store.state.user.userInfo.roles.menus</span>
        <span class="token comment">// // 下一步通过menus控制当前用户的路由权限</span>
        <span class="token comment">// // 根据menus信息从所有的动态路由asyncRoutes中过滤出该用户所拥有的的动态路由信息</span>
        <span class="token comment">// // 通过action过滤用户的路由权限,把路由映射信息存储在store中</span>
        <span class="token comment">// // action的返回值表示当前用户所拥有的的动态路由</span>
        <span class="token comment">// const myRoutes = await store.dispatch('permission/filterAuth', menus) // menus参数是用户拥有的动态路由权限 传递给Vuex进行动态路由筛选</span>
        <span class="token comment">// // 动态配置路由</span>
        <span class="token comment">// // 配置404 因为404是*路由 是全局匹配 要最后导入 先导入静态+动态路由的整合 再导入404</span>
        <span class="token comment">// router.addRoutes([...myRoutes, { path: '*', redirect: '/404', hidden: true }])</span>
        <span class="token comment">// // 继续跳转当前路由</span>
        <span class="token comment">// next({</span>
        <span class="token comment">//   ...to,</span>
        <span class="token comment">//   // 仅仅保留一个跳转历史（如果动态添加路由了，那么路由需要重新访问一次，这样的话，通样的路径访问的两次，路由历史重复了，不友好，所以可以把这两个合并为一个）</span>
        <span class="token comment">//   replace: true</span>
        <span class="token comment">// })</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果不存在token 判断是否在白名单中(游客可以访问的路径)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>white<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>to<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// includes()是数组方法 检测是否包含指定内容</span>
      <span class="token comment">// 在白名单里面，放行通过即可</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果不在白名单里面 跳转到登录页面</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
      <span class="token comment">// 清除所有信息</span>
      localStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 清除cookie</span>
      <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="第一阶段-路由权限的实现"><a href="#第一阶段-路由权限的实现" class="header-anchor">#</a> 第一阶段: 路由权限的实现</h2> <ul><li>权限分为两个阶段</li></ul> <ol><li><font color="#ff3040">路由权限 </font>也就是左侧菜单栏的权限 属于主体权限 是判断用户有权访问该页面的权限</li> <li><font color="#ff3040">按钮权限(元素权限)</font> 也就是进入页面后 内容显示与否的权限 是判断用户是否有权看到该元素 或者具备按钮等元素交互的权限</li></ol> <blockquote><p>登录模块数据</p></blockquote> <ul><li><p>登录所获取的数据 <font color="#ff3040">1. 用户的个人信息 其中包含权限信息合集 2. 获取动态路由信息 配合权限信息合集</font> 通过获取到用户的权限合集 配合需要权限的动态路由信息 才能实现 <font color="#ff3040">按钮和路由的权限</font></p> <ul><li>用户的个人信息 其中包含权限信息合集
<ul><li>第一阶段的路由权限 只需要用到路由权限 不需要按钮(元素)的权限</li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211212191435998.png" alt="image-20211212191435998"></p> <ul><li>路由合集数据类型介绍</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110113745507.png" alt="image-20220110113745507"></p> <ul><li>获取动态路由信息 配合权限信息合集
<ul><li>你需要让后端生成全部<strong>动态路由菜单</strong> <font color="#ff3040">注意: 必须让后端这样做</font></li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111094334915.png" alt=""></p></li> <li><p>登录个人信息json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%99%BB%E5%BD%95%E5%90%8E%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF.json" target="_blank" rel="noopener noreferrer">登录个人信息json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><strong>动态路由菜单</strong>json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">动态路由菜单json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <blockquote><p>登录模块流程</p></blockquote> <ul><li>登录功能整体流程图</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211213085442657.png" alt="image-20211213085442657"></p> <blockquote><p>前端的权限列表的结构 (参考结构)</p></blockquote> <ul><li>路由格式文件</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110135137882.png" alt="image-20220110135137882"></p> <ul><li>路由权限结构</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/nested'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> Layout<span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Nested'</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token string">'noRedirect'</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">'服务板块'</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">'nested'</span><span class="token punctuation">,</span>
      roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:serve'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        path<span class="token operator">:</span> <span class="token string">'menuAll'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'Menu0'</span><span class="token punctuation">,</span>
        meta<span class="token operator">:</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> <span class="token string">'设备管理'</span><span class="token punctuation">,</span>
          icon<span class="token operator">:</span> <span class="token string">'el-icon-s-help'</span><span class="token punctuation">,</span>
          affix<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:equipment'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu1'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu1'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'客户管理'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'kehu'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:client'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu2'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu2'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'工区管理'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'clipboard'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:gong'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu3'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu3'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'设备管理'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'tab'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:device'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'AssemblyChange'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-3/AssemblyChange'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'AssemblyChange'</span><span class="token punctuation">,</span>
            hidden<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'设备管理编辑页'</span><span class="token punctuation">,</span>
              noCache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:device'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'Assemblymanagement'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-4/Assemblymanagement'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Assemblymanagement'</span><span class="token punctuation">,</span>
            hidden<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'总成管理编辑页'</span><span class="token punctuation">,</span>
              noCache<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:assy'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            path<span class="token operator">:</span> <span class="token string">'menu4'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/nested/menu1/menu1-4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            name<span class="token operator">:</span> <span class="token string">'Menu4'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">{</span>
              title<span class="token operator">:</span> <span class="token string">'总成管理'</span><span class="token punctuation">,</span>
              icon<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
              roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'sys:assy'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="机构管理模块-非代码"><a href="#机构管理模块-非代码" class="header-anchor">#</a> 机构管理模块(非代码)</h2> <blockquote><p>展示效果(前端)</p></blockquote> <ul><li>查询前端样式</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211219175722785.png" alt="image-20211219175722785"></p> <ul><li>添加部门的前端样式</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211231134953873.png" alt=""></p> <blockquote><p>数据介绍和关联关系</p></blockquote> <ul><li><p>一个公司，下面有多个部门，每个部门下面可能还有下级部门，这些部门组合起来，就形成一个机构；</p></li> <li><p>通常一个公司，有很多部门，存在上下级的关系，所以设计机构管理表时，设计为上下级关系的表；</p></li></ul> <table><thead><tr><th>字段</th> <th>类型</th> <th>备注</th></tr></thead> <tbody><tr><td>id</td> <td>int</td> <td>主键</td></tr> <tr><td>pid</td> <td>int</td> <td>上级部门id</td></tr> <tr><td>parent_name</td> <td>varchar(128)</td> <td>上级部门名称</td></tr> <tr><td>name</td> <td>varchar(128)</td> <td>部门名称</td></tr> <tr><td>dept_code</td> <td>varchar(36)</td> <td>部门编码</td></tr> <tr><td>dept_phone</td> <td>varchar(20)</td> <td>部门电话</td></tr> <tr><td>dept_address</td> <td>varchar(255)</td> <td>部门地址</td></tr> <tr><td>like_id</td> <td>varchar(255)</td> <td>所有上级部门id和自己id的集合，逗号分隔如   1，3，5</td></tr> <tr><td>order_num</td> <td>int</td> <td>序号</td></tr> <tr><td>manager</td> <td>varchar(36)</td> <td>部门经理</td></tr></tbody></table> <ul><li><code>like_id</code> 这个很关键 可以通过他去查上机部门id和自己的id集合
<ul><li>适合查当前部门下的所有字段 否则你需要用递归的方式去查 <code>like_id</code> 可以很方便的差所有内容</li></ul></li></ul> <blockquote><p>机构管理树形表单的结构 <code>el-table</code>树形数据 接口</p></blockquote> <ul><li>你需要让后端来了解你需要哪些数据 这些数据和饿了么ui相对应</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211219181333509.png" alt="image-20211219181333509"></p> <ul><li>机构管理树形查询的结构json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%BB%93%E6%9E%84%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">机构管理树形结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>添加部门查询的树形结构 <code>el-tree</code>树形数据 接口</p></blockquote> <ul><li>添加部门的树形结构json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%9C%BA%E6%9E%84%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">添加部门的树形结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211222203357616.png" alt="image-20211222203357616"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211222203213313.png" alt="image-20211222203213313"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211222203236301.png" alt="image-20211222203236301"></p> <blockquote><p>添加部门的接口 接口</p></blockquote> <ul><li>他是通过<code>pid</code>(上级部门id) 来添加的</li></ul> <blockquote><p>删除部门 接口</p></blockquote> <ul><li>删除部门是携带需要删除部门的<code>id</code>(主键id) 来进行删除的</li></ul> <blockquote><p>编辑部门 接口</p></blockquote> <ul><li>编辑部门接口是通过<code>pid</code>(上级部门id)来查询添加的</li></ul> <p><font color="#ff3040">注意事项</font></p> <ul><li>前端在用饿了么ui的时候 使用这种children格式的数据 一定要在 <code>el-table</code>上绑定 <code>:tree-props=&quot;{ children: 'children' }&quot;</code> 否则无法渲染 <code>children</code>对应的应该是后端所返回的名称</li></ul> <h2 id="权限管理-非代码"><a href="#权限管理-非代码" class="header-anchor">#</a> 权限管理(非代码)</h2> <blockquote><p>展示效果(前端)</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227205708768.png" alt="image-20211227205708768"></p> <blockquote><p>数据介绍和关联关系</p></blockquote> <ul><li>权限管理是精确到按钮的管理内容 这里涉及到每个模块的按钮分配</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210234355.png" alt="image-20211227210234355"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210259841.png" alt="image-20211227210259841"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210318965.png" alt="image-20211227210318965"></p> <p><font color="#ff3040">注意: </font> 一级的类型是 <code>目录type 为0</code> 二级的类型是 <code>菜单type 为1</code> 三级的类型是 <code>按钮type 为3</code></p> <ul><li>目录对应的是路由</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210734657.png" alt=""></p> <ul><li><strong>菜单对应是路由中的内容</strong></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210809213.png" alt="image-20211227210809213"></p> <ul><li>按钮是路由内容中的按钮</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211227210841368.png" alt="image-20211227210841368"></p> <blockquote><p>权限管理树形结构查询接口</p></blockquote> <ul><li>权限管理树形的结构json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">机构管理树形结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>添加权限的树形结构 <code>el-tree</code>树形数据 接口</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211228111107856.png" alt="image-20211228111107856"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211228111130731.png" alt="image-20211228111130731"></p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211228111153740.png" alt="image-20211228111153740"></p> <ul><li>添加权限的树形结构 <code>el-tree</code>树形数据 接口 : <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%B7%BB%E5%8A%A0%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%20.json" target="_blank" rel="noopener noreferrer">添加权限的树形结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>新增权限管理按钮接口</p></blockquote> <ul><li>新增权限管理接口 依据的是<code>pid</code>(上级部门id)</li></ul> <blockquote><p>编辑权限管理按钮接口</p></blockquote> <ul><li>编辑权限管理按钮接口 依据的是 <code>id</code>(主键id)</li></ul> <blockquote><p>删除权限管理按钮接口</p></blockquote> <ul><li>依据的是 <code>id</code>(主键id)</li></ul> <h2 id="角色管理"><a href="#角色管理" class="header-anchor">#</a> 角色管理</h2> <ul><li>角色管理是查看总体角色有哪些 并且控制其可见路由(一二级)和页面内容(三级)</li></ul> <blockquote><p>展示效果</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211229182430280.png" alt=""></p> <blockquote><p>角色管理查询接口</p></blockquote> <ul><li>角色管理查询接口的结构json: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E8%A7%92%E8%89%B2%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3.json" target="_blank" rel="noopener noreferrer">角色管理查询接口json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>用户名称 <code>name</code></li> <li>用户id <code>id</code></li> <li>用户角色创建人id <code>createUser</code></li></ul></li></ul> <blockquote><p>角色管理添加接口</p></blockquote> <ul><li>添加操作需要携带创建人的<code>id</code>(当前用户的userid)</li></ul> <blockquote><p>角色管理删除接口</p></blockquote> <ul><li>删除操作 需要携带删除的角色<code>id</code>(要删除角色的id)</li></ul> <h3 id="分配权限思路"><a href="#分配权限思路" class="header-anchor">#</a> 分配权限思路</h3> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211230184150455.png" alt="image-20211230184150455"></p> <ul><li>分配权限是一个难点 分配权限的数据是饿了么ui树形勾选结构 需要携带以下数据:
<ul><li><code>roleId</code> 为查询的角色id</li> <li><code>userId</code> 为当前用户的角色id 因为角色id要作为可分配的一个筛选条件
<ul><li>也就是说 当前角色权限不能修改比他自身大的权限 树形结构数据只能返回当前角色所拥有的的权限 自身没有的能不返回显示</li></ul></li></ul></li> <li>分配权限查询接口有两个内容</li></ul> <ol><li><code>checkList</code> 当前用户那些权限为选中状态(拥有的权限) (权限选中数组)</li> <li><code>listmenu</code>当前角色用户选中权限的id合集 (权限选中数组)</li></ol> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211230191712030.png" alt="image-20211230191712030"></p> <ul><li>通过<code>checkList</code>储存的值 去匹配<code>listmenu</code>里面的id值 这样就可以知道该用户勾选了那些权限 (权限选中数组)
<ul><li><font color="#ff3040">注意: 必须让后端在所有层级中返回这个空 open 最为一次遍历是否为末级的根据</font></li></ul></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211231102028411.png" alt="image-20211231102028411"></p> <ul><li>分配权限查询接口结构: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">分配权限查询接口结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="分配权限递归代码"><a href="#分配权限递归代码" class="header-anchor">#</a> 分配权限递归代码</h3> <ul><li>分配权限如果前端处理的话 需要两次递归(设置回选) 这样才能实现符合条件的权限勾选状态</li></ul> <ol><li><p>第一次递归需要判断权限对象中<code>children</code>(层级) 是否为末级</p> <ul><li>后端会在每个层级内 放入<code>open</code>空字段 前端递归处理 非末级为false 末级为true</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 判断权限数组对象children是否是末级</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">leafUtils</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 递归函数 筛选setLeaf数组对象</span>
    <span class="token keyword">const</span> <span class="token function-variable function">setLeaf</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断是否存在数组对象 并且数组对象长度不小于0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 循环数组对象内的字段 进行操作</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 判断数组对象中 是否含有children字段 并且长度不小于0</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果满足该条件 则把open字段设置为false</span>
                    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token comment">// 再次自己调用自己 实现递归函数</span>
                    <span class="token function">setLeaf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果不满足条件 则把open字段设置为true</span>
                    arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 返回递归处理后的数据 (需要再次return一次 把处理的递归数据导出)</span>
        <span class="token keyword">return</span> arr
    <span class="token punctuation">}</span>
    <span class="token comment">// 再次return一次 把处理好的递归数据储存到声明变量中 并且以对象方式导出</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        setLeaf
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>第二次递归把第一次递归处理好的数据(添加了末级状态) 拿来后再次递归</p> <ul><li>通过<code>checkList</code> 当前角色用户选中权限的<code>id</code>合集 (权限选中数组) 来匹配树形结构中的<code>id</code> 如果符合 就让其处于勾选状态</li> <li>第一次递归会设置末级状态位 在二次递归的时候 进行判断 如果为末级 就<code>break</code>打断</li> <li><code>childNodes[循环索引值].children</code> 只要节点含有层级 就把每层进行递归处理</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 判断是否是末级的js方法</span>
<span class="token keyword">import</span> leafUtils <span class="token keyword">from</span> <span class="token string">'@/utils/leafUtils'</span>    
<span class="token comment">// 分配权限的属性结构查询 处理数据 能实现权限勾选</span>
  <span class="token keyword">async</span> <span class="token function">assignRole</span> <span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 防止this指向的不是vue实例对象</span>
      <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>roleId <span class="token operator">=</span> row<span class="token punctuation">.</span>id
      <span class="token keyword">const</span> parm <span class="token operator">=</span> <span class="token punctuation">{</span>
        roleId<span class="token operator">:</span> row<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        userId<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>userId
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAssignTreeApi</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当前登录用户所拥有的所有权限</span>
        <span class="token keyword">const</span> menuList <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>listmenu
        <span class="token comment">// 当前被分配的角色所拥有的权限</span>
        <span class="token keyword">const</span> selectIds <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>checkList
        <span class="token comment">// 进行一次递归 提取出末级的递归方法变量</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> setLeaf <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">leafUtils</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 判断是否末级(设置末级状态位) setLeaf实际上是递归的方法</span>
        <span class="token keyword">const</span> newMenuList <span class="token operator">=</span> <span class="token function">setLeaf</span><span class="token punctuation">(</span>menuList<span class="token punctuation">)</span>
        <span class="token comment">// 把处理好的末级树形结构赋值给页面 渲染出来(需替换成自己的)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>assignTreeData <span class="token operator">=</span> newMenuList
        <span class="token comment">// 准备第二次递归 勾选树形结构的内容</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 这里通过ref绑定处理好末级的树形结构 注意要this.$nextTick渲染后再调用 nodes是通过vue实例拿到的渲染好的树形结构</span>
          <span class="token keyword">const</span> nodes <span class="token operator">=</span> that<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span>children
          <span class="token comment">// 进行第二次递归处理 nodes是通过vue实例拿到的树形结构 selectIds是当前角色用户选中权限的id合集 (权限选中数组) that是当前内容的this指向 防止this指错</span>
          that<span class="token punctuation">.</span><span class="token function">setChild</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> selectIds<span class="token punctuation">,</span> that<span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 打开弹出层(需替换成自己的)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>assignDialog<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>assignDialog<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'为【'</span> <span class="token operator">+</span> row<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'】分配权限'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token function">setChild</span> <span class="token punctuation">(</span><span class="token parameter">childNodes<span class="token punctuation">,</span> selectIds<span class="token punctuation">,</span> that</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 这里不要使用this 要使用上个方法传来的that 以防止this指向错误</span>
      <span class="token comment">// 判断树形结构是否存在且不小于0</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes <span class="token operator">&amp;&amp;</span> childNodes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// eslint-disable-next-line no-lone-blocks</span>
        <span class="token comment">// 遍历树形结构 需要调用element getNode()方法 拿到每个node (每个节点的内容 也就是包含一级二级三级都拿出来)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 拿到树形结构中的每个node (每个节点的内容 也就是包含一级二级三级都拿出来)</span>
          <span class="token keyword">var</span> node <span class="token operator">=</span> that<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">getNode</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token comment">// 判断(权限选中数组)是否存在 且长度不小于0</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>selectIds <span class="token operator">&amp;&amp;</span> selectIds<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 遍历(权限选中数组) 那存储的所有权限选中id 去树形结构每个节点中的id其匹配</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> h <span class="token operator">&lt;</span> selectIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> h<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 如果匹配到了相同的id 说明具备该权限 需要处于选中状态</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>selectIds<span class="token punctuation">[</span>h<span class="token punctuation">]</span> <span class="token operator">==</span> childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 这里来判断是否为末级 (通过第一次遍历修改open状态)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 通过调用element setChecked()方法 把未勾选变成已勾选状态 node是一级二级三级都拿出来</span>
                  that<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">setChecked</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
                  <span class="token comment">// 不用return返回 打断即可</span>
                  <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 这里进行判断 如果节点存在children(二级三级) 就继续递归</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 携带所需要的参数childNodes[j](每层数据) selectIds(权限选中数组) that(当前指向)</span>
            that<span class="token punctuation">.</span><span class="token function">setChild</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span> selectIds<span class="token punctuation">,</span> that<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="权限分配提交按钮"><a href="#权限分配提交按钮" class="header-anchor">#</a> 权限分配提交按钮</h3> <ul><li>分配角色的树形结构实际上提交的是勾选上内容(层级)的id 它分为两种id</li></ul> <ol><li>全勾选 全勾选id为路由里按钮等元素的id 他没有依赖关系 所以直接勾选即可</li> <li>半勾选 半勾选是路由 因为路由里按钮等元素被勾选后 路由处于一个半勾选状态 除非他字内容完全勾选 才会成为全勾选
<ul><li>所以全勾选 和 半勾选 他都需要提交 这就需要使用 饿了么ui的两个方法
<ul><li><code>getCheckedKeys()</code>获取全勾选绑定的 <code>node-key</code></li> <li><code>getHalfCheckedKeys()</code>获取半勾选绑定的 <code>node-key</code></li></ul></li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>      <span class="token comment">// 获取绑定node-key的值(一般为条目的id值) getCheckedKeys是获取勾选的id getHalfCheckedKeys是获取半勾选的内容 (半勾选是路由权限 里面勾选的是按钮等元素权限 两者都需要获取到)</span>
      <span class="token comment">// 通过concat()方法把两个数组拼接起来</span>
      <span class="token keyword">const</span> listId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">getCheckedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>assignTree<span class="token punctuation">.</span><span class="token function">getHalfCheckedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// 这里是全勾选和半勾选全部的合集内容</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>listId<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>权限分配提交按钮接口</p></blockquote> <ul><li>需要给后端传递 分配权限的数组(全勾选和半勾选)</li> <li>还需要传递 修改人的<code>userid</code></li></ul> <h2 id="用户管理-非代码"><a href="#用户管理-非代码" class="header-anchor">#</a> 用户管理 (非代码)</h2> <ul><li>用户管理是查看所属部门下的所有用户权限 属于一个总体浏览 看看到底该部门有多少权限</li> <li>用户管理为二合一 左侧菜单栏 显示每个层级部门</li></ul> <blockquote><p>显示效果</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20211231174020671.png" alt=""></p> <h3 id="用户管理左侧菜单"><a href="#用户管理左侧菜单" class="header-anchor">#</a> 用户管理左侧菜单</h3> <ul><li>用户管理为二合一 左侧菜单栏是显示每个层级部门并且选中后右侧显示对应的角色权限</li></ul> <blockquote><p>展示效果</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111203308636.png" alt="image-20220111203308636"></p> <blockquote><p>用户管理左侧菜单数据结构</p></blockquote> <ul><li>用户管理左侧菜单数据结构json:  <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">用户管理左侧菜单数据结构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>这里实际上和 <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%BB%93%E6%9E%84%E7%AE%A1%E7%90%86%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">机构管理树形结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 结构是一致的 都是树形结构 一层一层的</li></ul> <h3 id="用户管理右侧菜单"><a href="#用户管理右侧菜单" class="header-anchor">#</a> 用户管理右侧菜单</h3> <ul><li>右侧菜单展示的是该部门下的所有的用户</li></ul> <blockquote><p>展示效果</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111202655929.png" alt="image-20220111202655929"></p> <blockquote><p>用户管理右侧菜单数据结构</p></blockquote> <ul><li><p>需要给后端传递所选部门的 <code>id</code></p></li> <li><p>用户管理右侧菜单数据结构json:  <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E5%8F%B3%E4%BE%A7%E8%A7%92%E8%89%B2%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.json" target="_blank" rel="noopener noreferrer">用户管理右侧菜单数据结构<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <blockquote><p>用户管理新增右侧菜单用户数据</p></blockquote> <ul><li>这里是管理用户的模块 可以修改部门 账号密码等等</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220105210852891.png" alt="image-20220105210852891"></p> <blockquote><p>用户管理编辑右侧菜单用户数据</p></blockquote> <ul><li>这里需要携带编辑条目的<code>id</code></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220105211047641.png" alt="image-20220105211047641"></p> <blockquote><p>用户管理 编辑和添加所属部门树形结构数据</p></blockquote> <ul><li>和权限管理的所属部门数据一样 都是树形结构:  <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E7%BC%96%E8%BE%91%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%89%80%E5%B1%9E%E9%83%A8%E9%97%A8%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE.json" target="_blank" rel="noopener noreferrer">部门管理编辑和添加所属部门树形结构数据格式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>编辑这里需要携带 <code>pid</code>(当前点击的部门id) 给后端 在点击的部门下 创建用户</li> <li>修改这里需要携带 <code>id</code>(要修改条目的id)给后端 修改对应的条目数据</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220106194736422.png" alt="image-20220106194736422"></p> <blockquote><p>用户管理 删除所属部门下的用户信息</p></blockquote> <ul><li>这里分为真删假删 根据业务 需要携带 <code>id</code>给后端 删除对应的条目数据</li></ul> <h3 id="用户管理右侧菜单分配角色展示效果"><a href="#用户管理右侧菜单分配角色展示效果" class="header-anchor">#</a> 用户管理右侧菜单分配角色展示效果</h3> <ul><li>通过获取到所有用户的角色内容后 相对的也能获取到用户的<code>id</code> 这样可以通过<code>id</code>来查询用户拥有的角色 也可以分配对应的角色</li> <li>这里是设计的时候只能获取单个角色 如果多角色也可以实现</li></ul> <blockquote><p>展示效果</p></blockquote> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220107194042859.png" alt="image-20220107194042859"></p> <blockquote><p>实现思路</p></blockquote> <ul><li><p>需要两个接口</p> <ol><li><p>先查询当前所创建的所有角色 渲染到页面上</p></li> <li><p>再查询当前角色所拥有的角色 然后赋值 在页面上进行勾选展示</p></li></ol></li></ul> <blockquote><p>查询当前所创建的所有角色</p></blockquote> <ul><li>查询当前所创建的所有角色数据格式: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E6%89%80%E5%88%9B%E5%BB%BA%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%92%E8%89%B2%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F.json" target="_blank" rel="noopener noreferrer">查询当前所创建的所有角色数据格式json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220107205325700.png" alt="image-20220107205325700"></p> <blockquote><p>查询当前角色所拥有的权限角色 (本项目为只能拥有一个权限角色)</p></blockquote> <ul><li>携带用户的 <code>userid</code> 来查询用户当前拥有的权限角色 然后根据<code>roleId</code>去tab中匹配 符合条件的勾选</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110094250932.png" alt="image-20220110094250932"></p> <blockquote><p>修改当前角色的权限角色</p></blockquote> <ul><li>携带用户的<code>userid</code>和用户所选的<code>roleId</code> 提交表单 修改用户的权限角色</li></ul> <h2 id="第二阶段-按钮权限-元素权限-的实现"><a href="#第二阶段-按钮权限-元素权限-的实现" class="header-anchor">#</a> 第二阶段: 按钮权限 (元素权限)的实现</h2> <ul><li>权限分为两个阶段</li></ul> <ol><li><font color="#ff3040">路由权限 </font>也就是左侧菜单栏的权限 属于主体权限 是判断用户有权访问该页面的权限</li> <li><font color="#ff3040">按钮权限 (元素)</font> 也就是进入页面后 内容显示与否的权限 是判断用户是否有权看到该元素 或者具备按钮等元素交互的权限</li></ol> <blockquote><p>按钮权限 (元素权限)的思路</p></blockquote> <ul><li>路由合集数据类型介绍</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110113745507.png" alt="image-20220110113745507"></p> <ol><li><p>第一步 首先我们登录后可以拿到用户的权限合集<code>roles</code> 权限合集中包含着 路由和按钮的权限 我们需要用到按钮的权限</p></li> <li><p>第二步 我们拿到用户的权限合集后 把权限合集储存到 <code>sessionstorage</code> 这样页面刷新的时候 会立刻读取 (vuex也可以通过缓存拿到 但是会有延迟 直接储存到缓存更好)</p> <ul><li>在vuex 获取到用户的路由合集后 储存到缓存中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token comment">// 把权限字段放到sessionStorage里面</span>
   sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'codeList'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>第三步 封装一个js方法 用来配合页面<code>v-if</code> 实现元素的显示隐藏 并且在<code>main.js</code>入口文件中注册原型链</p> <ul><li>封装按钮权限的js方法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 判断按钮权限</span>
<span class="token comment">// parm 是页面传来的按字段 用来和权限合集的判断</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">hasPermission</span> <span class="token punctuation">(</span><span class="token parameter">parm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// tag这里声明一个状态 判断用户是否具备按钮元素的权限 默认是false无权限</span>
    <span class="token keyword">let</span> tag <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// 从缓存中读取用户的权限合集</span>
    <span class="token keyword">const</span> codeList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'codeList'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 循环权限合集字段 去和传来的页面字段匹配</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> codeList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果匹配成功 说明拥有权限</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>codeList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> parm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 把tag设置为true</span>
            tag <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token comment">// 打断循环</span>
            <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 把处理好的tag状态返回出去</span>
    <span class="token keyword">return</span> tag
<span class="token punctuation">}</span>

</code></pre></div><ul><li>在<code>main.js</code>入口文件中注册原型链</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 按钮权限判断</span>
<span class="token keyword">import</span> hasPermission <span class="token keyword">from</span> <span class="token string">'@/permission/index'</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasPerm <span class="token operator">=</span> hasPermission
</code></pre></div><ul><li>在页面上进行按钮权限判断</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// 通过 v-if调用按钮权限js方法 传入按钮的权限名称 即可实现按钮权限
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hasPerm(<span class="token punctuation">'</span>sys:menu:edit<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el-icon-edit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>editMenu(scope.row)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>编辑<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>第四步 按钮(元素)设置<code>v-if</code> 调用声明的js方法 并且传参传入的按钮的权限名称 在路由合集中筛选 判断是否有该权限名称 即可实现按钮权限</p></li></ol> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220110132442514.png" alt="image-20220110132442514"></p> <h2 id="退出功能"><a href="#退出功能" class="header-anchor">#</a> 退出功能</h2> <ul><li>退出功能理论上可以让前端删除掉cookie的token的方式 实现退出功能 但是如果用户提前把token保存后再粘贴到cookie里 这时候 就会造成无法准确判断用户是否退出登录
<ul><li>在后端设计的时候 需要做一个退出功能的接口 单独做处理(可以用Redis)</li> <li>这块需要后端建一个黑名单 储存用户退出的token 需要用到Redis 自动删除过期的token 防止多次储存一个人退出的token</li></ul></li></ul> <blockquote><p>前端退出功能操作</p></blockquote> <ul><li>前端需要携带cookie储存的token即可 传给后端 后端去做处理即可</li> <li>同时清除cookie 和 sessionStorage 并且跳转到登录页</li> <li><font color="#ff3040">注意: 如果你使用了token续签 则必须在清空后 重置token过期时间戳(让其变为0) 否则可能会存在判断问题</font></li></ul> <blockquote><p>实现操作</p></blockquote> <ul><li>如果你用的是 vue element admin框架 他的<code>utils</code>文件夹中自带了cookie方法 建议把清除session的也添加进去</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111170221100.png" alt="image-20220111170221100"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token comment">// cookie命名</span>
<span class="token keyword">const</span> TokenKey <span class="token operator">=</span> <span class="token string">'Admin-Token'</span>
<span class="token comment">// session命名</span>
<span class="token keyword">const</span> timeKey <span class="token operator">=</span> <span class="token string">'expireTime'</span>

<span class="token comment">// 获取cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 保存cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setToken</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 移除cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 清空sessionStorage</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">clearStorage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 设置token过期时间 (保存token过期和当前时间进行比较 低于10分钟(或其他时间)进行续签)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setTokenTime</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> time<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 重置token过期时间 (清空token不需要设置为'' 或者null 防止无法判断 需要设置为0或-1)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取储存的token的时间</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>页面退出功能
<ul><li><font color="#ff3040">注意: 如果你使用了token续签 则必须在清空后 重置token过期时间戳(让其变为0) 否则可能会存在判断问题</font></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 清空token</span>
    <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 清空缓存</span>
    <span class="token function">clearStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 重置token时间戳</span>
    <span class="token function">removeTokenTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 刷新跳转</span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/login'</span>
</code></pre></div><h2 id="token续签两种实现方式"><a href="#token续签两种实现方式" class="header-anchor">#</a> token续签两种实现方式</h2> <ul><li>token续签有两种方式 其实全部的token续签都涉及到了axios的请求拦截器<code>response.use()</code> 通过请求拦截器去实现token的续签</li> <li>通常都会在<code>utils</code>里的<code>request.js</code>中进行续签处理 (二次封装axios文件)</li></ul> <h3 id="双token续签机制"><a href="#双token续签机制" class="header-anchor">#</a> 双token续签机制</h3> <ul><li><p>第一种是双token <code>ReFresh_token</code> 和 <code>用户token</code> 当<code>用户token</code>过期后 拿<code>ReFresh_token</code>去续签 <code>ReFresh_token</code>一般有效期是半年 该token不具备任何数据 只是作为续签凭证 如果<code>ReFresh_token</code>过期了 就需要重新登录了 这种方式是相对安全的 因为<code>用户token</code>时间只有五分钟</p></li> <li><p>双token续签机制 总流程图</p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/VaQ6uA7POdc8qJv.png" alt="image-20210605115451235"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//~ 导入 axios组件</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token comment">//~ 导入 router组件 调用跳转方法</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'../router/index'</span>
<span class="token comment">// ~ 目标: (1) 续签token (2) 如果refresh_token失效 就认为登录过期 需要重新登录 try{} catch{}</span>
<span class="token comment">// ~ 双token机制 :</span>
<span class="token comment">// ~ 一个 token为获取数据token(保质期短 需要续签)</span>
<span class="token comment">// ~ 一个是配合续签的token(不支持获取数据 只能续签 保质期长)</span>
<span class="token comment">// ~ 1. 续签token 设置axios.create({}) 设置axios分支</span>
<span class="token comment">// ~ axios.create({})分支可以设置多个基础url地址</span>
<span class="token comment">// ~ 2. 声明一个通用的url基础地址 用于申请token的基础路径 用常量保存</span>
<span class="token keyword">const</span> baseURL <span class="token operator">=</span> <span class="token string">'http://api-toutiao-web.itheima.net/app/'</span>
<span class="token comment">// ~ 3. axios分支的方法 创建axios接口调用方法 取代单一的axios方法(方便单独设置)</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ~ baseURL是axios属性 用来声明url基础路径</span>
  baseURL<span class="token operator">:</span> baseURL
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 封装通用的接口调用方法</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里的返回值是Promise实例对象</span>
  <span class="token keyword">return</span> <span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 设置请求方式</span>
    method<span class="token operator">:</span> options<span class="token punctuation">.</span>method <span class="token operator">||</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
    <span class="token comment">// 设置请求地址</span>
    url<span class="token operator">:</span> options<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    <span class="token comment">// POST/PUT请求参数（请求体）</span>
    data<span class="token operator">:</span> options<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
    <span class="token comment">// GET请求参数（自动拼接到url地址中）</span>
    params<span class="token operator">:</span> options<span class="token punctuation">.</span>params<span class="token punctuation">,</span>
    <span class="token comment">// 设置请求头</span>
    headers<span class="token operator">:</span> options<span class="token punctuation">.</span>headers
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 添加响应拦截器 (加工后)</span>
<span class="token comment">// 响应截拦器是接收到数据 进行一些操作</span>
<span class="token comment">// 请求结果返回后，先不直接导出，而是先对响应码等等进行处理，处理好后再导出给页面</span>
<span class="token comment">// response获取的是 axios处理后的数据</span>
<span class="token comment">// ?  1.常用于清除axios自带data 方便操作</span>
instance<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 获取数据成功时候</span>
  <span class="token comment">// 当获取数据成功时候 直接进入axios里的data</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ~ 4. 通常要用async函数还获取新token值(省去then步骤)</span>
  <span class="token comment">// ~ 开始进行续签token</span>
  <span class="token comment">// ~ 5. 判断token是否失效 错误参数是error</span>
  <span class="token comment">// ~ error里面参数response里面status是服务器返回值401(401无权限访问)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ~ 6. 如果refresh_token 是有效的 续签token </span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// ~ 7. 如果token失效了 申请一个新的token(根据 refresh_token)</span>
    <span class="token comment">// ~ 8. 调用浏览器储存的token (主要用 refresh_token)</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'mytoken'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token comment">// ~ 9. 调用接口 用refresh_token 跟服务器比对 如果成功 续签token</span>
      <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// ~ 10. 设置续签token的请求方式 (put请求方式 替换修改的所有数据)</span>
        method<span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>
        <span class="token comment">// ~ 11. 设置续签token的地址 基础url+token地址</span>
        url<span class="token operator">:</span> baseURL <span class="token operator">+</span> <span class="token string">'v1_0/authorizations'</span><span class="token punctuation">,</span>
        headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ~ 12. 设置请求头 携带refresh_token 和服务器进行比对 如果成功 续签新token</span>
          Authorization<span class="token operator">:</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> user<span class="token punctuation">.</span>refresh_token
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// ~ 13. 获取最新的token数据 覆盖user里面的原先的失效token (在data.data里面的token)</span>
      user<span class="token punctuation">.</span>token <span class="token operator">=</span> info<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token
      <span class="token comment">// ~ 14. 在浏览器中缓存中保存新获取的token值</span>
      sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'mytoken'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment">// ~ 15. 重新调用刚才接口 用新token访问服务器 实现续签成功</span>
      <span class="token comment">// ~ error是返回错误值的参数 config是错误参数中的属性名 里面包含url地址 请求方式等 相当于重新请求服务器</span>
      <span class="token keyword">return</span> <span class="token function">instance</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span> <span class="token comment">// ~ return 如果数据正确就返回去 不打印下面打印信息</span>
      <span class="token comment">// ~ 16. 如果refresh_token失效 让其重新登录 账号获取新的refresh_token (状态码403)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ~ 17. refresh_token失效 让其返回登录页面(需要调用router 组件 利用router方法跳转)</span>
      <span class="token keyword">return</span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token comment">// ~ 让其跳转到首页 return返回数据 不让其执行下面错误提示</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></li></ul> <h3 id="单token时间戳续签机制"><a href="#单token时间戳续签机制" class="header-anchor">#</a> 单token时间戳续签机制</h3> <ul><li><p>第二种是企业常用的 单<code>用户token</code> 当用户登录的时候 接口会返回一个<code>token过期时间戳</code> 前端把时间戳储存session中 每当请求接口的时候 需要电脑当前时间去计算后端返回<code>token过期时间戳</code> 如果小于10分钟(或者其他) 就会进行续签操作 替换一个新的<code>用户token</code>并且更新<code>token过期时间戳</code> 这种方式相对后端来说简单 安全性不如第一种 因为<code>用户token</code> 有效期通常为8小时甚至更长 因为后端是不会把过期token续签的 所以时间设置太短的话 用户临时不操作就会过期重新登录</p></li> <li><p>单token时间戳续签 总流程图</p> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111163947060.png" alt="image-20220111163947060"></p></li></ul> <blockquote><p>后端接口数据需求</p></blockquote> <ul><li>前端需要给后端传递旧token即可 后端就会返回一个新的token 和 新的过期时间戳</li></ul> <ol><li>第一步在<code>utils</code>文件夹下创建cookie 或者 session方法</li></ol> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220111170221100.png" alt="image-20220111170221100"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token comment">// cookie命名</span>
<span class="token keyword">const</span> TokenKey <span class="token operator">=</span> <span class="token string">'Admin-Token'</span>
<span class="token comment">// session命名</span>
<span class="token keyword">const</span> timeKey <span class="token operator">=</span> <span class="token string">'expireTime'</span>

<span class="token comment">// 获取cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 保存cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setToken</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">,</span> token<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 移除cookie</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeToken</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>TokenKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 清空sessionStorage</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">clearStorage</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 设置token过期时间 (保存token过期和当前时间进行比较 低于10分钟(或其他时间)进行续签)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">setTokenTime</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> time<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 重置token过期时间 (清空token不需要设置为'' 或者null 防止无法判断 需要设置为0或-1)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取储存的token的时间</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getTokenTime</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>timeKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>第二步创建一个续签token的api接口 <code>api</code>文件夹</li></ol> <blockquote><p>续签token的数据结构</p></blockquote> <ul><li>续签token的数据结构: <a href="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/%E7%BB%AD%E7%AD%BEtoken%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.json" target="_blank" rel="noopener noreferrer">续签token的数据结构json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// token续签</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">refreshTokenApi</span> <span class="token punctuation">(</span><span class="token parameter">parm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/sysUser/refreshToken'</span><span class="token punctuation">,</span> parm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>第三步在axios二次封装下的截器去实现token的续签
<ul><li><font color="#ff3040">注意: token续签的处理需要写在添加请求头的上面(把token塞到请求头里) 因为我们在续签后就已经处理了</font></li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token comment">// 导入vuex</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token comment">// 处理token和cookie</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken<span class="token punctuation">,</span> getTokenTime<span class="token punctuation">,</span> setTokenTime<span class="token punctuation">,</span> removeTokenTime<span class="token punctuation">,</span> setToken<span class="token punctuation">,</span> clearStorage<span class="token punctuation">,</span> removeToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> refreshTokenApi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/api/user'</span>
<span class="token comment">// create an axios instance</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  baseURL<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span><span class="token punctuation">,</span> <span class="token comment">// url = base url + request url</span>
  <span class="token comment">// withCredentials: true, // send cookies when cross-domain requests</span>
 <span class="token comment">// timeout: 5000 // request timeout</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//! --------------------处理token续签</span>
<span class="token comment">// token续签方法</span>
<span class="token keyword">function</span> <span class="token function">reFresh</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 声明一个变量 储存当前token 作为替换凭证</span>
  <span class="token keyword">const</span> parm <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'token'</span><span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 向接口请求一个新的token</span>
  <span class="token keyword">return</span> <span class="token function">refreshTokenApi</span><span class="token punctuation">(</span>parm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 这里其实可以简写</span>
  <span class="token comment">//  return refreshTokenApi(parm).then(res =&gt; res)</span>
<span class="token punctuation">}</span>
<span class="token comment">//! 处理token续签</span>
<span class="token comment">// 定义一个状态位 防止多次获取 无需每个接口都请求</span>
<span class="token keyword">let</span> isReFresh <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token comment">// request interceptor</span>
<span class="token comment">// 发送请求之前的拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//! 处理token续签</span>
    <span class="token comment">// 获取当前系统时间戳</span>
    <span class="token keyword">const</span> curent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取缓存中的时间戳</span>
    <span class="token keyword">const</span> expireTime <span class="token operator">=</span> <span class="token function">getTokenTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果缓存中的时间戳存在</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>expireTime <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> minMx <span class="token operator">=</span> <span class="token punctuation">(</span>expireTime <span class="token operator">-</span> curent<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token comment">// 毫秒计算</span>
      <span class="token comment">// 判断token时间是否小于十分钟 小于十分钟进行token续签操作</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>minMx <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断状态位 为false执行 防止多次请求token续签接口</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isReFresh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          isReFresh <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token comment">// 返回操作 不再执行以下拦截器操作 防止报错</span>
          <span class="token keyword">return</span> <span class="token function">reFresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 判断是否请求成功</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 设置新的token</span>
              <span class="token function">setToken</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
              <span class="token comment">// 设置新的时间戳</span>
              <span class="token function">setTokenTime</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>expireTime<span class="token punctuation">)</span>
              <span class="token comment">// 把新的token添加到头部 实现正常获取数据</span>
              config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 返回config 正常获取接口数据</span>
            <span class="token keyword">return</span> config
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果续签失败进行处理(没有)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 无论是否获取成功或者失败 都需要把状态位重置</span>
            isReFresh <span class="token operator">=</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// do something before request is sent</span>
    <span class="token comment">// 从store里面获取token，如果token存在，</span>
    <span class="token comment">// 把token添加到请求的头部Headers里面</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// let each request carry token</span>
      <span class="token comment">// ['X-Token'] is a custom headers key</span>
      <span class="token comment">// please modify it according to the actual situation</span>
      <span class="token comment">// 把token添加到请求的头部</span>
      <span class="token comment">//! config是发送的数据 headers是axios请求头 Authorization是后端接口判断token的属性名</span>
        config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something with request error</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// for debug</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>


</code></pre></div><h2 id="备注"><a href="#备注" class="header-anchor">#</a> 备注</h2> <ul><li>角色管理中用到的两个递归 第一个递归是判断是否末级 第二个递归是判断是否勾选 其实这里不太需要判断是否末级 你可以要求后端返回末级的时候不要带<strong>children</strong> 然后判断children即可知道是否末级 所以就不需要第一次末级递归 这样可以增强性能</li></ul> <p><img src="https://jinyanlong-1305883696.cos.ap-hongkong.myqcloud.com/image-20220120164054492.png" alt="image-20220120164054492"></p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2022/1/14 上午11:41:59</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div></div><APlayer audio="" fixed="true" mini="true" theme="#647ea0" loop="loop" order="list" preload="auto" volume="0.3" mutex="true" lrc-type="0" list-folded="true" list-max-height="250" storage-name="vuepress-plugin-meting" id="aplayer-fixed"></APlayer><div id="goTop" class="hide-cat" data-v-bf92849a></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 LKaiLi
    </div> <div class="operation" style="right:90px;bottom:40px;display:none;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="120" height="322" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/assets/js/app.0080b5db.js" defer></script><script src="/assets/js/5.e6fb2106.js" defer></script><script src="/assets/js/1.9ae38156.js" defer></script><script src="/assets/js/50.302a422c.js" defer></script>
  </body>
</html>
